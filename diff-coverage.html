<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
        <title>Diff Coverage</title>
        <style>
            .src-snippet { margin-top: 2em; }
            .src-name { font-weight: bold; }
            .snippets {
                border-top: 1px solid #bdbdbd;
                border-bottom: 1px solid #bdbdbd;
            }
            pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #ffcccc }
.c { color: #3D7B7B; font-style: italic } /* Comment */
.err { border: 1px solid #F00 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666 } /* Operator */
.ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cp { color: #9C6500 } /* Comment.Preproc */
.cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.gr { color: #E40000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #008400 } /* Generic.Inserted */
.go { color: #717171 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #04D } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #687822 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #00F; font-weight: bold } /* Name.Class */
.no { color: #800 } /* Name.Constant */
.nd { color: #A2F } /* Name.Decorator */
.ni { color: #717171; font-weight: bold } /* Name.Entity */
.ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.nf { color: #00F } /* Name.Function */
.nl { color: #767600 } /* Name.Label */
.nn { color: #00F; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #A2F; font-weight: bold } /* Operator.Word */
.w { color: #BBB } /* Text.Whitespace */
.mb { color: #666 } /* Literal.Number.Bin */
.mf { color: #666 } /* Literal.Number.Float */
.mh { color: #666 } /* Literal.Number.Hex */
.mi { color: #666 } /* Literal.Number.Integer */
.mo { color: #666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #A45A77 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #00F } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666 } /* Literal.Number.Integer.Long */
        </style>
    </head>
    <body>
        <h1>Diff Coverage</h1>
        <p>Diff: origin/main...HEAD, staged and unstaged changes</p>
        <ul>
            <li><b>Total</b>: 2073 lines</li>
            <li><b>Missing</b>: 856 lines</li>
            <li><b>Coverage</b>: 58%</li>
        </ul>
        <table border="1">
            <tr>
                <th>Source File</th>
                <th>Diff Coverage (%)</th>
                <th>Missing Lines</th>
            </tr>
            <tr>
                <td>src/oscura/__init__.py</td>
                <td>0.0%</td>
                <td>56</td>
            </tr>
            <tr>
                <td>src/oscura/analyzers/eye/__init__.py</td>
                <td>100%</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>src/oscura/analyzers/eye/generation.py</td>
                <td>19.1%</td>
                <td>97-98,100-102,104-105,108-109,111,115,130-132,135,140-141,155-157,159-160,162,164,166-167,174,185-187,189-191,193-194,196-197,199-200,207,218-219,221-222,224-225,227,234,267-268,270-271,279-280,283,286-288,290,292-293,295-296,299-301,303-304,307-308,310,312-313,315-316,323-324,326,346-350,363-364,366-368,370-371,373,389-390,392-394,396-398,400-401,403,405,407,419-422,456-457,460-462,464-465,467,472,475-477,480-481,483</td>
            </tr>
            <tr>
                <td>src/oscura/analyzers/jitter/__init__.py</td>
                <td>100%</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>src/oscura/analyzers/jitter/timing.py</td>
                <td>83.5%</td>
                <td>101-102,105,108-109,112-114,117,119,152,163,184-185,226,236,308,358,388,403</td>
            </tr>
            <tr>
                <td>src/oscura/analyzers/patterns/__init__.py</td>
                <td>100%</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>src/oscura/analyzers/patterns/reverse_engineering.py</td>
                <td>87.9%</td>
                <td>239,243,250-251,266-267,273-274,287-288,304-305,485,559,563,572,592,596,627,665,678,680,689,705,710,756,921-923,926-927,931,964-966,969-970,973</td>
            </tr>
            <tr>
                <td>src/oscura/analyzers/statistics/basic.py</td>
                <td>58.8%</td>
                <td>358,362,380,383,386,389-390,393-398,400</td>
            </tr>
            <tr>
                <td>src/oscura/analyzers/statistics/correlation.py</td>
                <td>100%</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>src/oscura/analyzers/waveform/measurements.py</td>
                <td>90.2%</td>
                <td>372,428,446,940</td>
            </tr>
            <tr>
                <td>src/oscura/analyzers/waveform/spectral.py</td>
                <td>63.5%</td>
                <td>708,2069,2083,2088,2239,2248-2249,2251,2253,2255-2259,2261-2262,2264,2267-2272,2274-2275,2277-2280,2282,2284</td>
            </tr>
            <tr>
                <td>src/oscura/automotive/__init__.py</td>
                <td>0.0%</td>
                <td>52</td>
            </tr>
            <tr>
                <td>src/oscura/core/types.py</td>
                <td>100%</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>src/oscura/reporting/__init__.py</td>
                <td>100%</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>src/oscura/reporting/automation.py</td>
                <td>91.4%</td>
                <td>145,165,260,263-264,340-341,343-344</td>
            </tr>
            <tr>
                <td>src/oscura/reporting/citations.py</td>
                <td>97.6%</td>
                <td>254,372</td>
            </tr>
            <tr>
                <td>src/oscura/reporting/core.py</td>
                <td>100%</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>src/oscura/reporting/formatting/__init__.py</td>
                <td>100%</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>src/oscura/reporting/formatting/measurements.py</td>
                <td>67.6%</td>
                <td>44,76-77,81-82,118,121,128-130,132-135,137,140-141,176,181,198,218-219</td>
            </tr>
            <tr>
                <td>src/oscura/reporting/html.py</td>
                <td>82.4%</td>
                <td>553,680,695</td>
            </tr>
            <tr>
                <td>src/oscura/reporting/interpretation.py</td>
                <td>89.1%</td>
                <td>121-122,127-128,143-145,161-162,184-185,211-213,215-217,219-220,265</td>
            </tr>
            <tr>
                <td>src/oscura/reporting/summary.py</td>
                <td>43.2%</td>
                <td>53,56-57,60-61,64-67,70,72-74,76-78,80-83,85,93,95-98,101-103,105-113,115-116,118,127-129,131,145,147,159,161-162,165,167,249,258,265,267,273,276-283,321,326</td>
            </tr>
            <tr>
                <td>src/oscura/reporting/visualization.py</td>
                <td>18.9%</td>
                <td>73-74,77-82,85-86,89-91,94,97,122-123,125-127,156,159,162-165,174-175,200,203,206,208-210,212-218,227,230-231,233,258,261,263-264,267-268,270,295,298,301,306-307,309,311,335,338-339,341-346,354-355,378,381,386-389,395,398-399,410-412,432-433,436-437,446,449-451,454-456,458,461,472,474,497,500-501,504-505,508-511,513-514,516,535-540,542</td>
            </tr>
            <tr>
                <td>src/oscura/visualization/__init__.py</td>
                <td>100%</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>src/oscura/visualization/batch.py</td>
                <td>75.7%</td>
                <td>99-101,332-334,392-395,398-401,403-406,408-410,443,454-457,465-468,473-476,481-484,488-489,492,501-504</td>
            </tr>
            <tr>
                <td>src/oscura/workflows/__init__.py</td>
                <td>100%</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td>src/oscura/workflows/waveform.py</td>
                <td>4.2%</td>
                <td>125-126,128-129,132-134,136-139,141-145,148,151,155-160,163,165-169,172-173,176-179,181-185,187,189,191,194-199,201-202,204,209,211-215,218-219,222-223,225-226,228,230,232-233,235,238,240,243-244,246,249-252,254-256,259-262,264-268,270,272,274-278,281-282,284-288,290-291,294,296-297,299-300,302,308-309,316-317,319-320,324,327,329,331-332,334-336,339,341,347-351,356,358-359,362-365,367,369-374,376-377,379,387,400-401,404-412,414-421,424-425,427-431,433,436-437,440-443,445-446,452,462,464-473,476-478,481,483-484,494-498,501-506,508,511-512,514-515,518-523,525,528,531,537,549,553,555-556,558-559,561,564-565,571-572,575-576,582-583,589-590,596-597,603,606-607,609-611,614-615,617-618,620-630,633,659-668,670-671,673,685,687-688,690-692,694-695,697-698,700-701,703-704,706-707,709-713,715,717-721,723,735-736,739-742,744-750,752,764,766-776,778</td>
            </tr>
        </table>
        <div class="src-snippet">
            <div class="src-name">src/oscura/__init__.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/__init__.py-52" name="src/oscura/__init__.py-52"></a>
<a id="src/oscura/__init__.py-53" name="src/oscura/__init__.py-53"></a>    <span class="n">__version__</span> <span class="o">=</span> <span class="n">version</span><span class="p">(</span><span class="s2">&quot;oscura&quot;</span><span class="p">)</span>
<a id="src/oscura/__init__.py-54" name="src/oscura/__init__.py-54"></a><span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="src/oscura/__init__.py-55" name="src/oscura/__init__.py-55"></a>    <span class="c1"># Fallback for development/testing when package not installed</span>
<a id="src/oscura/__init__.py-56" name="src/oscura/__init__.py-56"></a><span class="hll">    <span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.8.0&quot;</span>
</span><a id="src/oscura/__init__.py-57" name="src/oscura/__init__.py-57"></a>
<a id="src/oscura/__init__.py-58" name="src/oscura/__init__.py-58"></a><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Oscura Contributors&quot;</span>
<a id="src/oscura/__init__.py-59" name="src/oscura/__init__.py-59"></a>
<a id="src/oscura/__init__.py-60" name="src/oscura/__init__.py-60"></a><span class="c1"># Core types</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/oscura/analyzers/eye/generation.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/eye/generation.py-93" name="src/oscura/analyzers/eye/generation.py-93"></a>
<a id="src/oscura/analyzers/eye/generation.py-94" name="src/oscura/analyzers/eye/generation.py-94"></a><span class="sd">    References:</span>
<a id="src/oscura/analyzers/eye/generation.py-95" name="src/oscura/analyzers/eye/generation.py-95"></a><span class="sd">        OIF CEI: Common Electrical I/O Eye Diagram Methodology</span>
<a id="src/oscura/analyzers/eye/generation.py-96" name="src/oscura/analyzers/eye/generation.py-96"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/eye/generation.py-97" name="src/oscura/analyzers/eye/generation.py-97"></a><span class="hll">    <span class="n">data</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span>
</span><a id="src/oscura/analyzers/eye/generation.py-98" name="src/oscura/analyzers/eye/generation.py-98"></a><span class="hll">    <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">sample_rate</span>
</span><a id="src/oscura/analyzers/eye/generation.py-99" name="src/oscura/analyzers/eye/generation.py-99"></a>
<a id="src/oscura/analyzers/eye/generation.py-100" name="src/oscura/analyzers/eye/generation.py-100"></a><span class="hll">    <span class="n">samples_per_ui</span> <span class="o">=</span> <span class="n">_validate_unit_interval</span><span class="p">(</span><span class="n">unit_interval</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-101" name="src/oscura/analyzers/eye/generation.py-101"></a><span class="hll">    <span class="n">total_ui_samples</span> <span class="o">=</span> <span class="n">samples_per_ui</span> <span class="o">*</span> <span class="n">n_ui</span>
</span><a id="src/oscura/analyzers/eye/generation.py-102" name="src/oscura/analyzers/eye/generation.py-102"></a><span class="hll">    <span class="n">_validate_data_length</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">total_ui_samples</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-103" name="src/oscura/analyzers/eye/generation.py-103"></a>
<a id="src/oscura/analyzers/eye/generation.py-104" name="src/oscura/analyzers/eye/generation.py-104"></a><span class="hll">    <span class="n">trigger_indices</span> <span class="o">=</span> <span class="n">_find_trigger_points</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">trigger_level</span><span class="p">,</span> <span class="n">trigger_edge</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-105" name="src/oscura/analyzers/eye/generation.py-105"></a><span class="hll">    <span class="n">eye_traces</span> <span class="o">=</span> <span class="n">_extract_eye_traces</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/eye/generation.py-106" name="src/oscura/analyzers/eye/generation.py-106"></a>        <span class="n">data</span><span class="p">,</span> <span class="n">trigger_indices</span><span class="p">,</span> <span class="n">samples_per_ui</span><span class="p">,</span> <span class="n">total_ui_samples</span><span class="p">,</span> <span class="n">max_traces</span>
<a id="src/oscura/analyzers/eye/generation.py-107" name="src/oscura/analyzers/eye/generation.py-107"></a>    <span class="p">)</span>
<a id="src/oscura/analyzers/eye/generation.py-108" name="src/oscura/analyzers/eye/generation.py-108"></a><span class="hll">    <span class="n">eye_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eye_traces</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-109" name="src/oscura/analyzers/eye/generation.py-109"></a><span class="hll">    <span class="n">time_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_ui</span><span class="p">,</span> <span class="n">total_ui_samples</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-110" name="src/oscura/analyzers/eye/generation.py-110"></a>
<a id="src/oscura/analyzers/eye/generation.py-111" name="src/oscura/analyzers/eye/generation.py-111"></a><span class="hll">    <span class="n">histogram</span><span class="p">,</span> <span class="n">voltage_bins</span><span class="p">,</span> <span class="n">time_bins</span> <span class="o">=</span> <span class="n">_generate_histogram_if_requested</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/eye/generation.py-112" name="src/oscura/analyzers/eye/generation.py-112"></a>        <span class="n">eye_data</span><span class="p">,</span> <span class="n">time_axis</span><span class="p">,</span> <span class="n">n_ui</span><span class="p">,</span> <span class="n">generate_histogram</span><span class="p">,</span> <span class="n">histogram_bins</span>
<a id="src/oscura/analyzers/eye/generation.py-113" name="src/oscura/analyzers/eye/generation.py-113"></a>    <span class="p">)</span>
<a id="src/oscura/analyzers/eye/generation.py-114" name="src/oscura/analyzers/eye/generation.py-114"></a>
<a id="src/oscura/analyzers/eye/generation.py-115" name="src/oscura/analyzers/eye/generation.py-115"></a><span class="hll">    <span class="k">return</span> <span class="n">EyeDiagram</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/eye/generation.py-116" name="src/oscura/analyzers/eye/generation.py-116"></a>        <span class="n">data</span><span class="o">=</span><span class="n">eye_data</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-117" name="src/oscura/analyzers/eye/generation.py-117"></a>        <span class="n">time_axis</span><span class="o">=</span><span class="n">time_axis</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-118" name="src/oscura/analyzers/eye/generation.py-118"></a>        <span class="n">unit_interval</span><span class="o">=</span><span class="n">unit_interval</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-119" name="src/oscura/analyzers/eye/generation.py-119"></a>        <span class="n">samples_per_ui</span><span class="o">=</span><span class="n">samples_per_ui</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/eye/generation.py-126" name="src/oscura/analyzers/eye/generation.py-126"></a>
<a id="src/oscura/analyzers/eye/generation.py-127" name="src/oscura/analyzers/eye/generation.py-127"></a>
<a id="src/oscura/analyzers/eye/generation.py-128" name="src/oscura/analyzers/eye/generation.py-128"></a><span class="k">def</span><span class="w"> </span><span class="nf">_validate_unit_interval</span><span class="p">(</span><span class="n">unit_interval</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="src/oscura/analyzers/eye/generation.py-129" name="src/oscura/analyzers/eye/generation.py-129"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate unit interval and calculate samples per UI.&quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/eye/generation.py-130" name="src/oscura/analyzers/eye/generation.py-130"></a><span class="hll">    <span class="n">samples_per_ui</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">unit_interval</span> <span class="o">*</span> <span class="n">sample_rate</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-131" name="src/oscura/analyzers/eye/generation.py-131"></a><span class="hll">    <span class="k">if</span> <span class="n">samples_per_ui</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-132" name="src/oscura/analyzers/eye/generation.py-132"></a><span class="hll">        <span class="k">raise</span> <span class="n">AnalysisError</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/eye/generation.py-133" name="src/oscura/analyzers/eye/generation.py-133"></a>            <span class="sa">f</span><span class="s2">&quot;Unit interval too short: </span><span class="si">{</span><span class="n">samples_per_ui</span><span class="si">}</span><span class="s2"> samples/UI. Need at least 4 samples per UI.&quot;</span>
<a id="src/oscura/analyzers/eye/generation.py-134" name="src/oscura/analyzers/eye/generation.py-134"></a>        <span class="p">)</span>
<a id="src/oscura/analyzers/eye/generation.py-135" name="src/oscura/analyzers/eye/generation.py-135"></a><span class="hll">    <span class="k">return</span> <span class="n">samples_per_ui</span>
</span><a id="src/oscura/analyzers/eye/generation.py-136" name="src/oscura/analyzers/eye/generation.py-136"></a>
<a id="src/oscura/analyzers/eye/generation.py-137" name="src/oscura/analyzers/eye/generation.py-137"></a>
<a id="src/oscura/analyzers/eye/generation.py-138" name="src/oscura/analyzers/eye/generation.py-138"></a><span class="k">def</span><span class="w"> </span><span class="nf">_validate_data_length</span><span class="p">(</span><span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">total_ui_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/oscura/analyzers/eye/generation.py-139" name="src/oscura/analyzers/eye/generation.py-139"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that we have enough data for eye generation.&quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/eye/generation.py-140" name="src/oscura/analyzers/eye/generation.py-140"></a><span class="hll">    <span class="k">if</span> <span class="n">n_samples</span> <span class="o">&lt;</span> <span class="n">total_ui_samples</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-141" name="src/oscura/analyzers/eye/generation.py-141"></a><span class="hll">        <span class="k">raise</span> <span class="n">InsufficientDataError</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/eye/generation.py-142" name="src/oscura/analyzers/eye/generation.py-142"></a>            <span class="sa">f</span><span class="s2">&quot;Need at least </span><span class="si">{</span><span class="n">total_ui_samples</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2"> samples for eye diagram&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-143" name="src/oscura/analyzers/eye/generation.py-143"></a>            <span class="n">required</span><span class="o">=</span><span class="n">total_ui_samples</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-144" name="src/oscura/analyzers/eye/generation.py-144"></a>            <span class="n">available</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-145" name="src/oscura/analyzers/eye/generation.py-145"></a>            <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;eye_diagram_generation&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/eye/generation.py-151" name="src/oscura/analyzers/eye/generation.py-151"></a>    <span class="n">trigger_level</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-152" name="src/oscura/analyzers/eye/generation.py-152"></a>    <span class="n">trigger_edge</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-153" name="src/oscura/analyzers/eye/generation.py-153"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">intp</span><span class="p">]:</span>
<a id="src/oscura/analyzers/eye/generation.py-154" name="src/oscura/analyzers/eye/generation.py-154"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find trigger points in the data.&quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/eye/generation.py-155" name="src/oscura/analyzers/eye/generation.py-155"></a><span class="hll">    <span class="n">low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-156" name="src/oscura/analyzers/eye/generation.py-156"></a><span class="hll">    <span class="n">high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-157" name="src/oscura/analyzers/eye/generation.py-157"></a><span class="hll">    <span class="n">threshold</span> <span class="o">=</span> <span class="n">low</span> <span class="o">+</span> <span class="n">trigger_level</span> <span class="o">*</span> <span class="p">(</span><span class="n">high</span> <span class="o">-</span> <span class="n">low</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-158" name="src/oscura/analyzers/eye/generation.py-158"></a>
<a id="src/oscura/analyzers/eye/generation.py-159" name="src/oscura/analyzers/eye/generation.py-159"></a><span class="hll">    <span class="k">if</span> <span class="n">trigger_edge</span> <span class="o">==</span> <span class="s2">&quot;rising&quot;</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-160" name="src/oscura/analyzers/eye/generation.py-160"></a><span class="hll">        <span class="n">trigger_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-161" name="src/oscura/analyzers/eye/generation.py-161"></a>    <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/analyzers/eye/generation.py-162" name="src/oscura/analyzers/eye/generation.py-162"></a><span class="hll">        <span class="n">trigger_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-163" name="src/oscura/analyzers/eye/generation.py-163"></a>
<a id="src/oscura/analyzers/eye/generation.py-164" name="src/oscura/analyzers/eye/generation.py-164"></a><span class="hll">    <span class="n">trigger_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">trigger_mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><a id="src/oscura/analyzers/eye/generation.py-165" name="src/oscura/analyzers/eye/generation.py-165"></a>
<a id="src/oscura/analyzers/eye/generation.py-166" name="src/oscura/analyzers/eye/generation.py-166"></a><span class="hll">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trigger_indices</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-167" name="src/oscura/analyzers/eye/generation.py-167"></a><span class="hll">        <span class="k">raise</span> <span class="n">InsufficientDataError</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/eye/generation.py-168" name="src/oscura/analyzers/eye/generation.py-168"></a>            <span class="s2">&quot;Not enough trigger events for eye diagram&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-169" name="src/oscura/analyzers/eye/generation.py-169"></a>            <span class="n">required</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-170" name="src/oscura/analyzers/eye/generation.py-170"></a>            <span class="n">available</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">trigger_indices</span><span class="p">),</span>
<a id="src/oscura/analyzers/eye/generation.py-171" name="src/oscura/analyzers/eye/generation.py-171"></a>            <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;eye_diagram_generation&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/eye/generation.py-170" name="src/oscura/analyzers/eye/generation.py-170"></a>            <span class="n">available</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">trigger_indices</span><span class="p">),</span>
<a id="src/oscura/analyzers/eye/generation.py-171" name="src/oscura/analyzers/eye/generation.py-171"></a>            <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;eye_diagram_generation&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-172" name="src/oscura/analyzers/eye/generation.py-172"></a>        <span class="p">)</span>
<a id="src/oscura/analyzers/eye/generation.py-173" name="src/oscura/analyzers/eye/generation.py-173"></a>
<a id="src/oscura/analyzers/eye/generation.py-174" name="src/oscura/analyzers/eye/generation.py-174"></a><span class="hll">    <span class="k">return</span> <span class="n">trigger_indices</span>
</span><a id="src/oscura/analyzers/eye/generation.py-175" name="src/oscura/analyzers/eye/generation.py-175"></a>
<a id="src/oscura/analyzers/eye/generation.py-176" name="src/oscura/analyzers/eye/generation.py-176"></a>
<a id="src/oscura/analyzers/eye/generation.py-177" name="src/oscura/analyzers/eye/generation.py-177"></a><span class="k">def</span><span class="w"> </span><span class="nf">_extract_eye_traces</span><span class="p">(</span>
<a id="src/oscura/analyzers/eye/generation.py-178" name="src/oscura/analyzers/eye/generation.py-178"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/eye/generation.py-181" name="src/oscura/analyzers/eye/generation.py-181"></a>    <span class="n">total_ui_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-182" name="src/oscura/analyzers/eye/generation.py-182"></a>    <span class="n">max_traces</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-183" name="src/oscura/analyzers/eye/generation.py-183"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
<a id="src/oscura/analyzers/eye/generation.py-184" name="src/oscura/analyzers/eye/generation.py-184"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract eye traces from data using trigger points.&quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/eye/generation.py-185" name="src/oscura/analyzers/eye/generation.py-185"></a><span class="hll">    <span class="n">eye_traces</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/oscura/analyzers/eye/generation.py-186" name="src/oscura/analyzers/eye/generation.py-186"></a><span class="hll">    <span class="n">half_ui</span> <span class="o">=</span> <span class="n">samples_per_ui</span> <span class="o">//</span> <span class="mi">2</span>
</span><a id="src/oscura/analyzers/eye/generation.py-187" name="src/oscura/analyzers/eye/generation.py-187"></a><span class="hll">    <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-188" name="src/oscura/analyzers/eye/generation.py-188"></a>
<a id="src/oscura/analyzers/eye/generation.py-189" name="src/oscura/analyzers/eye/generation.py-189"></a><span class="hll">    <span class="k">for</span> <span class="n">trig_idx</span> <span class="ow">in</span> <span class="n">trigger_indices</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-190" name="src/oscura/analyzers/eye/generation.py-190"></a><span class="hll">        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">trig_idx</span> <span class="o">-</span> <span class="n">half_ui</span>
</span><a id="src/oscura/analyzers/eye/generation.py-191" name="src/oscura/analyzers/eye/generation.py-191"></a><span class="hll">        <span class="n">end_idx</span> <span class="o">=</span> <span class="n">start_idx</span> <span class="o">+</span> <span class="n">total_ui_samples</span>
</span><a id="src/oscura/analyzers/eye/generation.py-192" name="src/oscura/analyzers/eye/generation.py-192"></a>
<a id="src/oscura/analyzers/eye/generation.py-193" name="src/oscura/analyzers/eye/generation.py-193"></a><span class="hll">        <span class="k">if</span> <span class="n">start_idx</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">end_idx</span> <span class="o">&lt;=</span> <span class="n">n_samples</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-194" name="src/oscura/analyzers/eye/generation.py-194"></a><span class="hll">            <span class="n">eye_traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">])</span>
</span><a id="src/oscura/analyzers/eye/generation.py-195" name="src/oscura/analyzers/eye/generation.py-195"></a>
<a id="src/oscura/analyzers/eye/generation.py-196" name="src/oscura/analyzers/eye/generation.py-196"></a><span class="hll">        <span class="k">if</span> <span class="n">max_traces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">eye_traces</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">max_traces</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-197" name="src/oscura/analyzers/eye/generation.py-197"></a><span class="hll">            <span class="k">break</span>
</span><a id="src/oscura/analyzers/eye/generation.py-198" name="src/oscura/analyzers/eye/generation.py-198"></a>
<a id="src/oscura/analyzers/eye/generation.py-199" name="src/oscura/analyzers/eye/generation.py-199"></a><span class="hll">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eye_traces</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-200" name="src/oscura/analyzers/eye/generation.py-200"></a><span class="hll">        <span class="k">raise</span> <span class="n">InsufficientDataError</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/eye/generation.py-201" name="src/oscura/analyzers/eye/generation.py-201"></a>            <span class="s2">&quot;Could not extract any complete eye traces&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-202" name="src/oscura/analyzers/eye/generation.py-202"></a>            <span class="n">required</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-203" name="src/oscura/analyzers/eye/generation.py-203"></a>            <span class="n">available</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-204" name="src/oscura/analyzers/eye/generation.py-204"></a>            <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;eye_diagram_generation&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/eye/generation.py-203" name="src/oscura/analyzers/eye/generation.py-203"></a>            <span class="n">available</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-204" name="src/oscura/analyzers/eye/generation.py-204"></a>            <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;eye_diagram_generation&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-205" name="src/oscura/analyzers/eye/generation.py-205"></a>        <span class="p">)</span>
<a id="src/oscura/analyzers/eye/generation.py-206" name="src/oscura/analyzers/eye/generation.py-206"></a>
<a id="src/oscura/analyzers/eye/generation.py-207" name="src/oscura/analyzers/eye/generation.py-207"></a><span class="hll">    <span class="k">return</span> <span class="n">eye_traces</span>
</span><a id="src/oscura/analyzers/eye/generation.py-208" name="src/oscura/analyzers/eye/generation.py-208"></a>
<a id="src/oscura/analyzers/eye/generation.py-209" name="src/oscura/analyzers/eye/generation.py-209"></a>
<a id="src/oscura/analyzers/eye/generation.py-210" name="src/oscura/analyzers/eye/generation.py-210"></a><span class="k">def</span><span class="w"> </span><span class="nf">_generate_histogram_if_requested</span><span class="p">(</span>
<a id="src/oscura/analyzers/eye/generation.py-211" name="src/oscura/analyzers/eye/generation.py-211"></a>    <span class="n">eye_data</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/eye/generation.py-214" name="src/oscura/analyzers/eye/generation.py-214"></a>    <span class="n">generate_histogram</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-215" name="src/oscura/analyzers/eye/generation.py-215"></a>    <span class="n">histogram_bins</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<a id="src/oscura/analyzers/eye/generation.py-216" name="src/oscura/analyzers/eye/generation.py-216"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<a id="src/oscura/analyzers/eye/generation.py-217" name="src/oscura/analyzers/eye/generation.py-217"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate 2D histogram if requested.&quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/eye/generation.py-218" name="src/oscura/analyzers/eye/generation.py-218"></a><span class="hll">    <span class="k">if</span> <span class="ow">not</span> <span class="n">generate_histogram</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-219" name="src/oscura/analyzers/eye/generation.py-219"></a><span class="hll">        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><a id="src/oscura/analyzers/eye/generation.py-220" name="src/oscura/analyzers/eye/generation.py-220"></a>
<a id="src/oscura/analyzers/eye/generation.py-221" name="src/oscura/analyzers/eye/generation.py-221"></a><span class="hll">    <span class="n">all_voltages</span> <span class="o">=</span> <span class="n">eye_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><a id="src/oscura/analyzers/eye/generation.py-222" name="src/oscura/analyzers/eye/generation.py-222"></a><span class="hll">    <span class="n">all_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">time_axis</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">eye_data</span><span class="p">))</span>
</span><a id="src/oscura/analyzers/eye/generation.py-223" name="src/oscura/analyzers/eye/generation.py-223"></a>
<a id="src/oscura/analyzers/eye/generation.py-224" name="src/oscura/analyzers/eye/generation.py-224"></a><span class="hll">    <span class="n">voltage_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">all_voltages</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">all_voltages</span><span class="p">))</span>
</span><a id="src/oscura/analyzers/eye/generation.py-225" name="src/oscura/analyzers/eye/generation.py-225"></a><span class="hll">    <span class="n">time_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_ui</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-226" name="src/oscura/analyzers/eye/generation.py-226"></a>
<a id="src/oscura/analyzers/eye/generation.py-227" name="src/oscura/analyzers/eye/generation.py-227"></a><span class="hll">    <span class="n">histogram</span><span class="p">,</span> <span class="n">voltage_edges</span><span class="p">,</span> <span class="n">time_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/eye/generation.py-228" name="src/oscura/analyzers/eye/generation.py-228"></a>        <span class="n">all_voltages</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-229" name="src/oscura/analyzers/eye/generation.py-229"></a>        <span class="n">all_times</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-230" name="src/oscura/analyzers/eye/generation.py-230"></a>        <span class="n">bins</span><span class="o">=</span><span class="n">histogram_bins</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-231" name="src/oscura/analyzers/eye/generation.py-231"></a>        <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">voltage_range</span><span class="p">,</span> <span class="n">time_range</span><span class="p">],</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/eye/generation.py-230" name="src/oscura/analyzers/eye/generation.py-230"></a>        <span class="n">bins</span><span class="o">=</span><span class="n">histogram_bins</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-231" name="src/oscura/analyzers/eye/generation.py-231"></a>        <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">voltage_range</span><span class="p">,</span> <span class="n">time_range</span><span class="p">],</span>
<a id="src/oscura/analyzers/eye/generation.py-232" name="src/oscura/analyzers/eye/generation.py-232"></a>    <span class="p">)</span>
<a id="src/oscura/analyzers/eye/generation.py-233" name="src/oscura/analyzers/eye/generation.py-233"></a>
<a id="src/oscura/analyzers/eye/generation.py-234" name="src/oscura/analyzers/eye/generation.py-234"></a><span class="hll">    <span class="k">return</span> <span class="n">histogram</span><span class="p">,</span> <span class="n">voltage_edges</span><span class="p">,</span> <span class="n">time_edges</span>
</span><a id="src/oscura/analyzers/eye/generation.py-235" name="src/oscura/analyzers/eye/generation.py-235"></a>
<a id="src/oscura/analyzers/eye/generation.py-236" name="src/oscura/analyzers/eye/generation.py-236"></a>
<a id="src/oscura/analyzers/eye/generation.py-237" name="src/oscura/analyzers/eye/generation.py-237"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_eye_from_edges</span><span class="p">(</span>
<a id="src/oscura/analyzers/eye/generation.py-238" name="src/oscura/analyzers/eye/generation.py-238"></a>    <span class="n">trace</span><span class="p">:</span> <span class="n">WaveformTrace</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/eye/generation.py-263" name="src/oscura/analyzers/eye/generation.py-263"></a><span class="sd">    Example:</span>
<a id="src/oscura/analyzers/eye/generation.py-264" name="src/oscura/analyzers/eye/generation.py-264"></a><span class="sd">        &gt;&gt;&gt; edges = recover_clock_edges(trace)</span>
<a id="src/oscura/analyzers/eye/generation.py-265" name="src/oscura/analyzers/eye/generation.py-265"></a><span class="sd">        &gt;&gt;&gt; eye = generate_eye_from_edges(trace, edges)</span>
<a id="src/oscura/analyzers/eye/generation.py-266" name="src/oscura/analyzers/eye/generation.py-266"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/eye/generation.py-267" name="src/oscura/analyzers/eye/generation.py-267"></a><span class="hll">    <span class="n">data</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span>
</span><a id="src/oscura/analyzers/eye/generation.py-268" name="src/oscura/analyzers/eye/generation.py-268"></a><span class="hll">    <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">sample_rate</span>
</span><a id="src/oscura/analyzers/eye/generation.py-269" name="src/oscura/analyzers/eye/generation.py-269"></a>
<a id="src/oscura/analyzers/eye/generation.py-270" name="src/oscura/analyzers/eye/generation.py-270"></a><span class="hll">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_timestamps</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-271" name="src/oscura/analyzers/eye/generation.py-271"></a><span class="hll">        <span class="k">raise</span> <span class="n">InsufficientDataError</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/eye/generation.py-272" name="src/oscura/analyzers/eye/generation.py-272"></a>            <span class="s2">&quot;Need at least 3 edge timestamps&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-273" name="src/oscura/analyzers/eye/generation.py-273"></a>            <span class="n">required</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-274" name="src/oscura/analyzers/eye/generation.py-274"></a>            <span class="n">available</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">edge_timestamps</span><span class="p">),</span>
<a id="src/oscura/analyzers/eye/generation.py-275" name="src/oscura/analyzers/eye/generation.py-275"></a>            <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;eye_diagram_generation&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/eye/generation.py-275" name="src/oscura/analyzers/eye/generation.py-275"></a>            <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;eye_diagram_generation&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-276" name="src/oscura/analyzers/eye/generation.py-276"></a>        <span class="p">)</span>
<a id="src/oscura/analyzers/eye/generation.py-277" name="src/oscura/analyzers/eye/generation.py-277"></a>
<a id="src/oscura/analyzers/eye/generation.py-278" name="src/oscura/analyzers/eye/generation.py-278"></a>    <span class="c1"># Calculate unit interval from edges</span>
<a id="src/oscura/analyzers/eye/generation.py-279" name="src/oscura/analyzers/eye/generation.py-279"></a><span class="hll">    <span class="n">periods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">edge_timestamps</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-280" name="src/oscura/analyzers/eye/generation.py-280"></a><span class="hll">    <span class="n">unit_interval</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">periods</span><span class="p">))</span>
</span><a id="src/oscura/analyzers/eye/generation.py-281" name="src/oscura/analyzers/eye/generation.py-281"></a>
<a id="src/oscura/analyzers/eye/generation.py-282" name="src/oscura/analyzers/eye/generation.py-282"></a>    <span class="c1"># Create time vector for original data</span>
<a id="src/oscura/analyzers/eye/generation.py-283" name="src/oscura/analyzers/eye/generation.py-283"></a><span class="hll">    <span class="n">original_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="n">sample_rate</span>
</span><a id="src/oscura/analyzers/eye/generation.py-284" name="src/oscura/analyzers/eye/generation.py-284"></a>
<a id="src/oscura/analyzers/eye/generation.py-285" name="src/oscura/analyzers/eye/generation.py-285"></a>    <span class="c1"># Extract and resample traces around each edge</span>
<a id="src/oscura/analyzers/eye/generation.py-286" name="src/oscura/analyzers/eye/generation.py-286"></a><span class="hll">    <span class="n">eye_traces</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/oscura/analyzers/eye/generation.py-287" name="src/oscura/analyzers/eye/generation.py-287"></a><span class="hll">    <span class="n">total_samples</span> <span class="o">=</span> <span class="n">samples_per_ui</span> <span class="o">*</span> <span class="n">n_ui</span>
</span><a id="src/oscura/analyzers/eye/generation.py-288" name="src/oscura/analyzers/eye/generation.py-288"></a><span class="hll">    <span class="n">half_ui</span> <span class="o">=</span> <span class="n">unit_interval</span> <span class="o">/</span> <span class="mi">2</span>
</span><a id="src/oscura/analyzers/eye/generation.py-289" name="src/oscura/analyzers/eye/generation.py-289"></a>
<a id="src/oscura/analyzers/eye/generation.py-290" name="src/oscura/analyzers/eye/generation.py-290"></a><span class="hll">    <span class="k">for</span> <span class="n">edge_time</span> <span class="ow">in</span> <span class="n">edge_timestamps</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-291" name="src/oscura/analyzers/eye/generation.py-291"></a>        <span class="c1"># Define window around edge</span>
<a id="src/oscura/analyzers/eye/generation.py-292" name="src/oscura/analyzers/eye/generation.py-292"></a><span class="hll">        <span class="n">start_time</span> <span class="o">=</span> <span class="n">edge_time</span> <span class="o">-</span> <span class="n">half_ui</span>
</span><a id="src/oscura/analyzers/eye/generation.py-293" name="src/oscura/analyzers/eye/generation.py-293"></a><span class="hll">        <span class="n">end_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">unit_interval</span> <span class="o">*</span> <span class="n">n_ui</span>
</span><a id="src/oscura/analyzers/eye/generation.py-294" name="src/oscura/analyzers/eye/generation.py-294"></a>
<a id="src/oscura/analyzers/eye/generation.py-295" name="src/oscura/analyzers/eye/generation.py-295"></a><span class="hll">        <span class="k">if</span> <span class="n">start_time</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">end_time</span> <span class="o">&gt;</span> <span class="n">original_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-296" name="src/oscura/analyzers/eye/generation.py-296"></a><span class="hll">            <span class="k">continue</span>
</span><a id="src/oscura/analyzers/eye/generation.py-297" name="src/oscura/analyzers/eye/generation.py-297"></a>
<a id="src/oscura/analyzers/eye/generation.py-298" name="src/oscura/analyzers/eye/generation.py-298"></a>        <span class="c1"># Find samples within window</span>
<a id="src/oscura/analyzers/eye/generation.py-299" name="src/oscura/analyzers/eye/generation.py-299"></a><span class="hll">        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">original_time</span> <span class="o">&gt;=</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">original_time</span> <span class="o">&lt;=</span> <span class="n">end_time</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-300" name="src/oscura/analyzers/eye/generation.py-300"></a><span class="hll">        <span class="n">window_time</span> <span class="o">=</span> <span class="n">original_time</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">start_time</span>
</span><a id="src/oscura/analyzers/eye/generation.py-301" name="src/oscura/analyzers/eye/generation.py-301"></a><span class="hll">        <span class="n">window_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><a id="src/oscura/analyzers/eye/generation.py-302" name="src/oscura/analyzers/eye/generation.py-302"></a>
<a id="src/oscura/analyzers/eye/generation.py-303" name="src/oscura/analyzers/eye/generation.py-303"></a><span class="hll">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">window_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-304" name="src/oscura/analyzers/eye/generation.py-304"></a><span class="hll">            <span class="k">continue</span>
</span><a id="src/oscura/analyzers/eye/generation.py-305" name="src/oscura/analyzers/eye/generation.py-305"></a>
<a id="src/oscura/analyzers/eye/generation.py-306" name="src/oscura/analyzers/eye/generation.py-306"></a>        <span class="c1"># Resample to consistent samples_per_ui</span>
<a id="src/oscura/analyzers/eye/generation.py-307" name="src/oscura/analyzers/eye/generation.py-307"></a><span class="hll">        <span class="n">resample_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">unit_interval</span> <span class="o">*</span> <span class="n">n_ui</span><span class="p">,</span> <span class="n">total_samples</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-308" name="src/oscura/analyzers/eye/generation.py-308"></a><span class="hll">        <span class="n">resampled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">resample_time</span><span class="p">,</span> <span class="n">window_time</span><span class="p">,</span> <span class="n">window_data</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-309" name="src/oscura/analyzers/eye/generation.py-309"></a>
<a id="src/oscura/analyzers/eye/generation.py-310" name="src/oscura/analyzers/eye/generation.py-310"></a><span class="hll">        <span class="n">eye_traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resampled</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-311" name="src/oscura/analyzers/eye/generation.py-311"></a>
<a id="src/oscura/analyzers/eye/generation.py-312" name="src/oscura/analyzers/eye/generation.py-312"></a><span class="hll">        <span class="k">if</span> <span class="n">max_traces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">eye_traces</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">max_traces</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-313" name="src/oscura/analyzers/eye/generation.py-313"></a><span class="hll">            <span class="k">break</span>
</span><a id="src/oscura/analyzers/eye/generation.py-314" name="src/oscura/analyzers/eye/generation.py-314"></a>
<a id="src/oscura/analyzers/eye/generation.py-315" name="src/oscura/analyzers/eye/generation.py-315"></a><span class="hll">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eye_traces</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-316" name="src/oscura/analyzers/eye/generation.py-316"></a><span class="hll">        <span class="k">raise</span> <span class="n">InsufficientDataError</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/eye/generation.py-317" name="src/oscura/analyzers/eye/generation.py-317"></a>            <span class="s2">&quot;Could not extract any eye traces&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-318" name="src/oscura/analyzers/eye/generation.py-318"></a>            <span class="n">required</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-319" name="src/oscura/analyzers/eye/generation.py-319"></a>            <span class="n">available</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-320" name="src/oscura/analyzers/eye/generation.py-320"></a>            <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;eye_diagram_generation&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/eye/generation.py-319" name="src/oscura/analyzers/eye/generation.py-319"></a>            <span class="n">available</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-320" name="src/oscura/analyzers/eye/generation.py-320"></a>            <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;eye_diagram_generation&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-321" name="src/oscura/analyzers/eye/generation.py-321"></a>        <span class="p">)</span>
<a id="src/oscura/analyzers/eye/generation.py-322" name="src/oscura/analyzers/eye/generation.py-322"></a>
<a id="src/oscura/analyzers/eye/generation.py-323" name="src/oscura/analyzers/eye/generation.py-323"></a><span class="hll">    <span class="n">eye_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eye_traces</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-324" name="src/oscura/analyzers/eye/generation.py-324"></a><span class="hll">    <span class="n">time_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_ui</span><span class="p">,</span> <span class="n">total_samples</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-325" name="src/oscura/analyzers/eye/generation.py-325"></a>
<a id="src/oscura/analyzers/eye/generation.py-326" name="src/oscura/analyzers/eye/generation.py-326"></a><span class="hll">    <span class="k">return</span> <span class="n">EyeDiagram</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/eye/generation.py-327" name="src/oscura/analyzers/eye/generation.py-327"></a>        <span class="n">data</span><span class="o">=</span><span class="n">eye_data</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-328" name="src/oscura/analyzers/eye/generation.py-328"></a>        <span class="n">time_axis</span><span class="o">=</span><span class="n">time_axis</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-329" name="src/oscura/analyzers/eye/generation.py-329"></a>        <span class="n">unit_interval</span><span class="o">=</span><span class="n">unit_interval</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-330" name="src/oscura/analyzers/eye/generation.py-330"></a>        <span class="n">samples_per_ui</span><span class="o">=</span><span class="n">samples_per_ui</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/eye/generation.py-342" name="src/oscura/analyzers/eye/generation.py-342"></a>
<a id="src/oscura/analyzers/eye/generation.py-343" name="src/oscura/analyzers/eye/generation.py-343"></a><span class="sd">    Returns:</span>
<a id="src/oscura/analyzers/eye/generation.py-344" name="src/oscura/analyzers/eye/generation.py-344"></a><span class="sd">        Threshold value.</span>
<a id="src/oscura/analyzers/eye/generation.py-345" name="src/oscura/analyzers/eye/generation.py-345"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/eye/generation.py-346" name="src/oscura/analyzers/eye/generation.py-346"></a><span class="hll">    <span class="n">low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-347" name="src/oscura/analyzers/eye/generation.py-347"></a><span class="hll">    <span class="n">high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-348" name="src/oscura/analyzers/eye/generation.py-348"></a><span class="hll">    <span class="n">amplitude_range</span> <span class="o">=</span> <span class="n">high</span> <span class="o">-</span> <span class="n">low</span>
</span><a id="src/oscura/analyzers/eye/generation.py-349" name="src/oscura/analyzers/eye/generation.py-349"></a><span class="hll">    <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">trigger_fraction</span> <span class="o">*</span> <span class="n">amplitude_range</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-350" name="src/oscura/analyzers/eye/generation.py-350"></a><span class="hll">    <span class="k">return</span> <span class="n">threshold</span>
</span><a id="src/oscura/analyzers/eye/generation.py-351" name="src/oscura/analyzers/eye/generation.py-351"></a>
<a id="src/oscura/analyzers/eye/generation.py-352" name="src/oscura/analyzers/eye/generation.py-352"></a>
<a id="src/oscura/analyzers/eye/generation.py-353" name="src/oscura/analyzers/eye/generation.py-353"></a><span class="k">def</span><span class="w"> </span><span class="nf">_find_trace_crossings</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="src/oscura/analyzers/eye/generation.py-354" name="src/oscura/analyzers/eye/generation.py-354"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find crossing indices for all traces.</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/eye/generation.py-359" name="src/oscura/analyzers/eye/generation.py-359"></a>
<a id="src/oscura/analyzers/eye/generation.py-360" name="src/oscura/analyzers/eye/generation.py-360"></a><span class="sd">    Returns:</span>
<a id="src/oscura/analyzers/eye/generation.py-361" name="src/oscura/analyzers/eye/generation.py-361"></a><span class="sd">        List of crossing indices for traces with crossings.</span>
<a id="src/oscura/analyzers/eye/generation.py-362" name="src/oscura/analyzers/eye/generation.py-362"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/eye/generation.py-363" name="src/oscura/analyzers/eye/generation.py-363"></a><span class="hll">    <span class="n">n_traces</span><span class="p">,</span> <span class="n">_samples_per_trace</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</span><a id="src/oscura/analyzers/eye/generation.py-364" name="src/oscura/analyzers/eye/generation.py-364"></a><span class="hll">    <span class="n">crossing_indices</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/oscura/analyzers/eye/generation.py-365" name="src/oscura/analyzers/eye/generation.py-365"></a>
<a id="src/oscura/analyzers/eye/generation.py-366" name="src/oscura/analyzers/eye/generation.py-366"></a><span class="hll">    <span class="k">for</span> <span class="n">trace_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_traces</span><span class="p">):</span>
</span><a id="src/oscura/analyzers/eye/generation.py-367" name="src/oscura/analyzers/eye/generation.py-367"></a><span class="hll">        <span class="n">trace</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">trace_idx</span><span class="p">,</span> <span class="p">:]</span>
</span><a id="src/oscura/analyzers/eye/generation.py-368" name="src/oscura/analyzers/eye/generation.py-368"></a><span class="hll">        <span class="n">crossings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">trace</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><a id="src/oscura/analyzers/eye/generation.py-369" name="src/oscura/analyzers/eye/generation.py-369"></a>
<a id="src/oscura/analyzers/eye/generation.py-370" name="src/oscura/analyzers/eye/generation.py-370"></a><span class="hll">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">crossings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-371" name="src/oscura/analyzers/eye/generation.py-371"></a><span class="hll">            <span class="n">crossing_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">crossings</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><a id="src/oscura/analyzers/eye/generation.py-372" name="src/oscura/analyzers/eye/generation.py-372"></a>
<a id="src/oscura/analyzers/eye/generation.py-373" name="src/oscura/analyzers/eye/generation.py-373"></a><span class="hll">    <span class="k">return</span> <span class="n">crossing_indices</span>
</span><a id="src/oscura/analyzers/eye/generation.py-374" name="src/oscura/analyzers/eye/generation.py-374"></a>
<a id="src/oscura/analyzers/eye/generation.py-375" name="src/oscura/analyzers/eye/generation.py-375"></a>
<a id="src/oscura/analyzers/eye/generation.py-376" name="src/oscura/analyzers/eye/generation.py-376"></a><span class="k">def</span><span class="w"> </span><span class="nf">_align_traces_to_target</span><span class="p">(</span>
<a id="src/oscura/analyzers/eye/generation.py-377" name="src/oscura/analyzers/eye/generation.py-377"></a>    <span class="n">data</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">target_crossing</span><span class="p">:</span> <span class="nb">int</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/eye/generation.py-385" name="src/oscura/analyzers/eye/generation.py-385"></a>
<a id="src/oscura/analyzers/eye/generation.py-386" name="src/oscura/analyzers/eye/generation.py-386"></a><span class="sd">    Returns:</span>
<a id="src/oscura/analyzers/eye/generation.py-387" name="src/oscura/analyzers/eye/generation.py-387"></a><span class="sd">        Aligned trace data.</span>
<a id="src/oscura/analyzers/eye/generation.py-388" name="src/oscura/analyzers/eye/generation.py-388"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/eye/generation.py-389" name="src/oscura/analyzers/eye/generation.py-389"></a><span class="hll">    <span class="n">n_traces</span><span class="p">,</span> <span class="n">_samples_per_trace</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</span><a id="src/oscura/analyzers/eye/generation.py-390" name="src/oscura/analyzers/eye/generation.py-390"></a><span class="hll">    <span class="n">aligned_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-391" name="src/oscura/analyzers/eye/generation.py-391"></a>
<a id="src/oscura/analyzers/eye/generation.py-392" name="src/oscura/analyzers/eye/generation.py-392"></a><span class="hll">    <span class="k">for</span> <span class="n">trace_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_traces</span><span class="p">):</span>
</span><a id="src/oscura/analyzers/eye/generation.py-393" name="src/oscura/analyzers/eye/generation.py-393"></a><span class="hll">        <span class="n">trace</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">trace_idx</span><span class="p">,</span> <span class="p">:]</span>
</span><a id="src/oscura/analyzers/eye/generation.py-394" name="src/oscura/analyzers/eye/generation.py-394"></a><span class="hll">        <span class="n">crossings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">trace</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><a id="src/oscura/analyzers/eye/generation.py-395" name="src/oscura/analyzers/eye/generation.py-395"></a>
<a id="src/oscura/analyzers/eye/generation.py-396" name="src/oscura/analyzers/eye/generation.py-396"></a><span class="hll">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">crossings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-397" name="src/oscura/analyzers/eye/generation.py-397"></a><span class="hll">            <span class="n">crossing</span> <span class="o">=</span> <span class="n">crossings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><a id="src/oscura/analyzers/eye/generation.py-398" name="src/oscura/analyzers/eye/generation.py-398"></a><span class="hll">            <span class="n">shift</span> <span class="o">=</span> <span class="n">target_crossing</span> <span class="o">-</span> <span class="n">crossing</span>
</span><a id="src/oscura/analyzers/eye/generation.py-399" name="src/oscura/analyzers/eye/generation.py-399"></a>
<a id="src/oscura/analyzers/eye/generation.py-400" name="src/oscura/analyzers/eye/generation.py-400"></a><span class="hll">            <span class="k">if</span> <span class="n">shift</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-401" name="src/oscura/analyzers/eye/generation.py-401"></a><span class="hll">                <span class="n">aligned_data</span><span class="p">[</span><span class="n">trace_idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">shift</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-402" name="src/oscura/analyzers/eye/generation.py-402"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/analyzers/eye/generation.py-403" name="src/oscura/analyzers/eye/generation.py-403"></a><span class="hll">                <span class="n">aligned_data</span><span class="p">[</span><span class="n">trace_idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">trace</span>
</span><a id="src/oscura/analyzers/eye/generation.py-404" name="src/oscura/analyzers/eye/generation.py-404"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/analyzers/eye/generation.py-405" name="src/oscura/analyzers/eye/generation.py-405"></a><span class="hll">            <span class="n">aligned_data</span><span class="p">[</span><span class="n">trace_idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">trace</span>
</span><a id="src/oscura/analyzers/eye/generation.py-406" name="src/oscura/analyzers/eye/generation.py-406"></a>
<a id="src/oscura/analyzers/eye/generation.py-407" name="src/oscura/analyzers/eye/generation.py-407"></a><span class="hll">    <span class="k">return</span> <span class="n">aligned_data</span>
</span><a id="src/oscura/analyzers/eye/generation.py-408" name="src/oscura/analyzers/eye/generation.py-408"></a>
<a id="src/oscura/analyzers/eye/generation.py-409" name="src/oscura/analyzers/eye/generation.py-409"></a>
<a id="src/oscura/analyzers/eye/generation.py-410" name="src/oscura/analyzers/eye/generation.py-410"></a><span class="k">def</span><span class="w"> </span><span class="nf">_apply_symmetric_centering</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
<a id="src/oscura/analyzers/eye/generation.py-411" name="src/oscura/analyzers/eye/generation.py-411"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply symmetric amplitude centering if enabled.</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/eye/generation.py-415" name="src/oscura/analyzers/eye/generation.py-415"></a>
<a id="src/oscura/analyzers/eye/generation.py-416" name="src/oscura/analyzers/eye/generation.py-416"></a><span class="sd">    Returns:</span>
<a id="src/oscura/analyzers/eye/generation.py-417" name="src/oscura/analyzers/eye/generation.py-417"></a><span class="sd">        Symmetrically centered data.</span>
<a id="src/oscura/analyzers/eye/generation.py-418" name="src/oscura/analyzers/eye/generation.py-418"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/eye/generation.py-419" name="src/oscura/analyzers/eye/generation.py-419"></a><span class="hll">    <span class="n">max_abs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><a id="src/oscura/analyzers/eye/generation.py-420" name="src/oscura/analyzers/eye/generation.py-420"></a><span class="hll">    <span class="k">if</span> <span class="n">max_abs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-421" name="src/oscura/analyzers/eye/generation.py-421"></a><span class="hll">        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-422" name="src/oscura/analyzers/eye/generation.py-422"></a><span class="hll">    <span class="k">return</span> <span class="n">data</span>
</span><a id="src/oscura/analyzers/eye/generation.py-423" name="src/oscura/analyzers/eye/generation.py-423"></a>
<a id="src/oscura/analyzers/eye/generation.py-424" name="src/oscura/analyzers/eye/generation.py-424"></a>
<a id="src/oscura/analyzers/eye/generation.py-425" name="src/oscura/analyzers/eye/generation.py-425"></a><span class="k">def</span><span class="w"> </span><span class="nf">auto_center_eye_diagram</span><span class="p">(</span>
<a id="src/oscura/analyzers/eye/generation.py-426" name="src/oscura/analyzers/eye/generation.py-426"></a>    <span class="n">eye</span><span class="p">:</span> <span class="n">EyeDiagram</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/eye/generation.py-452" name="src/oscura/analyzers/eye/generation.py-452"></a>
<a id="src/oscura/analyzers/eye/generation.py-453" name="src/oscura/analyzers/eye/generation.py-453"></a><span class="sd">    References:</span>
<a id="src/oscura/analyzers/eye/generation.py-454" name="src/oscura/analyzers/eye/generation.py-454"></a><span class="sd">        VIS-021: Eye Diagram Auto-Centering</span>
<a id="src/oscura/analyzers/eye/generation.py-455" name="src/oscura/analyzers/eye/generation.py-455"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/eye/generation.py-456" name="src/oscura/analyzers/eye/generation.py-456"></a><span class="hll">    <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">trigger_fraction</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-457" name="src/oscura/analyzers/eye/generation.py-457"></a><span class="hll">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;trigger_fraction must be in [0, 1], got </span><span class="si">{</span><span class="n">trigger_fraction</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-458" name="src/oscura/analyzers/eye/generation.py-458"></a>
<a id="src/oscura/analyzers/eye/generation.py-459" name="src/oscura/analyzers/eye/generation.py-459"></a>    <span class="c1"># Setup: calculate threshold and find crossings</span>
<a id="src/oscura/analyzers/eye/generation.py-460" name="src/oscura/analyzers/eye/generation.py-460"></a><span class="hll">    <span class="n">data</span> <span class="o">=</span> <span class="n">eye</span><span class="o">.</span><span class="n">data</span>
</span><a id="src/oscura/analyzers/eye/generation.py-461" name="src/oscura/analyzers/eye/generation.py-461"></a><span class="hll">    <span class="n">threshold</span> <span class="o">=</span> <span class="n">_calculate_trigger_threshold</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">trigger_fraction</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-462" name="src/oscura/analyzers/eye/generation.py-462"></a><span class="hll">    <span class="n">crossing_indices</span> <span class="o">=</span> <span class="n">_find_trace_crossings</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-463" name="src/oscura/analyzers/eye/generation.py-463"></a>
<a id="src/oscura/analyzers/eye/generation.py-464" name="src/oscura/analyzers/eye/generation.py-464"></a><span class="hll">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">crossing_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-465" name="src/oscura/analyzers/eye/generation.py-465"></a><span class="hll">        <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</span><a id="src/oscura/analyzers/eye/generation.py-466" name="src/oscura/analyzers/eye/generation.py-466"></a>
<a id="src/oscura/analyzers/eye/generation.py-467" name="src/oscura/analyzers/eye/generation.py-467"></a><span class="hll">        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/eye/generation.py-468" name="src/oscura/analyzers/eye/generation.py-468"></a>            <span class="s2">&quot;No crossing points found, cannot auto-center eye diagram&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-469" name="src/oscura/analyzers/eye/generation.py-469"></a>            <span class="ne">UserWarning</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-470" name="src/oscura/analyzers/eye/generation.py-470"></a>            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-471" name="src/oscura/analyzers/eye/generation.py-471"></a>        <span class="p">)</span>
<a id="src/oscura/analyzers/eye/generation.py-472" name="src/oscura/analyzers/eye/generation.py-472"></a><span class="hll">        <span class="k">return</span> <span class="n">eye</span>
</span><a id="src/oscura/analyzers/eye/generation.py-473" name="src/oscura/analyzers/eye/generation.py-473"></a>
<a id="src/oscura/analyzers/eye/generation.py-474" name="src/oscura/analyzers/eye/generation.py-474"></a>    <span class="c1"># Processing: align traces to target crossing point</span>
<a id="src/oscura/analyzers/eye/generation.py-475" name="src/oscura/analyzers/eye/generation.py-475"></a><span class="hll">    <span class="n">_n_traces</span><span class="p">,</span> <span class="n">samples_per_trace</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</span><a id="src/oscura/analyzers/eye/generation.py-476" name="src/oscura/analyzers/eye/generation.py-476"></a><span class="hll">    <span class="n">target_crossing</span> <span class="o">=</span> <span class="n">samples_per_trace</span> <span class="o">//</span> <span class="mi">2</span>
</span><a id="src/oscura/analyzers/eye/generation.py-477" name="src/oscura/analyzers/eye/generation.py-477"></a><span class="hll">    <span class="n">aligned_data</span> <span class="o">=</span> <span class="n">_align_traces_to_target</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">target_crossing</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-478" name="src/oscura/analyzers/eye/generation.py-478"></a>
<a id="src/oscura/analyzers/eye/generation.py-479" name="src/oscura/analyzers/eye/generation.py-479"></a>    <span class="c1"># Result building: apply symmetric centering and create result</span>
<a id="src/oscura/analyzers/eye/generation.py-480" name="src/oscura/analyzers/eye/generation.py-480"></a><span class="hll">    <span class="k">if</span> <span class="n">symmetric_range</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/eye/generation.py-481" name="src/oscura/analyzers/eye/generation.py-481"></a><span class="hll">        <span class="n">aligned_data</span> <span class="o">=</span> <span class="n">_apply_symmetric_centering</span><span class="p">(</span><span class="n">aligned_data</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/eye/generation.py-482" name="src/oscura/analyzers/eye/generation.py-482"></a>
<a id="src/oscura/analyzers/eye/generation.py-483" name="src/oscura/analyzers/eye/generation.py-483"></a><span class="hll">    <span class="k">return</span> <span class="n">EyeDiagram</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/eye/generation.py-484" name="src/oscura/analyzers/eye/generation.py-484"></a>        <span class="n">data</span><span class="o">=</span><span class="n">aligned_data</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-485" name="src/oscura/analyzers/eye/generation.py-485"></a>        <span class="n">time_axis</span><span class="o">=</span><span class="n">eye</span><span class="o">.</span><span class="n">time_axis</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-486" name="src/oscura/analyzers/eye/generation.py-486"></a>        <span class="n">unit_interval</span><span class="o">=</span><span class="n">eye</span><span class="o">.</span><span class="n">unit_interval</span><span class="p">,</span>
<a id="src/oscura/analyzers/eye/generation.py-487" name="src/oscura/analyzers/eye/generation.py-487"></a>        <span class="n">samples_per_ui</span><span class="o">=</span><span class="n">eye</span><span class="o">.</span><span class="n">samples_per_ui</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/oscura/analyzers/jitter/timing.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/jitter/timing.py-97" name="src/oscura/analyzers/jitter/timing.py-97"></a>
<a id="src/oscura/analyzers/jitter/timing.py-98" name="src/oscura/analyzers/jitter/timing.py-98"></a><span class="sd">    References:</span>
<a id="src/oscura/analyzers/jitter/timing.py-99" name="src/oscura/analyzers/jitter/timing.py-99"></a><span class="sd">        IEEE 2414-2020 Section 4.2: Time Interval Error Definition</span>
<a id="src/oscura/analyzers/jitter/timing.py-100" name="src/oscura/analyzers/jitter/timing.py-100"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/jitter/timing.py-101" name="src/oscura/analyzers/jitter/timing.py-101"></a><span class="hll">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_timestamps</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-102" name="src/oscura/analyzers/jitter/timing.py-102"></a><span class="hll">        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-103" name="src/oscura/analyzers/jitter/timing.py-103"></a>
<a id="src/oscura/analyzers/jitter/timing.py-104" name="src/oscura/analyzers/jitter/timing.py-104"></a>    <span class="c1"># Calculate actual periods</span>
<a id="src/oscura/analyzers/jitter/timing.py-105" name="src/oscura/analyzers/jitter/timing.py-105"></a><span class="hll">    <span class="n">periods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">edge_timestamps</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-106" name="src/oscura/analyzers/jitter/timing.py-106"></a>
<a id="src/oscura/analyzers/jitter/timing.py-107" name="src/oscura/analyzers/jitter/timing.py-107"></a>    <span class="c1"># Use mean period if nominal not provided</span>
<a id="src/oscura/analyzers/jitter/timing.py-108" name="src/oscura/analyzers/jitter/timing.py-108"></a><span class="hll">    <span class="k">if</span> <span class="n">nominal_period</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-109" name="src/oscura/analyzers/jitter/timing.py-109"></a><span class="hll">        <span class="n">nominal_period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">periods</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-110" name="src/oscura/analyzers/jitter/timing.py-110"></a>
<a id="src/oscura/analyzers/jitter/timing.py-111" name="src/oscura/analyzers/jitter/timing.py-111"></a>    <span class="c1"># Calculate ideal edge positions</span>
<a id="src/oscura/analyzers/jitter/timing.py-112" name="src/oscura/analyzers/jitter/timing.py-112"></a><span class="hll">    <span class="n">n_edges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_timestamps</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-113" name="src/oscura/analyzers/jitter/timing.py-113"></a><span class="hll">    <span class="n">start_time</span> <span class="o">=</span> <span class="n">edge_timestamps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-114" name="src/oscura/analyzers/jitter/timing.py-114"></a><span class="hll">    <span class="n">ideal_positions</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_edges</span><span class="p">)</span> <span class="o">*</span> <span class="n">nominal_period</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-115" name="src/oscura/analyzers/jitter/timing.py-115"></a>
<a id="src/oscura/analyzers/jitter/timing.py-116" name="src/oscura/analyzers/jitter/timing.py-116"></a>    <span class="c1"># TIE is actual - ideal</span>
<a id="src/oscura/analyzers/jitter/timing.py-117" name="src/oscura/analyzers/jitter/timing.py-117"></a><span class="hll">    <span class="n">tie</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_timestamps</span> <span class="o">-</span> <span class="n">ideal_positions</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-118" name="src/oscura/analyzers/jitter/timing.py-118"></a>
<a id="src/oscura/analyzers/jitter/timing.py-119" name="src/oscura/analyzers/jitter/timing.py-119"></a><span class="hll">    <span class="k">return</span> <span class="n">tie</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-120" name="src/oscura/analyzers/jitter/timing.py-120"></a>
<a id="src/oscura/analyzers/jitter/timing.py-121" name="src/oscura/analyzers/jitter/timing.py-121"></a>
<a id="src/oscura/analyzers/jitter/timing.py-122" name="src/oscura/analyzers/jitter/timing.py-122"></a><span class="k">def</span><span class="w"> </span><span class="nf">cycle_to_cycle_jitter</span><span class="p">(</span>
<a id="src/oscura/analyzers/jitter/timing.py-123" name="src/oscura/analyzers/jitter/timing.py-123"></a>    <span class="n">periods</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/jitter/timing.py-148" name="src/oscura/analyzers/jitter/timing.py-148"></a><span class="sd">    References:</span>
<a id="src/oscura/analyzers/jitter/timing.py-149" name="src/oscura/analyzers/jitter/timing.py-149"></a><span class="sd">        IEEE 2414-2020 Section 5.3: Cycle-to-Cycle Jitter</span>
<a id="src/oscura/analyzers/jitter/timing.py-150" name="src/oscura/analyzers/jitter/timing.py-150"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/jitter/timing.py-151" name="src/oscura/analyzers/jitter/timing.py-151"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">periods</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
<a id="src/oscura/analyzers/jitter/timing.py-152" name="src/oscura/analyzers/jitter/timing.py-152"></a><span class="hll">        <span class="k">raise</span> <span class="n">InsufficientDataError</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-153" name="src/oscura/analyzers/jitter/timing.py-153"></a>            <span class="s2">&quot;Cycle-to-cycle jitter requires at least 3 periods&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/jitter/timing.py-154" name="src/oscura/analyzers/jitter/timing.py-154"></a>            <span class="n">required</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="src/oscura/analyzers/jitter/timing.py-155" name="src/oscura/analyzers/jitter/timing.py-155"></a>            <span class="n">available</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">periods</span><span class="p">),</span>
<a id="src/oscura/analyzers/jitter/timing.py-156" name="src/oscura/analyzers/jitter/timing.py-156"></a>            <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;cycle_to_cycle_jitter&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/jitter/timing.py-159" name="src/oscura/analyzers/jitter/timing.py-159"></a>    <span class="c1"># Remove NaN values</span>
<a id="src/oscura/analyzers/jitter/timing.py-160" name="src/oscura/analyzers/jitter/timing.py-160"></a>    <span class="n">valid_periods</span> <span class="o">=</span> <span class="n">periods</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">periods</span><span class="p">)]</span>
<a id="src/oscura/analyzers/jitter/timing.py-161" name="src/oscura/analyzers/jitter/timing.py-161"></a>
<a id="src/oscura/analyzers/jitter/timing.py-162" name="src/oscura/analyzers/jitter/timing.py-162"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_periods</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
<a id="src/oscura/analyzers/jitter/timing.py-163" name="src/oscura/analyzers/jitter/timing.py-163"></a><span class="hll">        <span class="k">raise</span> <span class="n">InsufficientDataError</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-164" name="src/oscura/analyzers/jitter/timing.py-164"></a>            <span class="s2">&quot;Cycle-to-cycle jitter requires at least 3 valid periods&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/jitter/timing.py-165" name="src/oscura/analyzers/jitter/timing.py-165"></a>            <span class="n">required</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="src/oscura/analyzers/jitter/timing.py-166" name="src/oscura/analyzers/jitter/timing.py-166"></a>            <span class="n">available</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">valid_periods</span><span class="p">),</span>
<a id="src/oscura/analyzers/jitter/timing.py-167" name="src/oscura/analyzers/jitter/timing.py-167"></a>            <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;cycle_to_cycle_jitter&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/jitter/timing.py-180" name="src/oscura/analyzers/jitter/timing.py-180"></a>    <span class="k">if</span> <span class="n">include_histogram</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">c2c_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
<a id="src/oscura/analyzers/jitter/timing.py-181" name="src/oscura/analyzers/jitter/timing.py-181"></a>        <span class="n">hist</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">c2c_values</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="src/oscura/analyzers/jitter/timing.py-182" name="src/oscura/analyzers/jitter/timing.py-182"></a>        <span class="n">bin_centers</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
<a id="src/oscura/analyzers/jitter/timing.py-183" name="src/oscura/analyzers/jitter/timing.py-183"></a>    <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/analyzers/jitter/timing.py-184" name="src/oscura/analyzers/jitter/timing.py-184"></a><span class="hll">        <span class="n">hist</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-185" name="src/oscura/analyzers/jitter/timing.py-185"></a><span class="hll">        <span class="n">bin_centers</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-186" name="src/oscura/analyzers/jitter/timing.py-186"></a>
<a id="src/oscura/analyzers/jitter/timing.py-187" name="src/oscura/analyzers/jitter/timing.py-187"></a>    <span class="k">return</span> <span class="n">CycleJitterResult</span><span class="p">(</span>
<a id="src/oscura/analyzers/jitter/timing.py-188" name="src/oscura/analyzers/jitter/timing.py-188"></a>        <span class="n">c2c_rms</span><span class="o">=</span><span class="n">c2c_rms</span><span class="p">,</span>
<a id="src/oscura/analyzers/jitter/timing.py-189" name="src/oscura/analyzers/jitter/timing.py-189"></a>        <span class="n">c2c_pp</span><span class="o">=</span><span class="n">c2c_pp</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/jitter/timing.py-222" name="src/oscura/analyzers/jitter/timing.py-222"></a><span class="sd">    References:</span>
<a id="src/oscura/analyzers/jitter/timing.py-223" name="src/oscura/analyzers/jitter/timing.py-223"></a><span class="sd">        IEEE 2414-2020 Section 5.2: Period Jitter</span>
<a id="src/oscura/analyzers/jitter/timing.py-224" name="src/oscura/analyzers/jitter/timing.py-224"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/jitter/timing.py-225" name="src/oscura/analyzers/jitter/timing.py-225"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">periods</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="src/oscura/analyzers/jitter/timing.py-226" name="src/oscura/analyzers/jitter/timing.py-226"></a><span class="hll">        <span class="k">raise</span> <span class="n">InsufficientDataError</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-227" name="src/oscura/analyzers/jitter/timing.py-227"></a>            <span class="s2">&quot;Period jitter requires at least 2 periods&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/jitter/timing.py-228" name="src/oscura/analyzers/jitter/timing.py-228"></a>            <span class="n">required</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="src/oscura/analyzers/jitter/timing.py-229" name="src/oscura/analyzers/jitter/timing.py-229"></a>            <span class="n">available</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">periods</span><span class="p">),</span>
<a id="src/oscura/analyzers/jitter/timing.py-230" name="src/oscura/analyzers/jitter/timing.py-230"></a>            <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;period_jitter&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/jitter/timing.py-232" name="src/oscura/analyzers/jitter/timing.py-232"></a>
<a id="src/oscura/analyzers/jitter/timing.py-233" name="src/oscura/analyzers/jitter/timing.py-233"></a>    <span class="n">valid_periods</span> <span class="o">=</span> <span class="n">periods</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">periods</span><span class="p">)]</span>
<a id="src/oscura/analyzers/jitter/timing.py-234" name="src/oscura/analyzers/jitter/timing.py-234"></a>
<a id="src/oscura/analyzers/jitter/timing.py-235" name="src/oscura/analyzers/jitter/timing.py-235"></a>    <span class="k">if</span> <span class="n">nominal_period</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/oscura/analyzers/jitter/timing.py-236" name="src/oscura/analyzers/jitter/timing.py-236"></a><span class="hll">        <span class="n">nominal_period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">valid_periods</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-237" name="src/oscura/analyzers/jitter/timing.py-237"></a>
<a id="src/oscura/analyzers/jitter/timing.py-238" name="src/oscura/analyzers/jitter/timing.py-238"></a>    <span class="c1"># Calculate deviations from nominal</span>
<a id="src/oscura/analyzers/jitter/timing.py-239" name="src/oscura/analyzers/jitter/timing.py-239"></a>    <span class="n">deviations</span> <span class="o">=</span> <span class="n">valid_periods</span> <span class="o">-</span> <span class="n">nominal_period</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/jitter/timing.py-304" name="src/oscura/analyzers/jitter/timing.py-304"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">next_rising</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="src/oscura/analyzers/jitter/timing.py-305" name="src/oscura/analyzers/jitter/timing.py-305"></a>            <span class="n">low_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_rising</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">f_edge</span><span class="p">)</span>
<a id="src/oscura/analyzers/jitter/timing.py-306" name="src/oscura/analyzers/jitter/timing.py-306"></a>
<a id="src/oscura/analyzers/jitter/timing.py-307" name="src/oscura/analyzers/jitter/timing.py-307"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">high_times</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">low_times</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="src/oscura/analyzers/jitter/timing.py-308" name="src/oscura/analyzers/jitter/timing.py-308"></a><span class="hll">        <span class="k">raise</span> <span class="n">InsufficientDataError</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-309" name="src/oscura/analyzers/jitter/timing.py-309"></a>            <span class="s2">&quot;Could not measure high/low times&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/jitter/timing.py-310" name="src/oscura/analyzers/jitter/timing.py-310"></a>            <span class="n">required</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="src/oscura/analyzers/jitter/timing.py-311" name="src/oscura/analyzers/jitter/timing.py-311"></a>            <span class="n">available</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="src/oscura/analyzers/jitter/timing.py-312" name="src/oscura/analyzers/jitter/timing.py-312"></a>            <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;dcd_measurement&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/jitter/timing.py-354" name="src/oscura/analyzers/jitter/timing.py-354"></a>    <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">sample_rate</span>
<a id="src/oscura/analyzers/jitter/timing.py-355" name="src/oscura/analyzers/jitter/timing.py-355"></a>    <span class="n">sample_period</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">sample_rate</span>
<a id="src/oscura/analyzers/jitter/timing.py-356" name="src/oscura/analyzers/jitter/timing.py-356"></a>
<a id="src/oscura/analyzers/jitter/timing.py-357" name="src/oscura/analyzers/jitter/timing.py-357"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
<a id="src/oscura/analyzers/jitter/timing.py-358" name="src/oscura/analyzers/jitter/timing.py-358"></a><span class="hll">        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-359" name="src/oscura/analyzers/jitter/timing.py-359"></a>
<a id="src/oscura/analyzers/jitter/timing.py-360" name="src/oscura/analyzers/jitter/timing.py-360"></a>    <span class="c1"># Find amplitude levels - use more extreme percentiles for better accuracy</span>
<a id="src/oscura/analyzers/jitter/timing.py-361" name="src/oscura/analyzers/jitter/timing.py-361"></a>    <span class="n">low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<a id="src/oscura/analyzers/jitter/timing.py-362" name="src/oscura/analyzers/jitter/timing.py-362"></a>    <span class="n">high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/jitter/timing.py-384" name="src/oscura/analyzers/jitter/timing.py-384"></a>            <span class="n">frac</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">frac</span><span class="p">))</span>
<a id="src/oscura/analyzers/jitter/timing.py-385" name="src/oscura/analyzers/jitter/timing.py-385"></a>            <span class="n">t_offset</span> <span class="o">=</span> <span class="n">frac</span> <span class="o">*</span> <span class="n">sample_period</span>
<a id="src/oscura/analyzers/jitter/timing.py-386" name="src/oscura/analyzers/jitter/timing.py-386"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/analyzers/jitter/timing.py-387" name="src/oscura/analyzers/jitter/timing.py-387"></a>            <span class="c1"># Values are equal, use midpoint</span>
<a id="src/oscura/analyzers/jitter/timing.py-388" name="src/oscura/analyzers/jitter/timing.py-388"></a><span class="hll">            <span class="n">t_offset</span> <span class="o">=</span> <span class="n">sample_period</span> <span class="o">/</span> <span class="mi">2</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-389" name="src/oscura/analyzers/jitter/timing.py-389"></a>        <span class="n">rising_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span> <span class="o">*</span> <span class="n">sample_period</span> <span class="o">+</span> <span class="n">t_offset</span><span class="p">)</span>
<a id="src/oscura/analyzers/jitter/timing.py-390" name="src/oscura/analyzers/jitter/timing.py-390"></a>
<a id="src/oscura/analyzers/jitter/timing.py-391" name="src/oscura/analyzers/jitter/timing.py-391"></a>    <span class="n">falling_edges</span> <span class="o">=</span> <span class="p">[]</span>
<a id="src/oscura/analyzers/jitter/timing.py-392" name="src/oscura/analyzers/jitter/timing.py-392"></a>    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">falling_indices</span><span class="p">:</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/jitter/timing.py-399" name="src/oscura/analyzers/jitter/timing.py-399"></a>            <span class="n">frac</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">frac</span><span class="p">))</span>
<a id="src/oscura/analyzers/jitter/timing.py-400" name="src/oscura/analyzers/jitter/timing.py-400"></a>            <span class="n">t_offset</span> <span class="o">=</span> <span class="n">frac</span> <span class="o">*</span> <span class="n">sample_period</span>
<a id="src/oscura/analyzers/jitter/timing.py-401" name="src/oscura/analyzers/jitter/timing.py-401"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/analyzers/jitter/timing.py-402" name="src/oscura/analyzers/jitter/timing.py-402"></a>            <span class="c1"># Values are equal, use midpoint</span>
<a id="src/oscura/analyzers/jitter/timing.py-403" name="src/oscura/analyzers/jitter/timing.py-403"></a><span class="hll">            <span class="n">t_offset</span> <span class="o">=</span> <span class="n">sample_period</span> <span class="o">/</span> <span class="mi">2</span>
</span><a id="src/oscura/analyzers/jitter/timing.py-404" name="src/oscura/analyzers/jitter/timing.py-404"></a>        <span class="n">falling_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span> <span class="o">*</span> <span class="n">sample_period</span> <span class="o">+</span> <span class="n">t_offset</span><span class="p">)</span>
<a id="src/oscura/analyzers/jitter/timing.py-405" name="src/oscura/analyzers/jitter/timing.py-405"></a>
<a id="src/oscura/analyzers/jitter/timing.py-406" name="src/oscura/analyzers/jitter/timing.py-406"></a>    <span class="k">return</span> <span class="p">(</span>
<a id="src/oscura/analyzers/jitter/timing.py-407" name="src/oscura/analyzers/jitter/timing.py-407"></a>        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rising_edges</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/oscura/analyzers/patterns/reverse_engineering.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-235" name="src/oscura/analyzers/patterns/reverse_engineering.py-235"></a>        <span class="c1"># 2. Classify data type</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-236" name="src/oscura/analyzers/patterns/reverse_engineering.py-236"></a>        <span class="k">if</span> <span class="n">entropy_result</span><span class="o">.</span><span class="n">encryption_likelihood</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-237" name="src/oscura/analyzers/patterns/reverse_engineering.py-237"></a>            <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;encrypted&quot;</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-238" name="src/oscura/analyzers/patterns/reverse_engineering.py-238"></a>        <span class="k">elif</span> <span class="n">entropy_result</span><span class="o">.</span><span class="n">compression_likelihood</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-239" name="src/oscura/analyzers/patterns/reverse_engineering.py-239"></a><span class="hll">            <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;compressed&quot;</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-240" name="src/oscura/analyzers/patterns/reverse_engineering.py-240"></a>        <span class="k">elif</span> <span class="n">entropy_val</span> <span class="o">&lt;</span> <span class="mf">3.0</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-241" name="src/oscura/analyzers/patterns/reverse_engineering.py-241"></a>            <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;structured&quot;</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-242" name="src/oscura/analyzers/patterns/reverse_engineering.py-242"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-243" name="src/oscura/analyzers/patterns/reverse_engineering.py-243"></a><span class="hll">            <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;mixed&quot;</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-244" name="src/oscura/analyzers/patterns/reverse_engineering.py-244"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-245" name="src/oscura/analyzers/patterns/reverse_engineering.py-245"></a>        <span class="c1"># 3. Signature discovery (skip for encrypted/compressed)</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-246" name="src/oscura/analyzers/patterns/reverse_engineering.py-246"></a>        <span class="n">signatures</span> <span class="o">=</span> <span class="p">[]</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-247" name="src/oscura/analyzers/patterns/reverse_engineering.py-247"></a>        <span class="k">if</span> <span class="n">detect_signatures</span> <span class="ow">and</span> <span class="n">data_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;structured&quot;</span><span class="p">,</span> <span class="s2">&quot;mixed&quot;</span><span class="p">]:</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-246" name="src/oscura/analyzers/patterns/reverse_engineering.py-246"></a>        <span class="n">signatures</span> <span class="o">=</span> <span class="p">[]</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-247" name="src/oscura/analyzers/patterns/reverse_engineering.py-247"></a>        <span class="k">if</span> <span class="n">detect_signatures</span> <span class="ow">and</span> <span class="n">data_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;structured&quot;</span><span class="p">,</span> <span class="s2">&quot;mixed&quot;</span><span class="p">]:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-248" name="src/oscura/analyzers/patterns/reverse_engineering.py-248"></a>            <span class="k">try</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-249" name="src/oscura/analyzers/patterns/reverse_engineering.py-249"></a>                <span class="n">signatures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signature_discovery</span><span class="o">.</span><span class="n">discover_signatures</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-250" name="src/oscura/analyzers/patterns/reverse_engineering.py-250"></a><span class="hll">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-251" name="src/oscura/analyzers/patterns/reverse_engineering.py-251"></a><span class="hll">                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Signature discovery failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-252" name="src/oscura/analyzers/patterns/reverse_engineering.py-252"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-253" name="src/oscura/analyzers/patterns/reverse_engineering.py-253"></a>        <span class="c1"># 4. Repeating pattern detection</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-254" name="src/oscura/analyzers/patterns/reverse_engineering.py-254"></a>        <span class="n">repeating</span> <span class="o">=</span> <span class="p">[]</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-255" name="src/oscura/analyzers/patterns/reverse_engineering.py-255"></a>        <span class="k">try</span><span class="p">:</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-262" name="src/oscura/analyzers/patterns/reverse_engineering.py-262"></a>                    <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="n">seq</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-263" name="src/oscura/analyzers/patterns/reverse_engineering.py-263"></a>                <span class="p">}</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-264" name="src/oscura/analyzers/patterns/reverse_engineering.py-264"></a>                <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>  <span class="c1"># Top 10</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-265" name="src/oscura/analyzers/patterns/reverse_engineering.py-265"></a>            <span class="p">]</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-266" name="src/oscura/analyzers/patterns/reverse_engineering.py-266"></a><span class="hll">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-267" name="src/oscura/analyzers/patterns/reverse_engineering.py-267"></a><span class="hll">            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Repeating pattern detection failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-268" name="src/oscura/analyzers/patterns/reverse_engineering.py-268"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-269" name="src/oscura/analyzers/patterns/reverse_engineering.py-269"></a>        <span class="c1"># 5. N-gram profiling</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-270" name="src/oscura/analyzers/patterns/reverse_engineering.py-270"></a>        <span class="n">ngram_profile</span> <span class="o">=</span> <span class="p">{}</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-271" name="src/oscura/analyzers/patterns/reverse_engineering.py-271"></a>        <span class="k">try</span><span class="p">:</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-269" name="src/oscura/analyzers/patterns/reverse_engineering.py-269"></a>        <span class="c1"># 5. N-gram profiling</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-270" name="src/oscura/analyzers/patterns/reverse_engineering.py-270"></a>        <span class="n">ngram_profile</span> <span class="o">=</span> <span class="p">{}</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-271" name="src/oscura/analyzers/patterns/reverse_engineering.py-271"></a>        <span class="k">try</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-272" name="src/oscura/analyzers/patterns/reverse_engineering.py-272"></a>            <span class="n">ngram_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ngram_analyzer</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-273" name="src/oscura/analyzers/patterns/reverse_engineering.py-273"></a><span class="hll">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-274" name="src/oscura/analyzers/patterns/reverse_engineering.py-274"></a><span class="hll">            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;N-gram analysis failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-275" name="src/oscura/analyzers/patterns/reverse_engineering.py-275"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-276" name="src/oscura/analyzers/patterns/reverse_engineering.py-276"></a>        <span class="c1"># 6. Anomaly detection (simple z-score based)</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-277" name="src/oscura/analyzers/patterns/reverse_engineering.py-277"></a>        <span class="n">anomalies</span> <span class="o">=</span> <span class="p">[]</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-278" name="src/oscura/analyzers/patterns/reverse_engineering.py-278"></a>        <span class="k">if</span> <span class="n">detect_anomalies</span><span class="p">:</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-283" name="src/oscura/analyzers/patterns/reverse_engineering.py-283"></a>                <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">byte_array</span><span class="p">)</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-284" name="src/oscura/analyzers/patterns/reverse_engineering.py-284"></a>                <span class="k">if</span> <span class="n">std</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-285" name="src/oscura/analyzers/patterns/reverse_engineering.py-285"></a>                    <span class="n">z_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">byte_array</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span><span class="p">)</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-286" name="src/oscura/analyzers/patterns/reverse_engineering.py-286"></a>                    <span class="n">anomalies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">z_scores</span> <span class="o">&gt;</span> <span class="mf">3.0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-287" name="src/oscura/analyzers/patterns/reverse_engineering.py-287"></a><span class="hll">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-288" name="src/oscura/analyzers/patterns/reverse_engineering.py-288"></a><span class="hll">                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Anomaly detection failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-289" name="src/oscura/analyzers/patterns/reverse_engineering.py-289"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-290" name="src/oscura/analyzers/patterns/reverse_engineering.py-290"></a>        <span class="c1"># 7. Periodic pattern detection</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-291" name="src/oscura/analyzers/patterns/reverse_engineering.py-291"></a>        <span class="n">periodic</span> <span class="o">=</span> <span class="p">[]</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-292" name="src/oscura/analyzers/patterns/reverse_engineering.py-292"></a>        <span class="k">try</span><span class="p">:</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-300" name="src/oscura/analyzers/patterns/reverse_engineering.py-300"></a>                        <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="n">period_result</span><span class="o">.</span><span class="n">confidence</span><span class="p">,</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-301" name="src/oscura/analyzers/patterns/reverse_engineering.py-301"></a>                        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">period_result</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-302" name="src/oscura/analyzers/patterns/reverse_engineering.py-302"></a>                    <span class="p">}</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-303" name="src/oscura/analyzers/patterns/reverse_engineering.py-303"></a>                <span class="p">)</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-304" name="src/oscura/analyzers/patterns/reverse_engineering.py-304"></a><span class="hll">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-305" name="src/oscura/analyzers/patterns/reverse_engineering.py-305"></a><span class="hll">            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Period detection failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-306" name="src/oscura/analyzers/patterns/reverse_engineering.py-306"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-307" name="src/oscura/analyzers/patterns/reverse_engineering.py-307"></a>        <span class="c1"># Calculate overall confidence</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-308" name="src/oscura/analyzers/patterns/reverse_engineering.py-308"></a>        <span class="n">confidence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_analysis_confidence</span><span class="p">(</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-309" name="src/oscura/analyzers/patterns/reverse_engineering.py-309"></a>            <span class="n">entropy_result</span><span class="p">,</span> <span class="n">signatures</span><span class="p">,</span> <span class="n">repeating</span><span class="p">,</span> <span class="n">anomalies</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-481" name="src/oscura/analyzers/patterns/reverse_engineering.py-481"></a><span class="sd">            &gt;&gt;&gt; for field in fields:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-482" name="src/oscura/analyzers/patterns/reverse_engineering.py-482"></a><span class="sd">            ...     print(f&quot;Field: {field.field_type} at {field.offset}&quot;)</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-483" name="src/oscura/analyzers/patterns/reverse_engineering.py-483"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-484" name="src/oscura/analyzers/patterns/reverse_engineering.py-484"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">messages</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-485" name="src/oscura/analyzers/patterns/reverse_engineering.py-485"></a><span class="hll">            <span class="k">return</span> <span class="p">[]</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-486" name="src/oscura/analyzers/patterns/reverse_engineering.py-486"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-487" name="src/oscura/analyzers/patterns/reverse_engineering.py-487"></a>        <span class="c1"># Validate all messages same length</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-488" name="src/oscura/analyzers/patterns/reverse_engineering.py-488"></a>        <span class="n">msg_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-489" name="src/oscura/analyzers/patterns/reverse_engineering.py-489"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">==</span> <span class="n">msg_len</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">):</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-555" name="src/oscura/analyzers/patterns/reverse_engineering.py-555"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-556" name="src/oscura/analyzers/patterns/reverse_engineering.py-556"></a>        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">encryption_likelihood</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-557" name="src/oscura/analyzers/patterns/reverse_engineering.py-557"></a>            <span class="k">return</span> <span class="s2">&quot;encrypted&quot;</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-558" name="src/oscura/analyzers/patterns/reverse_engineering.py-558"></a>        <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">compression_likelihood</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-559" name="src/oscura/analyzers/patterns/reverse_engineering.py-559"></a><span class="hll">            <span class="k">return</span> <span class="s2">&quot;compressed&quot;</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-560" name="src/oscura/analyzers/patterns/reverse_engineering.py-560"></a>        <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">shannon_entropy</span> <span class="o">&lt;</span> <span class="mf">3.0</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-561" name="src/oscura/analyzers/patterns/reverse_engineering.py-561"></a>            <span class="k">return</span> <span class="s2">&quot;structured&quot;</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-562" name="src/oscura/analyzers/patterns/reverse_engineering.py-562"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-563" name="src/oscura/analyzers/patterns/reverse_engineering.py-563"></a><span class="hll">            <span class="k">return</span> <span class="s2">&quot;mixed&quot;</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-564" name="src/oscura/analyzers/patterns/reverse_engineering.py-564"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-565" name="src/oscura/analyzers/patterns/reverse_engineering.py-565"></a>    <span class="c1"># =========================================================================</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-566" name="src/oscura/analyzers/patterns/reverse_engineering.py-566"></a>    <span class="c1"># Internal Helper Methods</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-567" name="src/oscura/analyzers/patterns/reverse_engineering.py-567"></a>    <span class="c1"># =========================================================================</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-568" name="src/oscura/analyzers/patterns/reverse_engineering.py-568"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-569" name="src/oscura/analyzers/patterns/reverse_engineering.py-569"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_detect_delimiter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-570" name="src/oscura/analyzers/patterns/reverse_engineering.py-570"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect delimiter by finding common endings.&quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-571" name="src/oscura/analyzers/patterns/reverse_engineering.py-571"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-572" name="src/oscura/analyzers/patterns/reverse_engineering.py-572"></a><span class="hll">            <span class="k">return</span> <span class="kc">None</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-573" name="src/oscura/analyzers/patterns/reverse_engineering.py-573"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-574" name="src/oscura/analyzers/patterns/reverse_engineering.py-574"></a>        <span class="c1"># Look for common suffixes (last 1-4 bytes)</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-575" name="src/oscura/analyzers/patterns/reverse_engineering.py-575"></a>        <span class="k">for</span> <span class="n">delim_len</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-576" name="src/oscura/analyzers/patterns/reverse_engineering.py-576"></a>            <span class="n">candidates</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-588" name="src/oscura/analyzers/patterns/reverse_engineering.py-588"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-589" name="src/oscura/analyzers/patterns/reverse_engineering.py-589"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_infer_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">],</span> <span class="n">min_field_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">FieldDescriptor</span><span class="p">]:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-590" name="src/oscura/analyzers/patterns/reverse_engineering.py-590"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Infer field boundaries using entropy and variance analysis.&quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-591" name="src/oscura/analyzers/patterns/reverse_engineering.py-591"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">messages</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-592" name="src/oscura/analyzers/patterns/reverse_engineering.py-592"></a><span class="hll">            <span class="k">return</span> <span class="p">[]</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-593" name="src/oscura/analyzers/patterns/reverse_engineering.py-593"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-594" name="src/oscura/analyzers/patterns/reverse_engineering.py-594"></a>        <span class="n">msg_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-595" name="src/oscura/analyzers/patterns/reverse_engineering.py-595"></a>        <span class="k">if</span> <span class="n">msg_len</span> <span class="o">&lt;</span> <span class="n">min_field_size</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-596" name="src/oscura/analyzers/patterns/reverse_engineering.py-596"></a><span class="hll">            <span class="k">return</span> <span class="p">[]</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-597" name="src/oscura/analyzers/patterns/reverse_engineering.py-597"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-598" name="src/oscura/analyzers/patterns/reverse_engineering.py-598"></a>        <span class="c1"># Compute positional entropy and variance</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-599" name="src/oscura/analyzers/patterns/reverse_engineering.py-599"></a>        <span class="n">position_entropy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">msg_len</span><span class="p">)</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-600" name="src/oscura/analyzers/patterns/reverse_engineering.py-600"></a>        <span class="n">position_variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">msg_len</span><span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-623" name="src/oscura/analyzers/patterns/reverse_engineering.py-623"></a>                        <span class="c1"># All messages have same value</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-624" name="src/oscura/analyzers/patterns/reverse_engineering.py-624"></a>                        <span class="n">constant_val</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">field_start</span><span class="p">:</span><span class="n">pos</span><span class="p">]</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-625" name="src/oscura/analyzers/patterns/reverse_engineering.py-625"></a>                        <span class="n">field_type</span> <span class="o">=</span> <span class="s2">&quot;constant&quot;</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-626" name="src/oscura/analyzers/patterns/reverse_engineering.py-626"></a>                    <span class="k">elif</span> <span class="n">avg_entropy</span> <span class="o">&gt;</span> <span class="mf">6.0</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-627" name="src/oscura/analyzers/patterns/reverse_engineering.py-627"></a><span class="hll">                        <span class="n">field_type</span> <span class="o">=</span> <span class="s2">&quot;high_entropy&quot;</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-628" name="src/oscura/analyzers/patterns/reverse_engineering.py-628"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-629" name="src/oscura/analyzers/patterns/reverse_engineering.py-629"></a>                        <span class="n">field_type</span> <span class="o">=</span> <span class="s2">&quot;variable&quot;</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-630" name="src/oscura/analyzers/patterns/reverse_engineering.py-630"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-631" name="src/oscura/analyzers/patterns/reverse_engineering.py-631"></a>                    <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-661" name="src/oscura/analyzers/patterns/reverse_engineering.py-661"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-662" name="src/oscura/analyzers/patterns/reverse_engineering.py-662"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_detect_length_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-663" name="src/oscura/analyzers/patterns/reverse_engineering.py-663"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect length prefix at start of messages.&quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-664" name="src/oscura/analyzers/patterns/reverse_engineering.py-664"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-665" name="src/oscura/analyzers/patterns/reverse_engineering.py-665"></a><span class="hll">            <span class="k">return</span> <span class="kc">None</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-666" name="src/oscura/analyzers/patterns/reverse_engineering.py-666"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-667" name="src/oscura/analyzers/patterns/reverse_engineering.py-667"></a>        <span class="c1"># Try 1-byte length at offset 0</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-668" name="src/oscura/analyzers/patterns/reverse_engineering.py-668"></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">):</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-669" name="src/oscura/analyzers/patterns/reverse_engineering.py-669"></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">):</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-674" name="src/oscura/analyzers/patterns/reverse_engineering.py-674"></a>            <span class="n">matches</span> <span class="o">=</span> <span class="mi">0</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-675" name="src/oscura/analyzers/patterns/reverse_engineering.py-675"></a>            <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-676" name="src/oscura/analyzers/patterns/reverse_engineering.py-676"></a>                <span class="n">length_field</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">byteorder</span><span class="o">=</span><span class="s2">&quot;little&quot;</span><span class="p">)</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-677" name="src/oscura/analyzers/patterns/reverse_engineering.py-677"></a>                <span class="k">if</span> <span class="n">length_field</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-678" name="src/oscura/analyzers/patterns/reverse_engineering.py-678"></a><span class="hll">                    <span class="n">matches</span> <span class="o">+=</span> <span class="mi">1</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-679" name="src/oscura/analyzers/patterns/reverse_engineering.py-679"></a>            <span class="k">if</span> <span class="n">matches</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-680" name="src/oscura/analyzers/patterns/reverse_engineering.py-680"></a><span class="hll">                <span class="k">return</span> <span class="mi">0</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-681" name="src/oscura/analyzers/patterns/reverse_engineering.py-681"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-682" name="src/oscura/analyzers/patterns/reverse_engineering.py-682"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-683" name="src/oscura/analyzers/patterns/reverse_engineering.py-683"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-684" name="src/oscura/analyzers/patterns/reverse_engineering.py-684"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_detect_checksum_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-685" name="src/oscura/analyzers/patterns/reverse_engineering.py-685"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect checksum field (simplified heuristic).&quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-686" name="src/oscura/analyzers/patterns/reverse_engineering.py-686"></a>        <span class="c1"># This is a simplified version - real implementation would test CRC8/16/32</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-687" name="src/oscura/analyzers/patterns/reverse_engineering.py-687"></a>        <span class="c1"># For now, just detect if last 1-4 bytes have high variance (likely checksum)</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-688" name="src/oscura/analyzers/patterns/reverse_engineering.py-688"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-689" name="src/oscura/analyzers/patterns/reverse_engineering.py-689"></a><span class="hll">            <span class="k">return</span> <span class="kc">None</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-690" name="src/oscura/analyzers/patterns/reverse_engineering.py-690"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-691" name="src/oscura/analyzers/patterns/reverse_engineering.py-691"></a>        <span class="n">msg_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-692" name="src/oscura/analyzers/patterns/reverse_engineering.py-692"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">==</span> <span class="n">msg_len</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">):</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-693" name="src/oscura/analyzers/patterns/reverse_engineering.py-693"></a>            <span class="k">return</span> <span class="kc">None</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-701" name="src/oscura/analyzers/patterns/reverse_engineering.py-701"></a>                <span class="c1"># If almost all unique, likely a checksum</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-702" name="src/oscura/analyzers/patterns/reverse_engineering.py-702"></a>                <span class="k">if</span> <span class="n">unique_values</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-703" name="src/oscura/analyzers/patterns/reverse_engineering.py-703"></a>                    <span class="k">return</span> <span class="n">offset</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-704" name="src/oscura/analyzers/patterns/reverse_engineering.py-704"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-705" name="src/oscura/analyzers/patterns/reverse_engineering.py-705"></a><span class="hll">        <span class="k">return</span> <span class="kc">None</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-706" name="src/oscura/analyzers/patterns/reverse_engineering.py-706"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-707" name="src/oscura/analyzers/patterns/reverse_engineering.py-707"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_shannon_entropy_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-708" name="src/oscura/analyzers/patterns/reverse_engineering.py-708"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate Shannon entropy for byte sequence.&quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-709" name="src/oscura/analyzers/patterns/reverse_engineering.py-709"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-710" name="src/oscura/analyzers/patterns/reverse_engineering.py-710"></a><span class="hll">            <span class="k">return</span> <span class="mf">0.0</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-711" name="src/oscura/analyzers/patterns/reverse_engineering.py-711"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-712" name="src/oscura/analyzers/patterns/reverse_engineering.py-712"></a>        <span class="n">byte_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">minlength</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-713" name="src/oscura/analyzers/patterns/reverse_engineering.py-713"></a>        <span class="n">probabilities</span> <span class="o">=</span> <span class="n">byte_counts</span><span class="p">[</span><span class="n">byte_counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-714" name="src/oscura/analyzers/patterns/reverse_engineering.py-714"></a>        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">probabilities</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">probabilities</span><span class="p">)))</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-752" name="src/oscura/analyzers/patterns/reverse_engineering.py-752"></a>            <span class="n">confidence</span> <span class="o">+=</span> <span class="mf">0.2</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-753" name="src/oscura/analyzers/patterns/reverse_engineering.py-753"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-754" name="src/oscura/analyzers/patterns/reverse_engineering.py-754"></a>        <span class="c1"># More confidence if delimiter found</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-755" name="src/oscura/analyzers/patterns/reverse_engineering.py-755"></a>        <span class="k">if</span> <span class="n">has_delimiter</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-756" name="src/oscura/analyzers/patterns/reverse_engineering.py-756"></a><span class="hll">            <span class="n">confidence</span> <span class="o">+=</span> <span class="mf">0.1</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-757" name="src/oscura/analyzers/patterns/reverse_engineering.py-757"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-758" name="src/oscura/analyzers/patterns/reverse_engineering.py-758"></a>        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">confidence</span><span class="p">))</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-759" name="src/oscura/analyzers/patterns/reverse_engineering.py-759"></a>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-917" name="src/oscura/analyzers/patterns/reverse_engineering.py-917"></a>    <span class="n">region_start</span> <span class="o">=</span> <span class="mi">0</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-918" name="src/oscura/analyzers/patterns/reverse_engineering.py-918"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-919" name="src/oscura/analyzers/patterns/reverse_engineering.py-919"></a>    <span class="k">for</span> <span class="n">offset</span><span class="p">,</span> <span class="n">entropy</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-920" name="src/oscura/analyzers/patterns/reverse_engineering.py-920"></a>        <span class="k">if</span> <span class="n">entropy</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-921" name="src/oscura/analyzers/patterns/reverse_engineering.py-921"></a><span class="hll">            <span class="k">if</span> <span class="ow">not</span> <span class="n">in_region</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-922" name="src/oscura/analyzers/patterns/reverse_engineering.py-922"></a><span class="hll">                <span class="n">region_start</span> <span class="o">=</span> <span class="n">offset</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-923" name="src/oscura/analyzers/patterns/reverse_engineering.py-923"></a><span class="hll">                <span class="n">in_region</span> <span class="o">=</span> <span class="kc">True</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-924" name="src/oscura/analyzers/patterns/reverse_engineering.py-924"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-925" name="src/oscura/analyzers/patterns/reverse_engineering.py-925"></a>            <span class="k">if</span> <span class="n">in_region</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-926" name="src/oscura/analyzers/patterns/reverse_engineering.py-926"></a><span class="hll">                <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">region_start</span><span class="p">,</span> <span class="n">offset</span><span class="p">))</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-927" name="src/oscura/analyzers/patterns/reverse_engineering.py-927"></a><span class="hll">                <span class="n">in_region</span> <span class="o">=</span> <span class="kc">False</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-928" name="src/oscura/analyzers/patterns/reverse_engineering.py-928"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-929" name="src/oscura/analyzers/patterns/reverse_engineering.py-929"></a>    <span class="c1"># Close final region</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-930" name="src/oscura/analyzers/patterns/reverse_engineering.py-930"></a>    <span class="k">if</span> <span class="n">in_region</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-931" name="src/oscura/analyzers/patterns/reverse_engineering.py-931"></a><span class="hll">        <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">region_start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-932" name="src/oscura/analyzers/patterns/reverse_engineering.py-932"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-933" name="src/oscura/analyzers/patterns/reverse_engineering.py-933"></a>    <span class="k">return</span> <span class="n">regions</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-934" name="src/oscura/analyzers/patterns/reverse_engineering.py-934"></a>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-960" name="src/oscura/analyzers/patterns/reverse_engineering.py-960"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-961" name="src/oscura/analyzers/patterns/reverse_engineering.py-961"></a>    <span class="k">for</span> <span class="n">offset</span><span class="p">,</span> <span class="n">entropy</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-962" name="src/oscura/analyzers/patterns/reverse_engineering.py-962"></a>        <span class="c1"># Compressed: 6.5-7.5 bits/byte</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-963" name="src/oscura/analyzers/patterns/reverse_engineering.py-963"></a>        <span class="k">if</span> <span class="mf">6.5</span> <span class="o">&lt;</span> <span class="n">entropy</span> <span class="o">&lt;</span> <span class="mf">7.5</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-964" name="src/oscura/analyzers/patterns/reverse_engineering.py-964"></a><span class="hll">            <span class="k">if</span> <span class="ow">not</span> <span class="n">in_region</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-965" name="src/oscura/analyzers/patterns/reverse_engineering.py-965"></a><span class="hll">                <span class="n">region_start</span> <span class="o">=</span> <span class="n">offset</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-966" name="src/oscura/analyzers/patterns/reverse_engineering.py-966"></a><span class="hll">                <span class="n">in_region</span> <span class="o">=</span> <span class="kc">True</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-967" name="src/oscura/analyzers/patterns/reverse_engineering.py-967"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-968" name="src/oscura/analyzers/patterns/reverse_engineering.py-968"></a>            <span class="k">if</span> <span class="n">in_region</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-969" name="src/oscura/analyzers/patterns/reverse_engineering.py-969"></a><span class="hll">                <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">region_start</span><span class="p">,</span> <span class="n">offset</span><span class="p">))</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-970" name="src/oscura/analyzers/patterns/reverse_engineering.py-970"></a><span class="hll">                <span class="n">in_region</span> <span class="o">=</span> <span class="kc">False</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-971" name="src/oscura/analyzers/patterns/reverse_engineering.py-971"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-972" name="src/oscura/analyzers/patterns/reverse_engineering.py-972"></a>    <span class="k">if</span> <span class="n">in_region</span><span class="p">:</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-973" name="src/oscura/analyzers/patterns/reverse_engineering.py-973"></a><span class="hll">        <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">region_start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
</span><a id="src/oscura/analyzers/patterns/reverse_engineering.py-974" name="src/oscura/analyzers/patterns/reverse_engineering.py-974"></a>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-975" name="src/oscura/analyzers/patterns/reverse_engineering.py-975"></a>    <span class="k">return</span> <span class="n">regions</span>
<a id="src/oscura/analyzers/patterns/reverse_engineering.py-976" name="src/oscura/analyzers/patterns/reverse_engineering.py-976"></a>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/oscura/analyzers/statistics/basic.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/statistics/basic.py-354" name="src/oscura/analyzers/statistics/basic.py-354"></a><span class="sd">        &gt;&gt;&gt; # Get flat values without units</span>
<a id="src/oscura/analyzers/statistics/basic.py-355" name="src/oscura/analyzers/statistics/basic.py-355"></a><span class="sd">        &gt;&gt;&gt; results = measure(trace, include_units=False)</span>
<a id="src/oscura/analyzers/statistics/basic.py-356" name="src/oscura/analyzers/statistics/basic.py-356"></a><span class="sd">        &gt;&gt;&gt; mean_value = results[&quot;mean&quot;]  # Just the float</span>
<a id="src/oscura/analyzers/statistics/basic.py-357" name="src/oscura/analyzers/statistics/basic.py-357"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/statistics/basic.py-358" name="src/oscura/analyzers/statistics/basic.py-358"></a><span class="hll">    <span class="n">data</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">WaveformTrace</span><span class="p">)</span> <span class="k">else</span> <span class="n">trace</span>
</span><a id="src/oscura/analyzers/statistics/basic.py-359" name="src/oscura/analyzers/statistics/basic.py-359"></a>
<a id="src/oscura/analyzers/statistics/basic.py-360" name="src/oscura/analyzers/statistics/basic.py-360"></a>    <span class="c1"># Define unit mappings for statistical measurements</span>
<a id="src/oscura/analyzers/statistics/basic.py-361" name="src/oscura/analyzers/statistics/basic.py-361"></a>    <span class="c1"># For generic signals we use voltage units, but this could be parameterized</span>
<a id="src/oscura/analyzers/statistics/basic.py-362" name="src/oscura/analyzers/statistics/basic.py-362"></a><span class="hll">    <span class="n">unit_map</span> <span class="o">=</span> <span class="p">{</span>
</span><a id="src/oscura/analyzers/statistics/basic.py-363" name="src/oscura/analyzers/statistics/basic.py-363"></a>        <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/statistics/basic.py-364" name="src/oscura/analyzers/statistics/basic.py-364"></a>        <span class="s2">&quot;variance&quot;</span><span class="p">:</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/statistics/basic.py-365" name="src/oscura/analyzers/statistics/basic.py-365"></a>        <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/statistics/basic.py-366" name="src/oscura/analyzers/statistics/basic.py-366"></a>        <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/statistics/basic.py-376" name="src/oscura/analyzers/statistics/basic.py-376"></a>        <span class="s2">&quot;p99&quot;</span><span class="p">:</span> <span class="s2">&quot;dimensionless&quot;</span><span class="p">,</span>
<a id="src/oscura/analyzers/statistics/basic.py-377" name="src/oscura/analyzers/statistics/basic.py-377"></a>    <span class="p">}</span>
<a id="src/oscura/analyzers/statistics/basic.py-378" name="src/oscura/analyzers/statistics/basic.py-378"></a>
<a id="src/oscura/analyzers/statistics/basic.py-379" name="src/oscura/analyzers/statistics/basic.py-379"></a>    <span class="c1"># Get basic stats</span>
<a id="src/oscura/analyzers/statistics/basic.py-380" name="src/oscura/analyzers/statistics/basic.py-380"></a><span class="hll">    <span class="n">basic</span> <span class="o">=</span> <span class="n">basic_stats</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/statistics/basic.py-381" name="src/oscura/analyzers/statistics/basic.py-381"></a>
<a id="src/oscura/analyzers/statistics/basic.py-382" name="src/oscura/analyzers/statistics/basic.py-382"></a>    <span class="c1"># Get percentiles</span>
<a id="src/oscura/analyzers/statistics/basic.py-383" name="src/oscura/analyzers/statistics/basic.py-383"></a><span class="hll">    <span class="n">percentile_values</span> <span class="o">=</span> <span class="n">percentiles</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">99</span><span class="p">])</span>
</span><a id="src/oscura/analyzers/statistics/basic.py-384" name="src/oscura/analyzers/statistics/basic.py-384"></a>
<a id="src/oscura/analyzers/statistics/basic.py-385" name="src/oscura/analyzers/statistics/basic.py-385"></a>    <span class="c1"># Combine into single dict</span>
<a id="src/oscura/analyzers/statistics/basic.py-386" name="src/oscura/analyzers/statistics/basic.py-386"></a><span class="hll">    <span class="n">all_measurements</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">basic</span><span class="p">,</span> <span class="o">**</span><span class="n">percentile_values</span><span class="p">}</span>
</span><a id="src/oscura/analyzers/statistics/basic.py-387" name="src/oscura/analyzers/statistics/basic.py-387"></a>
<a id="src/oscura/analyzers/statistics/basic.py-388" name="src/oscura/analyzers/statistics/basic.py-388"></a>    <span class="c1"># Select requested measurements or all</span>
<a id="src/oscura/analyzers/statistics/basic.py-389" name="src/oscura/analyzers/statistics/basic.py-389"></a><span class="hll">    <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/statistics/basic.py-390" name="src/oscura/analyzers/statistics/basic.py-390"></a><span class="hll">        <span class="n">all_measurements</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_measurements</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">}</span>
</span><a id="src/oscura/analyzers/statistics/basic.py-391" name="src/oscura/analyzers/statistics/basic.py-391"></a>
<a id="src/oscura/analyzers/statistics/basic.py-392" name="src/oscura/analyzers/statistics/basic.py-392"></a>    <span class="c1"># Format results</span>
<a id="src/oscura/analyzers/statistics/basic.py-393" name="src/oscura/analyzers/statistics/basic.py-393"></a><span class="hll">    <span class="k">if</span> <span class="n">include_units</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/statistics/basic.py-394" name="src/oscura/analyzers/statistics/basic.py-394"></a><span class="hll">        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</span><a id="src/oscura/analyzers/statistics/basic.py-395" name="src/oscura/analyzers/statistics/basic.py-395"></a><span class="hll">        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">all_measurements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><a id="src/oscura/analyzers/statistics/basic.py-396" name="src/oscura/analyzers/statistics/basic.py-396"></a><span class="hll">            <span class="n">unit</span> <span class="o">=</span> <span class="n">unit_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/statistics/basic.py-397" name="src/oscura/analyzers/statistics/basic.py-397"></a><span class="hll">            <span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="n">unit</span><span class="p">}</span>
</span><a id="src/oscura/analyzers/statistics/basic.py-398" name="src/oscura/analyzers/statistics/basic.py-398"></a><span class="hll">        <span class="k">return</span> <span class="n">results</span>
</span><a id="src/oscura/analyzers/statistics/basic.py-399" name="src/oscura/analyzers/statistics/basic.py-399"></a>    <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/analyzers/statistics/basic.py-400" name="src/oscura/analyzers/statistics/basic.py-400"></a><span class="hll">        <span class="k">return</span> <span class="n">all_measurements</span>
</span><a id="src/oscura/analyzers/statistics/basic.py-401" name="src/oscura/analyzers/statistics/basic.py-401"></a>
<a id="src/oscura/analyzers/statistics/basic.py-402" name="src/oscura/analyzers/statistics/basic.py-402"></a>
<a id="src/oscura/analyzers/statistics/basic.py-403" name="src/oscura/analyzers/statistics/basic.py-403"></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
<a id="src/oscura/analyzers/statistics/basic.py-404" name="src/oscura/analyzers/statistics/basic.py-404"></a>    <span class="s2">&quot;basic_stats&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/oscura/analyzers/waveform/measurements.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/waveform/measurements.py-368" name="src/oscura/analyzers/waveform/measurements.py-368"></a>
<a id="src/oscura/analyzers/waveform/measurements.py-369" name="src/oscura/analyzers/waveform/measurements.py-369"></a>    <span class="c1"># Verify peak is significant (SNR check)</span>
<a id="src/oscura/analyzers/waveform/measurements.py-370" name="src/oscura/analyzers/waveform/measurements.py-370"></a>    <span class="c1"># If the peak is not at least 3x the mean, it&#39;s likely noise</span>
<a id="src/oscura/analyzers/waveform/measurements.py-371" name="src/oscura/analyzers/waveform/measurements.py-371"></a>    <span class="k">if</span> <span class="n">fft_mag</span><span class="p">[</span><span class="n">peak_idx</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fft_mag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
<a id="src/oscura/analyzers/waveform/measurements.py-372" name="src/oscura/analyzers/waveform/measurements.py-372"></a><span class="hll">        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><a id="src/oscura/analyzers/waveform/measurements.py-373" name="src/oscura/analyzers/waveform/measurements.py-373"></a>
<a id="src/oscura/analyzers/waveform/measurements.py-374" name="src/oscura/analyzers/waveform/measurements.py-374"></a>    <span class="c1"># Calculate frequency from peak index</span>
<a id="src/oscura/analyzers/waveform/measurements.py-375" name="src/oscura/analyzers/waveform/measurements.py-375"></a>    <span class="n">freq_resolution</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">sample_rate</span> <span class="o">/</span> <span class="n">n</span>
<a id="src/oscura/analyzers/waveform/measurements.py-376" name="src/oscura/analyzers/waveform/measurements.py-376"></a>    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">peak_idx</span> <span class="o">*</span> <span class="n">freq_resolution</span><span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/waveform/measurements.py-424" name="src/oscura/analyzers/waveform/measurements.py-424"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="src/oscura/analyzers/waveform/measurements.py-425" name="src/oscura/analyzers/waveform/measurements.py-425"></a>
<a id="src/oscura/analyzers/waveform/measurements.py-426" name="src/oscura/analyzers/waveform/measurements.py-426"></a>    <span class="c1"># Convert boolean data to float if needed</span>
<a id="src/oscura/analyzers/waveform/measurements.py-427" name="src/oscura/analyzers/waveform/measurements.py-427"></a>    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
<a id="src/oscura/analyzers/waveform/measurements.py-428" name="src/oscura/analyzers/waveform/measurements.py-428"></a><span class="hll">        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/waveform/measurements.py-429" name="src/oscura/analyzers/waveform/measurements.py-429"></a>
<a id="src/oscura/analyzers/waveform/measurements.py-430" name="src/oscura/analyzers/waveform/measurements.py-430"></a>    <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">_find_levels</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="src/oscura/analyzers/waveform/measurements.py-431" name="src/oscura/analyzers/waveform/measurements.py-431"></a>    <span class="n">amplitude</span> <span class="o">=</span> <span class="n">high</span> <span class="o">-</span> <span class="n">low</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/waveform/measurements.py-442" name="src/oscura/analyzers/waveform/measurements.py-442"></a>    <span class="n">samples_high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">above_threshold</span><span class="p">)</span>
<a id="src/oscura/analyzers/waveform/measurements.py-443" name="src/oscura/analyzers/waveform/measurements.py-443"></a>    <span class="n">total_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="src/oscura/analyzers/waveform/measurements.py-444" name="src/oscura/analyzers/waveform/measurements.py-444"></a>
<a id="src/oscura/analyzers/waveform/measurements.py-445" name="src/oscura/analyzers/waveform/measurements.py-445"></a>    <span class="k">if</span> <span class="n">total_samples</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="src/oscura/analyzers/waveform/measurements.py-446" name="src/oscura/analyzers/waveform/measurements.py-446"></a><span class="hll">        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><a id="src/oscura/analyzers/waveform/measurements.py-447" name="src/oscura/analyzers/waveform/measurements.py-447"></a>
<a id="src/oscura/analyzers/waveform/measurements.py-448" name="src/oscura/analyzers/waveform/measurements.py-448"></a>    <span class="n">dc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples_high</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_samples</span>
<a id="src/oscura/analyzers/waveform/measurements.py-449" name="src/oscura/analyzers/waveform/measurements.py-449"></a>
<a id="src/oscura/analyzers/waveform/measurements.py-450" name="src/oscura/analyzers/waveform/measurements.py-450"></a>    <span class="k">if</span> <span class="n">percentage</span><span class="p">:</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/waveform/measurements.py-936" name="src/oscura/analyzers/waveform/measurements.py-936"></a>    <span class="c1"># Sanity check - if histogram method failed, use adaptive percentiles</span>
<a id="src/oscura/analyzers/waveform/measurements.py-937" name="src/oscura/analyzers/waveform/measurements.py-937"></a>    <span class="k">if</span> <span class="n">high</span> <span class="o">&lt;=</span> <span class="n">low</span><span class="p">:</span>
<a id="src/oscura/analyzers/waveform/measurements.py-938" name="src/oscura/analyzers/waveform/measurements.py-938"></a>        <span class="c1"># For extreme duty cycles, use min/max with small outlier rejection</span>
<a id="src/oscura/analyzers/waveform/measurements.py-939" name="src/oscura/analyzers/waveform/measurements.py-939"></a>        <span class="c1"># p01 and p99 remove top/bottom 1% outliers (noise, ringing)</span>
<a id="src/oscura/analyzers/waveform/measurements.py-940" name="src/oscura/analyzers/waveform/measurements.py-940"></a><span class="hll">        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">p01</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">p99</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/waveform/measurements.py-941" name="src/oscura/analyzers/waveform/measurements.py-941"></a>
<a id="src/oscura/analyzers/waveform/measurements.py-942" name="src/oscura/analyzers/waveform/measurements.py-942"></a>    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">low</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">high</span><span class="p">)</span>
<a id="src/oscura/analyzers/waveform/measurements.py-943" name="src/oscura/analyzers/waveform/measurements.py-943"></a>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/oscura/analyzers/waveform/spectral.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/waveform/spectral.py-704" name="src/oscura/analyzers/waveform/spectral.py-704"></a>    <span class="n">thd_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">harmonic_power</span><span class="p">)</span> <span class="o">/</span> <span class="n">fund_mag</span>
<a id="src/oscura/analyzers/waveform/spectral.py-705" name="src/oscura/analyzers/waveform/spectral.py-705"></a>
<a id="src/oscura/analyzers/waveform/spectral.py-706" name="src/oscura/analyzers/waveform/spectral.py-706"></a>    <span class="c1"># Validate: THD must always be non-negative</span>
<a id="src/oscura/analyzers/waveform/spectral.py-707" name="src/oscura/analyzers/waveform/spectral.py-707"></a>    <span class="k">if</span> <span class="n">thd_ratio</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="src/oscura/analyzers/waveform/spectral.py-708" name="src/oscura/analyzers/waveform/spectral.py-708"></a><span class="hll">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-709" name="src/oscura/analyzers/waveform/spectral.py-709"></a>            <span class="sa">f</span><span class="s2">&quot;THD ratio is negative (</span><span class="si">{</span><span class="n">thd_ratio</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">), indicating a calculation error. &quot;</span>
<a id="src/oscura/analyzers/waveform/spectral.py-710" name="src/oscura/analyzers/waveform/spectral.py-710"></a>            <span class="sa">f</span><span class="s2">&quot;Fundamental: </span><span class="si">{</span><span class="n">fund_mag</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">, Harmonic power: </span><span class="si">{</span><span class="n">harmonic_power</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="src/oscura/analyzers/waveform/spectral.py-711" name="src/oscura/analyzers/waveform/spectral.py-711"></a>        <span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/waveform/spectral.py-2065" name="src/oscura/analyzers/waveform/spectral.py-2065"></a>        <span class="n">fundamental_freq</span> <span class="o">=</span> <span class="n">fund_freq</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2066" name="src/oscura/analyzers/waveform/spectral.py-2066"></a>
<a id="src/oscura/analyzers/waveform/spectral.py-2067" name="src/oscura/analyzers/waveform/spectral.py-2067"></a>    <span class="k">if</span> <span class="n">fundamental_freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2068" name="src/oscura/analyzers/waveform/spectral.py-2068"></a>        <span class="c1"># Return empty result</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2069" name="src/oscura/analyzers/waveform/spectral.py-2069"></a><span class="hll">        <span class="k">return</span> <span class="p">{</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2070" name="src/oscura/analyzers/waveform/spectral.py-2070"></a>            <span class="s2">&quot;frequencies&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2071" name="src/oscura/analyzers/waveform/spectral.py-2071"></a>            <span class="s2">&quot;amplitudes&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2072" name="src/oscura/analyzers/waveform/spectral.py-2072"></a>            <span class="s2">&quot;amplitudes_db&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2073" name="src/oscura/analyzers/waveform/spectral.py-2073"></a>            <span class="s2">&quot;fundamental_freq&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/waveform/spectral.py-2079" name="src/oscura/analyzers/waveform/spectral.py-2079"></a>
<a id="src/oscura/analyzers/waveform/spectral.py-2080" name="src/oscura/analyzers/waveform/spectral.py-2080"></a>    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_harmonics</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>  <span class="c1"># Include fundamental (h=1)</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2081" name="src/oscura/analyzers/waveform/spectral.py-2081"></a>        <span class="n">target_freq</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">fundamental_freq</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2082" name="src/oscura/analyzers/waveform/spectral.py-2082"></a>        <span class="k">if</span> <span class="n">target_freq</span> <span class="o">&gt;</span> <span class="n">freq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2083" name="src/oscura/analyzers/waveform/spectral.py-2083"></a><span class="hll">            <span class="k">break</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2084" name="src/oscura/analyzers/waveform/spectral.py-2084"></a>
<a id="src/oscura/analyzers/waveform/spectral.py-2085" name="src/oscura/analyzers/waveform/spectral.py-2085"></a>        <span class="c1"># Search around expected frequency</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2086" name="src/oscura/analyzers/waveform/spectral.py-2086"></a>        <span class="n">search_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">freq</span> <span class="o">-</span> <span class="n">target_freq</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">search_width_hz</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2087" name="src/oscura/analyzers/waveform/spectral.py-2087"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">search_mask</span><span class="p">):</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2088" name="src/oscura/analyzers/waveform/spectral.py-2088"></a><span class="hll">            <span class="k">continue</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2089" name="src/oscura/analyzers/waveform/spectral.py-2089"></a>
<a id="src/oscura/analyzers/waveform/spectral.py-2090" name="src/oscura/analyzers/waveform/spectral.py-2090"></a>        <span class="c1"># Find peak in search region</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2091" name="src/oscura/analyzers/waveform/spectral.py-2091"></a>        <span class="n">search_region_mag</span> <span class="o">=</span> <span class="n">magnitude</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2092" name="src/oscura/analyzers/waveform/spectral.py-2092"></a>        <span class="n">search_region_mag</span><span class="p">[</span><span class="o">~</span><span class="n">search_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/waveform/spectral.py-2235" name="src/oscura/analyzers/waveform/spectral.py-2235"></a><span class="sd">    References:</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2236" name="src/oscura/analyzers/waveform/spectral.py-2236"></a><span class="sd">        IEEE 1241-2010: ADC Terminology and Test Methods</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2237" name="src/oscura/analyzers/waveform/spectral.py-2237"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2238" name="src/oscura/analyzers/waveform/spectral.py-2238"></a>    <span class="c1"># Define all available spectral measurements with units</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2239" name="src/oscura/analyzers/waveform/spectral.py-2239"></a><span class="hll">    <span class="n">all_measurements</span> <span class="o">=</span> <span class="p">{</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2240" name="src/oscura/analyzers/waveform/spectral.py-2240"></a>        <span class="s2">&quot;thd&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">thd</span><span class="p">,</span> <span class="s2">&quot;%&quot;</span><span class="p">),</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2241" name="src/oscura/analyzers/waveform/spectral.py-2241"></a>        <span class="s2">&quot;snr&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">snr</span><span class="p">,</span> <span class="s2">&quot;dB&quot;</span><span class="p">),</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2242" name="src/oscura/analyzers/waveform/spectral.py-2242"></a>        <span class="s2">&quot;sinad&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">sinad</span><span class="p">,</span> <span class="s2">&quot;dB&quot;</span><span class="p">),</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2243" name="src/oscura/analyzers/waveform/spectral.py-2243"></a>        <span class="s2">&quot;enob&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">enob</span><span class="p">,</span> <span class="s2">&quot;bits&quot;</span><span class="p">),</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/analyzers/waveform/spectral.py-2244" name="src/oscura/analyzers/waveform/spectral.py-2244"></a>        <span class="s2">&quot;sfdr&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">sfdr</span><span class="p">,</span> <span class="s2">&quot;dB&quot;</span><span class="p">),</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2245" name="src/oscura/analyzers/waveform/spectral.py-2245"></a>    <span class="p">}</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2246" name="src/oscura/analyzers/waveform/spectral.py-2246"></a>
<a id="src/oscura/analyzers/waveform/spectral.py-2247" name="src/oscura/analyzers/waveform/spectral.py-2247"></a>    <span class="c1"># Select requested measurements or all</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2248" name="src/oscura/analyzers/waveform/spectral.py-2248"></a><span class="hll">    <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2249" name="src/oscura/analyzers/waveform/spectral.py-2249"></a><span class="hll">        <span class="n">selected</span> <span class="o">=</span> <span class="n">all_measurements</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2250" name="src/oscura/analyzers/waveform/spectral.py-2250"></a>    <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2251" name="src/oscura/analyzers/waveform/spectral.py-2251"></a><span class="hll">        <span class="n">selected</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_measurements</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">}</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2252" name="src/oscura/analyzers/waveform/spectral.py-2252"></a>
<a id="src/oscura/analyzers/waveform/spectral.py-2253" name="src/oscura/analyzers/waveform/spectral.py-2253"></a><span class="hll">    <span class="n">results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2254" name="src/oscura/analyzers/waveform/spectral.py-2254"></a>
<a id="src/oscura/analyzers/waveform/spectral.py-2255" name="src/oscura/analyzers/waveform/spectral.py-2255"></a><span class="hll">    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span> <span class="ow">in</span> <span class="n">selected</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2256" name="src/oscura/analyzers/waveform/spectral.py-2256"></a><span class="hll">        <span class="k">try</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2257" name="src/oscura/analyzers/waveform/spectral.py-2257"></a><span class="hll">            <span class="n">value</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>  <span class="c1"># type: ignore[operator]</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2258" name="src/oscura/analyzers/waveform/spectral.py-2258"></a><span class="hll">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2259" name="src/oscura/analyzers/waveform/spectral.py-2259"></a><span class="hll">            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2260" name="src/oscura/analyzers/waveform/spectral.py-2260"></a>
<a id="src/oscura/analyzers/waveform/spectral.py-2261" name="src/oscura/analyzers/waveform/spectral.py-2261"></a><span class="hll">        <span class="k">if</span> <span class="n">include_units</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2262" name="src/oscura/analyzers/waveform/spectral.py-2262"></a><span class="hll">            <span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="n">unit</span><span class="p">}</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2263" name="src/oscura/analyzers/waveform/spectral.py-2263"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2264" name="src/oscura/analyzers/waveform/spectral.py-2264"></a><span class="hll">            <span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2265" name="src/oscura/analyzers/waveform/spectral.py-2265"></a>
<a id="src/oscura/analyzers/waveform/spectral.py-2266" name="src/oscura/analyzers/waveform/spectral.py-2266"></a>    <span class="c1"># Add dominant frequency if requested or if computing all</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2267" name="src/oscura/analyzers/waveform/spectral.py-2267"></a><span class="hll">    <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s2">&quot;dominant_freq&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2268" name="src/oscura/analyzers/waveform/spectral.py-2268"></a><span class="hll">        <span class="k">try</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2269" name="src/oscura/analyzers/waveform/spectral.py-2269"></a><span class="hll">            <span class="n">fft_result</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">return_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2270" name="src/oscura/analyzers/waveform/spectral.py-2270"></a><span class="hll">            <span class="n">freq</span><span class="p">,</span> <span class="n">magnitude</span> <span class="o">=</span> <span class="n">fft_result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fft_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2271" name="src/oscura/analyzers/waveform/spectral.py-2271"></a><span class="hll">            <span class="n">dominant_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">magnitude</span><span class="p">[</span><span class="mi">1</span><span class="p">:])))</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Skip DC</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2272" name="src/oscura/analyzers/waveform/spectral.py-2272"></a><span class="hll">            <span class="n">dominant_freq_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="n">dominant_idx</span><span class="p">])</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2273" name="src/oscura/analyzers/waveform/spectral.py-2273"></a>
<a id="src/oscura/analyzers/waveform/spectral.py-2274" name="src/oscura/analyzers/waveform/spectral.py-2274"></a><span class="hll">            <span class="k">if</span> <span class="n">include_units</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2275" name="src/oscura/analyzers/waveform/spectral.py-2275"></a><span class="hll">                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;dominant_freq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">dominant_freq_value</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;Hz&quot;</span><span class="p">}</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2276" name="src/oscura/analyzers/waveform/spectral.py-2276"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2277" name="src/oscura/analyzers/waveform/spectral.py-2277"></a><span class="hll">                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;dominant_freq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dominant_freq_value</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2278" name="src/oscura/analyzers/waveform/spectral.py-2278"></a><span class="hll">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2279" name="src/oscura/analyzers/waveform/spectral.py-2279"></a><span class="hll">            <span class="k">if</span> <span class="n">include_units</span><span class="p">:</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2280" name="src/oscura/analyzers/waveform/spectral.py-2280"></a><span class="hll">                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;dominant_freq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;Hz&quot;</span><span class="p">}</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2281" name="src/oscura/analyzers/waveform/spectral.py-2281"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2282" name="src/oscura/analyzers/waveform/spectral.py-2282"></a><span class="hll">                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;dominant_freq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2283" name="src/oscura/analyzers/waveform/spectral.py-2283"></a>
<a id="src/oscura/analyzers/waveform/spectral.py-2284" name="src/oscura/analyzers/waveform/spectral.py-2284"></a><span class="hll">    <span class="k">return</span> <span class="n">results</span>
</span><a id="src/oscura/analyzers/waveform/spectral.py-2285" name="src/oscura/analyzers/waveform/spectral.py-2285"></a>
<a id="src/oscura/analyzers/waveform/spectral.py-2286" name="src/oscura/analyzers/waveform/spectral.py-2286"></a>
<a id="src/oscura/analyzers/waveform/spectral.py-2287" name="src/oscura/analyzers/waveform/spectral.py-2287"></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
<a id="src/oscura/analyzers/waveform/spectral.py-2288" name="src/oscura/analyzers/waveform/spectral.py-2288"></a>    <span class="s2">&quot;bartlett_psd&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/oscura/automotive/__init__.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/automotive/__init__.py-48" name="src/oscura/automotive/__init__.py-48"></a>
<a id="src/oscura/automotive/__init__.py-49" name="src/oscura/automotive/__init__.py-49"></a>    <span class="n">__version__</span> <span class="o">=</span> <span class="n">version</span><span class="p">(</span><span class="s2">&quot;oscura&quot;</span><span class="p">)</span>
<a id="src/oscura/automotive/__init__.py-50" name="src/oscura/automotive/__init__.py-50"></a><span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="src/oscura/automotive/__init__.py-51" name="src/oscura/automotive/__init__.py-51"></a>    <span class="c1"># Fallback for development/testing when package not installed</span>
<a id="src/oscura/automotive/__init__.py-52" name="src/oscura/automotive/__init__.py-52"></a><span class="hll">    <span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.8.0&quot;</span>
</span><a id="src/oscura/automotive/__init__.py-53" name="src/oscura/automotive/__init__.py-53"></a>
<a id="src/oscura/automotive/__init__.py-54" name="src/oscura/automotive/__init__.py-54"></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
<a id="src/oscura/automotive/__init__.py-55" name="src/oscura/automotive/__init__.py-55"></a>    <span class="s2">&quot;CANMessage&quot;</span><span class="p">,</span>
<a id="src/oscura/automotive/__init__.py-56" name="src/oscura/automotive/__init__.py-56"></a>    <span class="s2">&quot;CANSession&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/oscura/reporting/automation.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/automation.py-141" name="src/oscura/reporting/automation.py-141"></a>    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<a id="src/oscura/reporting/automation.py-142" name="src/oscura/reporting/automation.py-142"></a>    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<a id="src/oscura/reporting/automation.py-143" name="src/oscura/reporting/automation.py-143"></a>
<a id="src/oscura/reporting/automation.py-144" name="src/oscura/reporting/automation.py-144"></a>    <span class="k">if</span> <span class="n">std</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="src/oscura/reporting/automation.py-145" name="src/oscura/reporting/automation.py-145"></a><span class="hll">        <span class="k">return</span> <span class="n">anomalies</span>
</span><a id="src/oscura/reporting/automation.py-146" name="src/oscura/reporting/automation.py-146"></a>
<a id="src/oscura/reporting/automation.py-147" name="src/oscura/reporting/automation.py-147"></a>    <span class="c1"># Check each measurement</span>
<a id="src/oscura/reporting/automation.py-148" name="src/oscura/reporting/automation.py-148"></a>    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">numeric_measurements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="src/oscura/reporting/automation.py-149" name="src/oscura/reporting/automation.py-149"></a>        <span class="n">z_score</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">value</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span><span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/automation.py-161" name="src/oscura/reporting/automation.py-161"></a>
<a id="src/oscura/reporting/automation.py-162" name="src/oscura/reporting/automation.py-162"></a>    <span class="c1"># Domain-specific anomaly checks</span>
<a id="src/oscura/reporting/automation.py-163" name="src/oscura/reporting/automation.py-163"></a>    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">measurements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="src/oscura/reporting/automation.py-164" name="src/oscura/reporting/automation.py-164"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">):</span>
<a id="src/oscura/reporting/automation.py-165" name="src/oscura/reporting/automation.py-165"></a><span class="hll">            <span class="k">continue</span>
</span><a id="src/oscura/reporting/automation.py-166" name="src/oscura/reporting/automation.py-166"></a>
<a id="src/oscura/reporting/automation.py-167" name="src/oscura/reporting/automation.py-167"></a>        <span class="c1"># Negative SNR</span>
<a id="src/oscura/reporting/automation.py-168" name="src/oscura/reporting/automation.py-168"></a>        <span class="k">if</span> <span class="s2">&quot;snr&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="src/oscura/reporting/automation.py-169" name="src/oscura/reporting/automation.py-169"></a>            <span class="n">anomalies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/automation.py-256" name="src/oscura/reporting/automation.py-256"></a>        <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Perform power quality analysis (harmonics, flicker, sags/swells)&quot;</span><span class="p">)</span>
<a id="src/oscura/reporting/automation.py-257" name="src/oscura/reporting/automation.py-257"></a>
<a id="src/oscura/reporting/automation.py-258" name="src/oscura/reporting/automation.py-258"></a>    <span class="c1"># Eye diagram quality issues</span>
<a id="src/oscura/reporting/automation.py-259" name="src/oscura/reporting/automation.py-259"></a>    <span class="k">if</span> <span class="n">interpretations</span><span class="p">:</span>
<a id="src/oscura/reporting/automation.py-260" name="src/oscura/reporting/automation.py-260"></a><span class="hll">        <span class="n">poor_quality</span> <span class="o">=</span> <span class="p">[</span>
</span><a id="src/oscura/reporting/automation.py-261" name="src/oscura/reporting/automation.py-261"></a>            <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">interpretations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">quality</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;marginal&quot;</span><span class="p">,</span> <span class="s2">&quot;poor&quot;</span><span class="p">)</span>
<a id="src/oscura/reporting/automation.py-262" name="src/oscura/reporting/automation.py-262"></a>        <span class="p">]</span>
<a id="src/oscura/reporting/automation.py-263" name="src/oscura/reporting/automation.py-263"></a><span class="hll">        <span class="k">if</span> <span class="n">poor_quality</span><span class="p">:</span>
</span><a id="src/oscura/reporting/automation.py-264" name="src/oscura/reporting/automation.py-264"></a><span class="hll">            <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><a id="src/oscura/reporting/automation.py-265" name="src/oscura/reporting/automation.py-265"></a>                <span class="sa">f</span><span class="s2">&quot;Investigate </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">poor_quality</span><span class="p">)</span><span class="si">}</span><span class="s2"> marginal/poor measurements: &quot;</span>
<a id="src/oscura/reporting/automation.py-266" name="src/oscura/reporting/automation.py-266"></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">poor_quality</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="src/oscura/reporting/automation.py-267" name="src/oscura/reporting/automation.py-267"></a>            <span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/automation.py-336" name="src/oscura/reporting/automation.py-336"></a>    <span class="n">flat</span> <span class="o">=</span> <span class="p">{}</span>
<a id="src/oscura/reporting/automation.py-337" name="src/oscura/reporting/automation.py-337"></a>
<a id="src/oscura/reporting/automation.py-338" name="src/oscura/reporting/automation.py-338"></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="src/oscura/reporting/automation.py-339" name="src/oscura/reporting/automation.py-339"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="src/oscura/reporting/automation.py-340" name="src/oscura/reporting/automation.py-340"></a><span class="hll">            <span class="k">if</span> <span class="s2">&quot;value&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
</span><a id="src/oscura/reporting/automation.py-341" name="src/oscura/reporting/automation.py-341"></a><span class="hll">                <span class="n">flat</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
</span><a id="src/oscura/reporting/automation.py-342" name="src/oscura/reporting/automation.py-342"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/reporting/automation.py-343" name="src/oscura/reporting/automation.py-343"></a><span class="hll">                <span class="n">nested</span> <span class="o">=</span> <span class="n">_flatten_results</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><a id="src/oscura/reporting/automation.py-344" name="src/oscura/reporting/automation.py-344"></a><span class="hll">                <span class="n">flat</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">nested</span><span class="p">)</span>
</span><a id="src/oscura/reporting/automation.py-345" name="src/oscura/reporting/automation.py-345"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>
<a id="src/oscura/reporting/automation.py-346" name="src/oscura/reporting/automation.py-346"></a>            <span class="n">flat</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="src/oscura/reporting/automation.py-347" name="src/oscura/reporting/automation.py-347"></a>
<a id="src/oscura/reporting/automation.py-348" name="src/oscura/reporting/automation.py-348"></a>    <span class="k">return</span> <span class="n">flat</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/oscura/reporting/citations.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/citations.py-250" name="src/oscura/reporting/citations.py-250"></a>
<a id="src/oscura/reporting/citations.py-251" name="src/oscura/reporting/citations.py-251"></a>            <span class="k">if</span> <span class="n">url</span><span class="p">:</span>
<a id="src/oscura/reporting/citations.py-252" name="src/oscura/reporting/citations.py-252"></a>                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;li&gt;&lt;a href=&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s1">&quot; target=&quot;_blank&quot;&gt;</span><span class="si">{</span><span class="n">bib</span><span class="si">}</span><span class="s1">&lt;/a&gt;&lt;/li&gt;&#39;</span><span class="p">)</span>
<a id="src/oscura/reporting/citations.py-253" name="src/oscura/reporting/citations.py-253"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/reporting/citations.py-254" name="src/oscura/reporting/citations.py-254"></a><span class="hll">                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;li&gt;</span><span class="si">{</span><span class="n">bib</span><span class="si">}</span><span class="s2">&lt;/li&gt;&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/citations.py-255" name="src/oscura/reporting/citations.py-255"></a>
<a id="src/oscura/reporting/citations.py-256" name="src/oscura/reporting/citations.py-256"></a>        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;&lt;/ol&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">])</span>
<a id="src/oscura/reporting/citations.py-257" name="src/oscura/reporting/citations.py-257"></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/citations.py-368" name="src/oscura/reporting/citations.py-368"></a>    <span class="c1"># Oscilloscope/digitizer -&gt; IEEE 1057</span>
<a id="src/oscura/reporting/citations.py-369" name="src/oscura/reporting/citations.py-369"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
<a id="src/oscura/reporting/citations.py-370" name="src/oscura/reporting/citations.py-370"></a>        <span class="n">term</span> <span class="ow">in</span> <span class="n">measurement_lower</span> <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;bandwidth&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;resolution&quot;</span><span class="p">,</span> <span class="s2">&quot;accuracy&quot;</span><span class="p">]</span>
<a id="src/oscura/reporting/citations.py-371" name="src/oscura/reporting/citations.py-371"></a>    <span class="p">):</span>
<a id="src/oscura/reporting/citations.py-372" name="src/oscura/reporting/citations.py-372"></a><span class="hll">        <span class="k">return</span> <span class="s2">&quot;1057&quot;</span>
</span><a id="src/oscura/reporting/citations.py-373" name="src/oscura/reporting/citations.py-373"></a>
<a id="src/oscura/reporting/citations.py-374" name="src/oscura/reporting/citations.py-374"></a>    <span class="k">return</span> <span class="kc">None</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/oscura/reporting/formatting/measurements.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/formatting/measurements.py-40" name="src/oscura/reporting/formatting/measurements.py-40"></a>
<a id="src/oscura/reporting/formatting/measurements.py-41" name="src/oscura/reporting/formatting/measurements.py-41"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/oscura/reporting/formatting/measurements.py-42" name="src/oscura/reporting/formatting/measurements.py-42"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize number formatter if not provided.&quot;&quot;&quot;</span>
<a id="src/oscura/reporting/formatting/measurements.py-43" name="src/oscura/reporting/formatting/measurements.py-43"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_formatter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/oscura/reporting/formatting/measurements.py-44" name="src/oscura/reporting/formatting/measurements.py-44"></a><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">number_formatter</span> <span class="o">=</span> <span class="n">NumberFormatter</span><span class="p">(</span><span class="n">sig_figs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_sig_figs</span><span class="p">)</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-45" name="src/oscura/reporting/formatting/measurements.py-45"></a>
<a id="src/oscura/reporting/formatting/measurements.py-46" name="src/oscura/reporting/formatting/measurements.py-46"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">format_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="src/oscura/reporting/formatting/measurements.py-47" name="src/oscura/reporting/formatting/measurements.py-47"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Format single measurement value with SI prefix and unit.</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/formatting/measurements.py-72" name="src/oscura/reporting/formatting/measurements.py-72"></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">formatted</span><span class="si">}</span><span class="s2"> %&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_units</span> <span class="k">else</span> <span class="n">formatted</span>
<a id="src/oscura/reporting/formatting/measurements.py-73" name="src/oscura/reporting/formatting/measurements.py-73"></a>
<a id="src/oscura/reporting/formatting/measurements.py-74" name="src/oscura/reporting/formatting/measurements.py-74"></a>        <span class="c1"># Handle percentages (THD, etc.) that are already in percentage units</span>
<a id="src/oscura/reporting/formatting/measurements.py-75" name="src/oscura/reporting/formatting/measurements.py-75"></a>        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;%&quot;</span><span class="p">:</span>
<a id="src/oscura/reporting/formatting/measurements.py-76" name="src/oscura/reporting/formatting/measurements.py-76"></a><span class="hll">            <span class="n">formatted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_formatter</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-77" name="src/oscura/reporting/formatting/measurements.py-77"></a><span class="hll">            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">formatted</span><span class="si">}</span><span class="s2"> %&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_units</span> <span class="k">else</span> <span class="n">formatted</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-78" name="src/oscura/reporting/formatting/measurements.py-78"></a>
<a id="src/oscura/reporting/formatting/measurements.py-79" name="src/oscura/reporting/formatting/measurements.py-79"></a>        <span class="c1"># Handle dimensionless values</span>
<a id="src/oscura/reporting/formatting/measurements.py-80" name="src/oscura/reporting/formatting/measurements.py-80"></a>        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="src/oscura/reporting/formatting/measurements.py-81" name="src/oscura/reporting/formatting/measurements.py-81"></a><span class="hll">            <span class="n">formatted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_formatter</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-82" name="src/oscura/reporting/formatting/measurements.py-82"></a><span class="hll">            <span class="k">return</span> <span class="n">formatted</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-83" name="src/oscura/reporting/formatting/measurements.py-83"></a>
<a id="src/oscura/reporting/formatting/measurements.py-84" name="src/oscura/reporting/formatting/measurements.py-84"></a>        <span class="c1"># Use NumberFormatter&#39;s built-in SI prefix support for other units</span>
<a id="src/oscura/reporting/formatting/measurements.py-85" name="src/oscura/reporting/formatting/measurements.py-85"></a>        <span class="n">formatted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_formatter</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a id="src/oscura/reporting/formatting/measurements.py-86" name="src/oscura/reporting/formatting/measurements.py-86"></a>        <span class="k">return</span> <span class="n">formatted</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_units</span> <span class="k">else</span> <span class="n">formatted</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/formatting/measurements.py-114" name="src/oscura/reporting/formatting/measurements.py-114"></a>        <span class="n">value</span> <span class="o">=</span> <span class="n">measurement</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
<a id="src/oscura/reporting/formatting/measurements.py-115" name="src/oscura/reporting/formatting/measurements.py-115"></a>        <span class="n">unit</span> <span class="o">=</span> <span class="n">measurement</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="src/oscura/reporting/formatting/measurements.py-116" name="src/oscura/reporting/formatting/measurements.py-116"></a>
<a id="src/oscura/reporting/formatting/measurements.py-117" name="src/oscura/reporting/formatting/measurements.py-117"></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="src/oscura/reporting/formatting/measurements.py-118" name="src/oscura/reporting/formatting/measurements.py-118"></a><span class="hll">            <span class="k">return</span> <span class="s2">&quot;N/A&quot;</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-119" name="src/oscura/reporting/formatting/measurements.py-119"></a>
<a id="src/oscura/reporting/formatting/measurements.py-120" name="src/oscura/reporting/formatting/measurements.py-120"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
<a id="src/oscura/reporting/formatting/measurements.py-121" name="src/oscura/reporting/formatting/measurements.py-121"></a><span class="hll">            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-122" name="src/oscura/reporting/formatting/measurements.py-122"></a>
<a id="src/oscura/reporting/formatting/measurements.py-123" name="src/oscura/reporting/formatting/measurements.py-123"></a>        <span class="c1"># Format the value</span>
<a id="src/oscura/reporting/formatting/measurements.py-124" name="src/oscura/reporting/formatting/measurements.py-124"></a>        <span class="n">formatted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_single</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/formatting/measurements.py-124" name="src/oscura/reporting/formatting/measurements.py-124"></a>        <span class="n">formatted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_single</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a id="src/oscura/reporting/formatting/measurements.py-125" name="src/oscura/reporting/formatting/measurements.py-125"></a>
<a id="src/oscura/reporting/formatting/measurements.py-126" name="src/oscura/reporting/formatting/measurements.py-126"></a>        <span class="c1"># Add spec comparison if requested</span>
<a id="src/oscura/reporting/formatting/measurements.py-127" name="src/oscura/reporting/formatting/measurements.py-127"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_specs</span> <span class="ow">and</span> <span class="s2">&quot;spec&quot;</span> <span class="ow">in</span> <span class="n">measurement</span><span class="p">:</span>
<a id="src/oscura/reporting/formatting/measurements.py-128" name="src/oscura/reporting/formatting/measurements.py-128"></a><span class="hll">            <span class="n">spec</span> <span class="o">=</span> <span class="n">measurement</span><span class="p">[</span><span class="s2">&quot;spec&quot;</span><span class="p">]</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-129" name="src/oscura/reporting/formatting/measurements.py-129"></a><span class="hll">            <span class="n">spec_type</span> <span class="o">=</span> <span class="n">measurement</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;spec_type&quot;</span><span class="p">,</span> <span class="s2">&quot;exact&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-130" name="src/oscura/reporting/formatting/measurements.py-130"></a><span class="hll">            <span class="n">spec_formatted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_single</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-131" name="src/oscura/reporting/formatting/measurements.py-131"></a>
<a id="src/oscura/reporting/formatting/measurements.py-132" name="src/oscura/reporting/formatting/measurements.py-132"></a><span class="hll">            <span class="k">if</span> <span class="n">spec_type</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-133" name="src/oscura/reporting/formatting/measurements.py-133"></a><span class="hll">                <span class="n">formatted</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (spec: &lt; </span><span class="si">{</span><span class="n">spec_formatted</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-134" name="src/oscura/reporting/formatting/measurements.py-134"></a><span class="hll">            <span class="k">elif</span> <span class="n">spec_type</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-135" name="src/oscura/reporting/formatting/measurements.py-135"></a><span class="hll">                <span class="n">formatted</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (spec: &gt; </span><span class="si">{</span><span class="n">spec_formatted</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-136" name="src/oscura/reporting/formatting/measurements.py-136"></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># exact</span>
<a id="src/oscura/reporting/formatting/measurements.py-137" name="src/oscura/reporting/formatting/measurements.py-137"></a><span class="hll">                <span class="n">formatted</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (spec: </span><span class="si">{</span><span class="n">spec_formatted</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-138" name="src/oscura/reporting/formatting/measurements.py-138"></a>
<a id="src/oscura/reporting/formatting/measurements.py-139" name="src/oscura/reporting/formatting/measurements.py-139"></a>            <span class="c1"># Add pass/fail indicator</span>
<a id="src/oscura/reporting/formatting/measurements.py-140" name="src/oscura/reporting/formatting/measurements.py-140"></a><span class="hll">            <span class="k">if</span> <span class="s2">&quot;passed&quot;</span> <span class="ow">in</span> <span class="n">measurement</span><span class="p">:</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-141" name="src/oscura/reporting/formatting/measurements.py-141"></a><span class="hll">                <span class="n">formatted</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="k">if</span> <span class="n">measurement</span><span class="p">[</span><span class="s2">&quot;passed&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot; &quot;</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-142" name="src/oscura/reporting/formatting/measurements.py-142"></a>
<a id="src/oscura/reporting/formatting/measurements.py-143" name="src/oscura/reporting/formatting/measurements.py-143"></a>        <span class="k">return</span> <span class="n">formatted</span>
<a id="src/oscura/reporting/formatting/measurements.py-144" name="src/oscura/reporting/formatting/measurements.py-144"></a>
<a id="src/oscura/reporting/formatting/measurements.py-145" name="src/oscura/reporting/formatting/measurements.py-145"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">format_measurement_dict</span><span class="p">(</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/formatting/measurements.py-172" name="src/oscura/reporting/formatting/measurements.py-172"></a>
<a id="src/oscura/reporting/formatting/measurements.py-173" name="src/oscura/reporting/formatting/measurements.py-173"></a>            <span class="k">if</span> <span class="n">html</span><span class="p">:</span>
<a id="src/oscura/reporting/formatting/measurements.py-174" name="src/oscura/reporting/formatting/measurements.py-174"></a>                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;li&gt;&lt;strong&gt;</span><span class="si">{</span><span class="n">display_name</span><span class="si">}</span><span class="s2">:&lt;/strong&gt; </span><span class="si">{</span><span class="n">formatted_value</span><span class="si">}</span><span class="s2">&lt;/li&gt;&quot;</span><span class="p">)</span>
<a id="src/oscura/reporting/formatting/measurements.py-175" name="src/oscura/reporting/formatting/measurements.py-175"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/reporting/formatting/measurements.py-176" name="src/oscura/reporting/formatting/measurements.py-176"></a><span class="hll">                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">display_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">formatted_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-177" name="src/oscura/reporting/formatting/measurements.py-177"></a>
<a id="src/oscura/reporting/formatting/measurements.py-178" name="src/oscura/reporting/formatting/measurements.py-178"></a>        <span class="k">if</span> <span class="n">html</span><span class="p">:</span>
<a id="src/oscura/reporting/formatting/measurements.py-179" name="src/oscura/reporting/formatting/measurements.py-179"></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;ul&gt;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&lt;/ul&gt;&quot;</span>
<a id="src/oscura/reporting/formatting/measurements.py-180" name="src/oscura/reporting/formatting/measurements.py-180"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/reporting/formatting/measurements.py-181" name="src/oscura/reporting/formatting/measurements.py-181"></a><span class="hll">            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-182" name="src/oscura/reporting/formatting/measurements.py-182"></a>
<a id="src/oscura/reporting/formatting/measurements.py-183" name="src/oscura/reporting/formatting/measurements.py-183"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_display_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurements</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<a id="src/oscura/reporting/formatting/measurements.py-184" name="src/oscura/reporting/formatting/measurements.py-184"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert measurements to display-ready string dictionary.</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/formatting/measurements.py-194" name="src/oscura/reporting/formatting/measurements.py-194"></a><span class="sd">            &gt;&gt;&gt; measurements = {&quot;rise_time&quot;: {&quot;value&quot;: 2.3e-9, &quot;unit&quot;: &quot;s&quot;}}</span>
<a id="src/oscura/reporting/formatting/measurements.py-195" name="src/oscura/reporting/formatting/measurements.py-195"></a><span class="sd">            &gt;&gt;&gt; formatter.to_display_dict(measurements)</span>
<a id="src/oscura/reporting/formatting/measurements.py-196" name="src/oscura/reporting/formatting/measurements.py-196"></a><span class="sd">            {&#39;rise_time&#39;: &#39;2.30 ns&#39;}</span>
<a id="src/oscura/reporting/formatting/measurements.py-197" name="src/oscura/reporting/formatting/measurements.py-197"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="src/oscura/reporting/formatting/measurements.py-198" name="src/oscura/reporting/formatting/measurements.py-198"></a><span class="hll">        <span class="k">return</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_measurement</span><span class="p">(</span><span class="n">meas</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">meas</span> <span class="ow">in</span> <span class="n">measurements</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-199" name="src/oscura/reporting/formatting/measurements.py-199"></a>
<a id="src/oscura/reporting/formatting/measurements.py-200" name="src/oscura/reporting/formatting/measurements.py-200"></a>
<a id="src/oscura/reporting/formatting/measurements.py-201" name="src/oscura/reporting/formatting/measurements.py-201"></a><span class="k">def</span><span class="w"> </span><span class="nf">format_measurement</span><span class="p">(</span><span class="n">measurement</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">sig_figs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="src/oscura/reporting/formatting/measurements.py-202" name="src/oscura/reporting/formatting/measurements.py-202"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Quick format single measurement dict.</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/formatting/measurements.py-214" name="src/oscura/reporting/formatting/measurements.py-214"></a><span class="sd">    Example:</span>
<a id="src/oscura/reporting/formatting/measurements.py-215" name="src/oscura/reporting/formatting/measurements.py-215"></a><span class="sd">        &gt;&gt;&gt; format_measurement({&quot;value&quot;: 2.3e-9, &quot;unit&quot;: &quot;s&quot;})</span>
<a id="src/oscura/reporting/formatting/measurements.py-216" name="src/oscura/reporting/formatting/measurements.py-216"></a><span class="sd">        &#39;2.300 ns&#39;</span>
<a id="src/oscura/reporting/formatting/measurements.py-217" name="src/oscura/reporting/formatting/measurements.py-217"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/reporting/formatting/measurements.py-218" name="src/oscura/reporting/formatting/measurements.py-218"></a><span class="hll">    <span class="n">formatter</span> <span class="o">=</span> <span class="n">MeasurementFormatter</span><span class="p">(</span><span class="n">number_formatter</span><span class="o">=</span><span class="n">NumberFormatter</span><span class="p">(</span><span class="n">sig_figs</span><span class="o">=</span><span class="n">sig_figs</span><span class="p">))</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-219" name="src/oscura/reporting/formatting/measurements.py-219"></a><span class="hll">    <span class="k">return</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_measurement</span><span class="p">(</span><span class="n">measurement</span><span class="p">)</span>
</span><a id="src/oscura/reporting/formatting/measurements.py-220" name="src/oscura/reporting/formatting/measurements.py-220"></a>
<a id="src/oscura/reporting/formatting/measurements.py-221" name="src/oscura/reporting/formatting/measurements.py-221"></a>
<a id="src/oscura/reporting/formatting/measurements.py-222" name="src/oscura/reporting/formatting/measurements.py-222"></a><span class="k">def</span><span class="w"> </span><span class="nf">format_measurement_dict</span><span class="p">(</span>
<a id="src/oscura/reporting/formatting/measurements.py-223" name="src/oscura/reporting/formatting/measurements.py-223"></a>    <span class="n">measurements</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">sig_figs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">html</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/oscura/reporting/html.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/html.py-549" name="src/oscura/reporting/html.py-549"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Render section content (text, tables, figures).&quot;&quot;&quot;</span>
<a id="src/oscura/reporting/html.py-550" name="src/oscura/reporting/html.py-550"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="src/oscura/reporting/html.py-551" name="src/oscura/reporting/html.py-551"></a>        <span class="c1"># Check if content is already HTML (starts with HTML tag)</span>
<a id="src/oscura/reporting/html.py-552" name="src/oscura/reporting/html.py-552"></a>        <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">):</span>
<a id="src/oscura/reporting/html.py-553" name="src/oscura/reporting/html.py-553"></a><span class="hll">            <span class="k">return</span> <span class="n">section</span><span class="o">.</span><span class="n">content</span>  <span class="c1"># Return HTML as-is</span>
</span><a id="src/oscura/reporting/html.py-554" name="src/oscura/reporting/html.py-554"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;</span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&lt;/p&gt;&quot;</span>
<a id="src/oscura/reporting/html.py-555" name="src/oscura/reporting/html.py-555"></a>
<a id="src/oscura/reporting/html.py-556" name="src/oscura/reporting/html.py-556"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="src/oscura/reporting/html.py-557" name="src/oscura/reporting/html.py-557"></a>        <span class="k">return</span> <span class="n">_render_content_list</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/html.py-676" name="src/oscura/reporting/html.py-676"></a>
<a id="src/oscura/reporting/html.py-677" name="src/oscura/reporting/html.py-677"></a>    <span class="k">for</span> <span class="n">plot_name</span><span class="p">,</span> <span class="n">plot_data</span> <span class="ow">in</span> <span class="n">plots</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="src/oscura/reporting/html.py-678" name="src/oscura/reporting/html.py-678"></a>        <span class="c1"># Ensure data URI format</span>
<a id="src/oscura/reporting/html.py-679" name="src/oscura/reporting/html.py-679"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">plot_data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;data:&quot;</span><span class="p">):</span>
<a id="src/oscura/reporting/html.py-680" name="src/oscura/reporting/html.py-680"></a><span class="hll">            <span class="n">plot_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;data:image/png;base64,</span><span class="si">{</span><span class="n">plot_data</span><span class="si">}</span><span class="s2">&quot;</span>
</span><a id="src/oscura/reporting/html.py-681" name="src/oscura/reporting/html.py-681"></a>
<a id="src/oscura/reporting/html.py-682" name="src/oscura/reporting/html.py-682"></a>        <span class="n">plot_html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&lt;h3&gt;</span><span class="si">{</span><span class="n">plot_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/h3&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="src/oscura/reporting/html.py-683" name="src/oscura/reporting/html.py-683"></a>        <span class="n">plot_html</span> <span class="o">+=</span> <span class="p">(</span>
<a id="src/oscura/reporting/html.py-684" name="src/oscura/reporting/html.py-684"></a>            <span class="sa">f</span><span class="s1">&#39;&lt;img src=&quot;</span><span class="si">{</span><span class="n">plot_data</span><span class="si">}</span><span class="s1">&quot; alt=&quot;</span><span class="si">{</span><span class="n">plot_name</span><span class="si">}</span><span class="s1">&quot; &#39;</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/html.py-691" name="src/oscura/reporting/html.py-691"></a>    <span class="c1"># Insert at specified location</span>
<a id="src/oscura/reporting/html.py-692" name="src/oscura/reporting/html.py-692"></a>    <span class="k">if</span> <span class="n">insert_location</span> <span class="o">==</span> <span class="s2">&quot;before_closing_div&quot;</span> <span class="ow">and</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span> <span class="ow">in</span> <span class="n">html_content</span><span class="p">:</span>
<a id="src/oscura/reporting/html.py-693" name="src/oscura/reporting/html.py-693"></a>        <span class="n">html_content</span> <span class="o">=</span> <span class="n">html_content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plot_html</span><span class="si">}</span><span class="s2">&lt;/div&gt;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="src/oscura/reporting/html.py-694" name="src/oscura/reporting/html.py-694"></a>    <span class="k">elif</span> <span class="n">insert_location</span> <span class="o">==</span> <span class="s2">&quot;before_closing_body&quot;</span> <span class="ow">and</span> <span class="s2">&quot;&lt;/body&gt;&quot;</span> <span class="ow">in</span> <span class="n">html_content</span><span class="p">:</span>
<a id="src/oscura/reporting/html.py-695" name="src/oscura/reporting/html.py-695"></a><span class="hll">        <span class="n">html_content</span> <span class="o">=</span> <span class="n">html_content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;/body&gt;&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plot_html</span><span class="si">}</span><span class="s2">&lt;/body&gt;&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/html.py-696" name="src/oscura/reporting/html.py-696"></a>    <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/reporting/html.py-697" name="src/oscura/reporting/html.py-697"></a>        <span class="c1"># Append to end</span>
<a id="src/oscura/reporting/html.py-698" name="src/oscura/reporting/html.py-698"></a>        <span class="n">html_content</span> <span class="o">+=</span> <span class="n">plot_html</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/oscura/reporting/interpretation.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/interpretation.py-117" name="src/oscura/reporting/interpretation.py-117"></a>
<a id="src/oscura/reporting/interpretation.py-118" name="src/oscura/reporting/interpretation.py-118"></a>    <span class="c1"># Rise time interpretation</span>
<a id="src/oscura/reporting/interpretation.py-119" name="src/oscura/reporting/interpretation.py-119"></a>    <span class="k">if</span> <span class="s2">&quot;rise&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;fall&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<a id="src/oscura/reporting/interpretation.py-120" name="src/oscura/reporting/interpretation.py-120"></a>        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mf">1e-9</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-121" name="src/oscura/reporting/interpretation.py-121"></a><span class="hll">            <span class="n">interpretation</span> <span class="o">=</span> <span class="s2">&quot;Very fast transition time, indicating high bandwidth signal path&quot;</span>
</span><a id="src/oscura/reporting/interpretation.py-122" name="src/oscura/reporting/interpretation.py-122"></a><span class="hll">            <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">EXCELLENT</span>
</span><a id="src/oscura/reporting/interpretation.py-123" name="src/oscura/reporting/interpretation.py-123"></a>        <span class="k">elif</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mf">10e-9</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-124" name="src/oscura/reporting/interpretation.py-124"></a>            <span class="n">interpretation</span> <span class="o">=</span> <span class="s2">&quot;Fast transition time, suitable for high-speed digital signals&quot;</span>
<a id="src/oscura/reporting/interpretation.py-125" name="src/oscura/reporting/interpretation.py-125"></a>            <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">GOOD</span>
<a id="src/oscura/reporting/interpretation.py-126" name="src/oscura/reporting/interpretation.py-126"></a>        <span class="k">elif</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mf">100e-9</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-127" name="src/oscura/reporting/interpretation.py-127"></a><span class="hll">            <span class="n">interpretation</span> <span class="o">=</span> <span class="s2">&quot;Moderate transition time, adequate for standard digital signals&quot;</span>
</span><a id="src/oscura/reporting/interpretation.py-128" name="src/oscura/reporting/interpretation.py-128"></a><span class="hll">            <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">ACCEPTABLE</span>
</span><a id="src/oscura/reporting/interpretation.py-129" name="src/oscura/reporting/interpretation.py-129"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-130" name="src/oscura/reporting/interpretation.py-130"></a>            <span class="n">interpretation</span> <span class="o">=</span> <span class="s2">&quot;Slow transition time, may limit signal bandwidth&quot;</span>
<a id="src/oscura/reporting/interpretation.py-131" name="src/oscura/reporting/interpretation.py-131"></a>            <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">MARGINAL</span>
<a id="src/oscura/reporting/interpretation.py-132" name="src/oscura/reporting/interpretation.py-132"></a>            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Consider improving signal path bandwidth&quot;</span><span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/interpretation.py-139" name="src/oscura/reporting/interpretation.py-139"></a>        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-140" name="src/oscura/reporting/interpretation.py-140"></a>            <span class="n">interpretation</span> <span class="o">=</span> <span class="s2">&quot;Good signal-to-noise ratio, acceptable for most applications&quot;</span>
<a id="src/oscura/reporting/interpretation.py-141" name="src/oscura/reporting/interpretation.py-141"></a>            <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">GOOD</span>
<a id="src/oscura/reporting/interpretation.py-142" name="src/oscura/reporting/interpretation.py-142"></a>        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-143" name="src/oscura/reporting/interpretation.py-143"></a><span class="hll">            <span class="n">interpretation</span> <span class="o">=</span> <span class="s2">&quot;Moderate SNR, noise may affect precision measurements&quot;</span>
</span><a id="src/oscura/reporting/interpretation.py-144" name="src/oscura/reporting/interpretation.py-144"></a><span class="hll">            <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">ACCEPTABLE</span>
</span><a id="src/oscura/reporting/interpretation.py-145" name="src/oscura/reporting/interpretation.py-145"></a><span class="hll">            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Consider noise reduction techniques&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/interpretation.py-146" name="src/oscura/reporting/interpretation.py-146"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-147" name="src/oscura/reporting/interpretation.py-147"></a>            <span class="n">interpretation</span> <span class="o">=</span> <span class="s2">&quot;Poor SNR, signal quality compromised by noise&quot;</span>
<a id="src/oscura/reporting/interpretation.py-148" name="src/oscura/reporting/interpretation.py-148"></a>            <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">POOR</span>
<a id="src/oscura/reporting/interpretation.py-149" name="src/oscura/reporting/interpretation.py-149"></a>            <span class="n">recommendations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/interpretation.py-157" name="src/oscura/reporting/interpretation.py-157"></a>        <span class="k">if</span> <span class="n">jitter_ps</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-158" name="src/oscura/reporting/interpretation.py-158"></a>            <span class="n">interpretation</span> <span class="o">=</span> <span class="s2">&quot;Very low jitter, excellent timing stability&quot;</span>
<a id="src/oscura/reporting/interpretation.py-159" name="src/oscura/reporting/interpretation.py-159"></a>            <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">EXCELLENT</span>
<a id="src/oscura/reporting/interpretation.py-160" name="src/oscura/reporting/interpretation.py-160"></a>        <span class="k">elif</span> <span class="n">jitter_ps</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-161" name="src/oscura/reporting/interpretation.py-161"></a><span class="hll">            <span class="n">interpretation</span> <span class="o">=</span> <span class="s2">&quot;Low jitter, good timing performance&quot;</span>
</span><a id="src/oscura/reporting/interpretation.py-162" name="src/oscura/reporting/interpretation.py-162"></a><span class="hll">            <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">GOOD</span>
</span><a id="src/oscura/reporting/interpretation.py-163" name="src/oscura/reporting/interpretation.py-163"></a>        <span class="k">elif</span> <span class="n">jitter_ps</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-164" name="src/oscura/reporting/interpretation.py-164"></a>            <span class="n">interpretation</span> <span class="o">=</span> <span class="s2">&quot;Moderate jitter, acceptable for most applications&quot;</span>
<a id="src/oscura/reporting/interpretation.py-165" name="src/oscura/reporting/interpretation.py-165"></a>            <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">ACCEPTABLE</span>
<a id="src/oscura/reporting/interpretation.py-166" name="src/oscura/reporting/interpretation.py-166"></a>        <span class="k">else</span><span class="p">:</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/interpretation.py-180" name="src/oscura/reporting/interpretation.py-180"></a>                <span class="sa">f</span><span class="s2">&quot;Good bandwidth (</span><span class="si">{</span><span class="n">value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1e6</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> MHz), adequate for most applications&quot;</span>
<a id="src/oscura/reporting/interpretation.py-181" name="src/oscura/reporting/interpretation.py-181"></a>            <span class="p">)</span>
<a id="src/oscura/reporting/interpretation.py-182" name="src/oscura/reporting/interpretation.py-182"></a>            <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">GOOD</span>
<a id="src/oscura/reporting/interpretation.py-183" name="src/oscura/reporting/interpretation.py-183"></a>        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mf">10e6</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-184" name="src/oscura/reporting/interpretation.py-184"></a><span class="hll">            <span class="n">interpretation</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Moderate bandwidth (</span><span class="si">{</span><span class="n">value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1e6</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MHz)&quot;</span>
</span><a id="src/oscura/reporting/interpretation.py-185" name="src/oscura/reporting/interpretation.py-185"></a><span class="hll">            <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">ACCEPTABLE</span>
</span><a id="src/oscura/reporting/interpretation.py-186" name="src/oscura/reporting/interpretation.py-186"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-187" name="src/oscura/reporting/interpretation.py-187"></a>            <span class="n">interpretation</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Limited bandwidth (</span><span class="si">{</span><span class="n">value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1e6</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MHz)&quot;</span>
<a id="src/oscura/reporting/interpretation.py-188" name="src/oscura/reporting/interpretation.py-188"></a>            <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">MARGINAL</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/interpretation.py-207" name="src/oscura/reporting/interpretation.py-207"></a>
<a id="src/oscura/reporting/interpretation.py-208" name="src/oscura/reporting/interpretation.py-208"></a>                <span class="k">if</span> <span class="n">min_margin</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-209" name="src/oscura/reporting/interpretation.py-209"></a>                    <span class="n">interpretation</span> <span class="o">=</span> <span class="s2">&quot;Well within specification with good margin&quot;</span>
<a id="src/oscura/reporting/interpretation.py-210" name="src/oscura/reporting/interpretation.py-210"></a>                    <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">GOOD</span>
<a id="src/oscura/reporting/interpretation.py-211" name="src/oscura/reporting/interpretation.py-211"></a><span class="hll">                <span class="k">elif</span> <span class="n">min_margin</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
</span><a id="src/oscura/reporting/interpretation.py-212" name="src/oscura/reporting/interpretation.py-212"></a><span class="hll">                    <span class="n">interpretation</span> <span class="o">=</span> <span class="s2">&quot;Within specification with adequate margin&quot;</span>
</span><a id="src/oscura/reporting/interpretation.py-213" name="src/oscura/reporting/interpretation.py-213"></a><span class="hll">                    <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">ACCEPTABLE</span>
</span><a id="src/oscura/reporting/interpretation.py-214" name="src/oscura/reporting/interpretation.py-214"></a>                <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-215" name="src/oscura/reporting/interpretation.py-215"></a><span class="hll">                    <span class="n">interpretation</span> <span class="o">=</span> <span class="s2">&quot;Within specification but marginal&quot;</span>
</span><a id="src/oscura/reporting/interpretation.py-216" name="src/oscura/reporting/interpretation.py-216"></a><span class="hll">                    <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">MARGINAL</span>
</span><a id="src/oscura/reporting/interpretation.py-217" name="src/oscura/reporting/interpretation.py-217"></a><span class="hll">                    <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Low margin to specification limits&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/interpretation.py-218" name="src/oscura/reporting/interpretation.py-218"></a>            <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-219" name="src/oscura/reporting/interpretation.py-219"></a><span class="hll">                <span class="n">interpretation</span> <span class="o">=</span> <span class="s2">&quot;Within specification&quot;</span>
</span><a id="src/oscura/reporting/interpretation.py-220" name="src/oscura/reporting/interpretation.py-220"></a><span class="hll">                <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">ACCEPTABLE</span>
</span><a id="src/oscura/reporting/interpretation.py-221" name="src/oscura/reporting/interpretation.py-221"></a>
<a id="src/oscura/reporting/interpretation.py-222" name="src/oscura/reporting/interpretation.py-222"></a>    <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-223" name="src/oscura/reporting/interpretation.py-223"></a>        <span class="n">interpretation</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Measured value: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="src/oscura/reporting/interpretation.py-224" name="src/oscura/reporting/interpretation.py-224"></a>        <span class="n">quality</span> <span class="o">=</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">ACCEPTABLE</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/interpretation.py-261" name="src/oscura/reporting/interpretation.py-261"></a>    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">measurements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="src/oscura/reporting/interpretation.py-262" name="src/oscura/reporting/interpretation.py-262"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
<a id="src/oscura/reporting/interpretation.py-263" name="src/oscura/reporting/interpretation.py-263"></a>            <span class="n">description_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="src/oscura/reporting/interpretation.py-264" name="src/oscura/reporting/interpretation.py-264"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/reporting/interpretation.py-265" name="src/oscura/reporting/interpretation.py-265"></a><span class="hll">            <span class="n">description_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/interpretation.py-266" name="src/oscura/reporting/interpretation.py-266"></a>
<a id="src/oscura/reporting/interpretation.py-267" name="src/oscura/reporting/interpretation.py-267"></a>    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">description_parts</span><span class="p">)</span>
<a id="src/oscura/reporting/interpretation.py-268" name="src/oscura/reporting/interpretation.py-268"></a>
<a id="src/oscura/reporting/interpretation.py-269" name="src/oscura/reporting/interpretation.py-269"></a>    <span class="n">recommendation</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/oscura/reporting/summary.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/summary.py-49" name="src/oscura/reporting/summary.py-49"></a><span class="sd">        &gt;&gt;&gt; summary = generate_executive_summary(measurements)</span>
<a id="src/oscura/reporting/summary.py-50" name="src/oscura/reporting/summary.py-50"></a><span class="sd">        &gt;&gt;&gt; &quot;Executive Summary&quot; in summary or len(summary) &gt; 0</span>
<a id="src/oscura/reporting/summary.py-51" name="src/oscura/reporting/summary.py-51"></a><span class="sd">        True</span>
<a id="src/oscura/reporting/summary.py-52" name="src/oscura/reporting/summary.py-52"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/reporting/summary.py-53" name="src/oscura/reporting/summary.py-53"></a><span class="hll">    <span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/oscura/reporting/summary.py-54" name="src/oscura/reporting/summary.py-54"></a>
<a id="src/oscura/reporting/summary.py-55" name="src/oscura/reporting/summary.py-55"></a>    <span class="c1"># Overall status</span>
<a id="src/oscura/reporting/summary.py-56" name="src/oscura/reporting/summary.py-56"></a><span class="hll">    <span class="n">status_section</span> <span class="o">=</span> <span class="n">_generate_status_section</span><span class="p">(</span><span class="n">measurements</span><span class="p">,</span> <span class="n">interpretations</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-57" name="src/oscura/reporting/summary.py-57"></a><span class="hll">    <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">status_section</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-58" name="src/oscura/reporting/summary.py-58"></a>
<a id="src/oscura/reporting/summary.py-59" name="src/oscura/reporting/summary.py-59"></a>    <span class="c1"># Key findings</span>
<a id="src/oscura/reporting/summary.py-60" name="src/oscura/reporting/summary.py-60"></a><span class="hll">    <span class="n">findings_section</span> <span class="o">=</span> <span class="n">_generate_findings_section</span><span class="p">(</span><span class="n">measurements</span><span class="p">,</span> <span class="n">interpretations</span><span class="p">,</span> <span class="n">max_findings</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-61" name="src/oscura/reporting/summary.py-61"></a><span class="hll">    <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">findings_section</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-62" name="src/oscura/reporting/summary.py-62"></a>
<a id="src/oscura/reporting/summary.py-63" name="src/oscura/reporting/summary.py-63"></a>    <span class="c1"># Recommendations</span>
<a id="src/oscura/reporting/summary.py-64" name="src/oscura/reporting/summary.py-64"></a><span class="hll">    <span class="k">if</span> <span class="n">interpretations</span><span class="p">:</span>
</span><a id="src/oscura/reporting/summary.py-65" name="src/oscura/reporting/summary.py-65"></a><span class="hll">        <span class="n">rec_section</span> <span class="o">=</span> <span class="n">_generate_recommendations_section</span><span class="p">(</span><span class="n">interpretations</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-66" name="src/oscura/reporting/summary.py-66"></a><span class="hll">        <span class="k">if</span> <span class="n">rec_section</span><span class="o">.</span><span class="n">bullet_points</span><span class="p">:</span>
</span><a id="src/oscura/reporting/summary.py-67" name="src/oscura/reporting/summary.py-67"></a><span class="hll">            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec_section</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-68" name="src/oscura/reporting/summary.py-68"></a>
<a id="src/oscura/reporting/summary.py-69" name="src/oscura/reporting/summary.py-69"></a>    <span class="c1"># Format as text</span>
<a id="src/oscura/reporting/summary.py-70" name="src/oscura/reporting/summary.py-70"></a><span class="hll">    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;# Executive Summary&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
</span><a id="src/oscura/reporting/summary.py-71" name="src/oscura/reporting/summary.py-71"></a>
<a id="src/oscura/reporting/summary.py-72" name="src/oscura/reporting/summary.py-72"></a><span class="hll">    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
</span><a id="src/oscura/reporting/summary.py-73" name="src/oscura/reporting/summary.py-73"></a><span class="hll">        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">section</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-74" name="src/oscura/reporting/summary.py-74"></a><span class="hll">        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-75" name="src/oscura/reporting/summary.py-75"></a>
<a id="src/oscura/reporting/summary.py-76" name="src/oscura/reporting/summary.py-76"></a><span class="hll">        <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span><a id="src/oscura/reporting/summary.py-77" name="src/oscura/reporting/summary.py-77"></a><span class="hll">            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-78" name="src/oscura/reporting/summary.py-78"></a><span class="hll">            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-79" name="src/oscura/reporting/summary.py-79"></a>
<a id="src/oscura/reporting/summary.py-80" name="src/oscura/reporting/summary.py-80"></a><span class="hll">        <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">bullet_points</span><span class="p">:</span>
</span><a id="src/oscura/reporting/summary.py-81" name="src/oscura/reporting/summary.py-81"></a><span class="hll">            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">bullet_points</span><span class="p">:</span>
</span><a id="src/oscura/reporting/summary.py-82" name="src/oscura/reporting/summary.py-82"></a><span class="hll">                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">point</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-83" name="src/oscura/reporting/summary.py-83"></a><span class="hll">            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-84" name="src/oscura/reporting/summary.py-84"></a>
<a id="src/oscura/reporting/summary.py-85" name="src/oscura/reporting/summary.py-85"></a><span class="hll">    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-86" name="src/oscura/reporting/summary.py-86"></a>
<a id="src/oscura/reporting/summary.py-87" name="src/oscura/reporting/summary.py-87"></a>
<a id="src/oscura/reporting/summary.py-88" name="src/oscura/reporting/summary.py-88"></a><span class="k">def</span><span class="w"> </span><span class="nf">_generate_status_section</span><span class="p">(</span>
<a id="src/oscura/reporting/summary.py-89" name="src/oscura/reporting/summary.py-89"></a>    <span class="n">measurements</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/summary.py-89" name="src/oscura/reporting/summary.py-89"></a>    <span class="n">measurements</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<a id="src/oscura/reporting/summary.py-90" name="src/oscura/reporting/summary.py-90"></a>    <span class="n">interpretations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MeasurementInterpretation</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<a id="src/oscura/reporting/summary.py-91" name="src/oscura/reporting/summary.py-91"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExecutiveSummarySection</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-92" name="src/oscura/reporting/summary.py-92"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate overall status section.&quot;&quot;&quot;</span>
<a id="src/oscura/reporting/summary.py-93" name="src/oscura/reporting/summary.py-93"></a><span class="hll">    <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">measurements</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-94" name="src/oscura/reporting/summary.py-94"></a>
<a id="src/oscura/reporting/summary.py-95" name="src/oscura/reporting/summary.py-95"></a><span class="hll">    <span class="k">if</span> <span class="n">interpretations</span><span class="p">:</span>
</span><a id="src/oscura/reporting/summary.py-96" name="src/oscura/reporting/summary.py-96"></a><span class="hll">        <span class="n">excellent</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">interpretations</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">quality</span> <span class="o">==</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">EXCELLENT</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-97" name="src/oscura/reporting/summary.py-97"></a><span class="hll">        <span class="n">good</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">interpretations</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">quality</span> <span class="o">==</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">GOOD</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-98" name="src/oscura/reporting/summary.py-98"></a><span class="hll">        <span class="n">acceptable</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
</span><a id="src/oscura/reporting/summary.py-99" name="src/oscura/reporting/summary.py-99"></a>            <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">interpretations</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">quality</span> <span class="o">==</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">ACCEPTABLE</span>
<a id="src/oscura/reporting/summary.py-100" name="src/oscura/reporting/summary.py-100"></a>        <span class="p">)</span>
<a id="src/oscura/reporting/summary.py-101" name="src/oscura/reporting/summary.py-101"></a><span class="hll">        <span class="n">marginal</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">interpretations</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">quality</span> <span class="o">==</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">MARGINAL</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-102" name="src/oscura/reporting/summary.py-102"></a><span class="hll">        <span class="n">poor</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">interpretations</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">quality</span> <span class="o">==</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">POOR</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-103" name="src/oscura/reporting/summary.py-103"></a><span class="hll">        <span class="n">failed</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">interpretations</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">quality</span> <span class="o">==</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">FAILED</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-104" name="src/oscura/reporting/summary.py-104"></a>
<a id="src/oscura/reporting/summary.py-105" name="src/oscura/reporting/summary.py-105"></a><span class="hll">        <span class="k">if</span> <span class="n">failed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><a id="src/oscura/reporting/summary.py-106" name="src/oscura/reporting/summary.py-106"></a><span class="hll">            <span class="n">overall</span> <span class="o">=</span> <span class="s2">&quot;CRITICAL&quot;</span>
</span><a id="src/oscura/reporting/summary.py-107" name="src/oscura/reporting/summary.py-107"></a><span class="hll">            <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">failed</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s2"> measurements failed critical requirements.&quot;</span>
</span><a id="src/oscura/reporting/summary.py-108" name="src/oscura/reporting/summary.py-108"></a><span class="hll">        <span class="k">elif</span> <span class="n">marginal</span> <span class="o">&gt;</span> <span class="n">total</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
</span><a id="src/oscura/reporting/summary.py-109" name="src/oscura/reporting/summary.py-109"></a><span class="hll">            <span class="n">overall</span> <span class="o">=</span> <span class="s2">&quot;MARGINAL&quot;</span>
</span><a id="src/oscura/reporting/summary.py-110" name="src/oscura/reporting/summary.py-110"></a><span class="hll">            <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">marginal</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s2"> measurements are marginal.&quot;</span>
</span><a id="src/oscura/reporting/summary.py-111" name="src/oscura/reporting/summary.py-111"></a><span class="hll">        <span class="k">elif</span> <span class="n">excellent</span> <span class="o">+</span> <span class="n">good</span> <span class="o">&gt;</span> <span class="n">total</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">:</span>
</span><a id="src/oscura/reporting/summary.py-112" name="src/oscura/reporting/summary.py-112"></a><span class="hll">            <span class="n">overall</span> <span class="o">=</span> <span class="s2">&quot;GOOD&quot;</span>
</span><a id="src/oscura/reporting/summary.py-113" name="src/oscura/reporting/summary.py-113"></a><span class="hll">            <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Signal quality is good: </span><span class="si">{</span><span class="n">excellent</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">good</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s2"> measurements are excellent or good.&quot;</span>
</span><a id="src/oscura/reporting/summary.py-114" name="src/oscura/reporting/summary.py-114"></a>        <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-115" name="src/oscura/reporting/summary.py-115"></a><span class="hll">            <span class="n">overall</span> <span class="o">=</span> <span class="s2">&quot;ACCEPTABLE&quot;</span>
</span><a id="src/oscura/reporting/summary.py-116" name="src/oscura/reporting/summary.py-116"></a><span class="hll">            <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">acceptable</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s2"> measurements are acceptable.&quot;</span>
</span><a id="src/oscura/reporting/summary.py-117" name="src/oscura/reporting/summary.py-117"></a>
<a id="src/oscura/reporting/summary.py-118" name="src/oscura/reporting/summary.py-118"></a><span class="hll">        <span class="n">bullet_points</span> <span class="o">=</span> <span class="p">[</span>
</span><a id="src/oscura/reporting/summary.py-119" name="src/oscura/reporting/summary.py-119"></a>            <span class="sa">f</span><span class="s2">&quot;Excellent: </span><span class="si">{</span><span class="n">excellent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="src/oscura/reporting/summary.py-120" name="src/oscura/reporting/summary.py-120"></a>            <span class="sa">f</span><span class="s2">&quot;Good: </span><span class="si">{</span><span class="n">good</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="src/oscura/reporting/summary.py-121" name="src/oscura/reporting/summary.py-121"></a>            <span class="sa">f</span><span class="s2">&quot;Acceptable: </span><span class="si">{</span><span class="n">acceptable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="src/oscura/reporting/summary.py-122" name="src/oscura/reporting/summary.py-122"></a>            <span class="sa">f</span><span class="s2">&quot;Marginal: </span><span class="si">{</span><span class="n">marginal</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/summary.py-123" name="src/oscura/reporting/summary.py-123"></a>            <span class="sa">f</span><span class="s2">&quot;Poor: </span><span class="si">{</span><span class="n">poor</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="src/oscura/reporting/summary.py-124" name="src/oscura/reporting/summary.py-124"></a>            <span class="sa">f</span><span class="s2">&quot;Failed: </span><span class="si">{</span><span class="n">failed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="src/oscura/reporting/summary.py-125" name="src/oscura/reporting/summary.py-125"></a>        <span class="p">]</span>
<a id="src/oscura/reporting/summary.py-126" name="src/oscura/reporting/summary.py-126"></a>    <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-127" name="src/oscura/reporting/summary.py-127"></a><span class="hll">        <span class="n">overall</span> <span class="o">=</span> <span class="s2">&quot;COMPLETE&quot;</span>
</span><a id="src/oscura/reporting/summary.py-128" name="src/oscura/reporting/summary.py-128"></a><span class="hll">        <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Analysis complete with </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s2"> measurements.&quot;</span>
</span><a id="src/oscura/reporting/summary.py-129" name="src/oscura/reporting/summary.py-129"></a><span class="hll">        <span class="n">bullet_points</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/oscura/reporting/summary.py-130" name="src/oscura/reporting/summary.py-130"></a>
<a id="src/oscura/reporting/summary.py-131" name="src/oscura/reporting/summary.py-131"></a><span class="hll">    <span class="k">return</span> <span class="n">ExecutiveSummarySection</span><span class="p">(</span>
</span><a id="src/oscura/reporting/summary.py-132" name="src/oscura/reporting/summary.py-132"></a>        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Overall Status: </span><span class="si">{</span><span class="n">overall</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="src/oscura/reporting/summary.py-133" name="src/oscura/reporting/summary.py-133"></a>        <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
<a id="src/oscura/reporting/summary.py-134" name="src/oscura/reporting/summary.py-134"></a>        <span class="n">bullet_points</span><span class="o">=</span><span class="n">bullet_points</span><span class="p">,</span>
<a id="src/oscura/reporting/summary.py-135" name="src/oscura/reporting/summary.py-135"></a>        <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/summary.py-141" name="src/oscura/reporting/summary.py-141"></a>    <span class="n">interpretations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MeasurementInterpretation</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<a id="src/oscura/reporting/summary.py-142" name="src/oscura/reporting/summary.py-142"></a>    <span class="n">max_findings</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="src/oscura/reporting/summary.py-143" name="src/oscura/reporting/summary.py-143"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExecutiveSummarySection</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-144" name="src/oscura/reporting/summary.py-144"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate key findings section.&quot;&quot;&quot;</span>
<a id="src/oscura/reporting/summary.py-145" name="src/oscura/reporting/summary.py-145"></a><span class="hll">    <span class="n">findings</span> <span class="o">=</span> <span class="n">identify_key_findings</span><span class="p">(</span><span class="n">measurements</span><span class="p">,</span> <span class="n">interpretations</span><span class="p">,</span> <span class="n">max_findings</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-146" name="src/oscura/reporting/summary.py-146"></a>
<a id="src/oscura/reporting/summary.py-147" name="src/oscura/reporting/summary.py-147"></a><span class="hll">    <span class="k">return</span> <span class="n">ExecutiveSummarySection</span><span class="p">(</span>
</span><a id="src/oscura/reporting/summary.py-148" name="src/oscura/reporting/summary.py-148"></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Key Findings&quot;</span><span class="p">,</span>
<a id="src/oscura/reporting/summary.py-149" name="src/oscura/reporting/summary.py-149"></a>        <span class="n">content</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="src/oscura/reporting/summary.py-150" name="src/oscura/reporting/summary.py-150"></a>        <span class="n">bullet_points</span><span class="o">=</span><span class="n">findings</span><span class="p">,</span>
<a id="src/oscura/reporting/summary.py-151" name="src/oscura/reporting/summary.py-151"></a>        <span class="n">priority</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/summary.py-155" name="src/oscura/reporting/summary.py-155"></a><span class="k">def</span><span class="w"> </span><span class="nf">_generate_recommendations_section</span><span class="p">(</span>
<a id="src/oscura/reporting/summary.py-156" name="src/oscura/reporting/summary.py-156"></a>    <span class="n">interpretations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MeasurementInterpretation</span><span class="p">],</span>
<a id="src/oscura/reporting/summary.py-157" name="src/oscura/reporting/summary.py-157"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExecutiveSummarySection</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-158" name="src/oscura/reporting/summary.py-158"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate recommendations section.&quot;&quot;&quot;</span>
<a id="src/oscura/reporting/summary.py-159" name="src/oscura/reporting/summary.py-159"></a><span class="hll">    <span class="n">all_recommendations</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/oscura/reporting/summary.py-160" name="src/oscura/reporting/summary.py-160"></a>
<a id="src/oscura/reporting/summary.py-161" name="src/oscura/reporting/summary.py-161"></a><span class="hll">    <span class="k">for</span> <span class="n">interp</span> <span class="ow">in</span> <span class="n">interpretations</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><a id="src/oscura/reporting/summary.py-162" name="src/oscura/reporting/summary.py-162"></a><span class="hll">        <span class="n">all_recommendations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">interp</span><span class="o">.</span><span class="n">recommendations</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-163" name="src/oscura/reporting/summary.py-163"></a>
<a id="src/oscura/reporting/summary.py-164" name="src/oscura/reporting/summary.py-164"></a>    <span class="c1"># Deduplicate</span>
<a id="src/oscura/reporting/summary.py-165" name="src/oscura/reporting/summary.py-165"></a><span class="hll">    <span class="n">unique_recs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">all_recommendations</span><span class="p">))</span>
</span><a id="src/oscura/reporting/summary.py-166" name="src/oscura/reporting/summary.py-166"></a>
<a id="src/oscura/reporting/summary.py-167" name="src/oscura/reporting/summary.py-167"></a><span class="hll">    <span class="k">return</span> <span class="n">ExecutiveSummarySection</span><span class="p">(</span>
</span><a id="src/oscura/reporting/summary.py-168" name="src/oscura/reporting/summary.py-168"></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Recommendations&quot;</span><span class="p">,</span>
<a id="src/oscura/reporting/summary.py-169" name="src/oscura/reporting/summary.py-169"></a>        <span class="n">content</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="src/oscura/reporting/summary.py-170" name="src/oscura/reporting/summary.py-170"></a>        <span class="n">bullet_points</span><span class="o">=</span><span class="n">unique_recs</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span>  <span class="c1"># Top 5</span>
<a id="src/oscura/reporting/summary.py-171" name="src/oscura/reporting/summary.py-171"></a>        <span class="n">priority</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/summary.py-245" name="src/oscura/reporting/summary.py-245"></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">interp</span> <span class="ow">in</span> <span class="n">interpretations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<a id="src/oscura/reporting/summary.py-246" name="src/oscura/reporting/summary.py-246"></a>            <span class="k">if</span> <span class="n">interp</span><span class="o">.</span><span class="n">quality</span> <span class="ow">in</span> <span class="p">(</span><span class="n">QualityLevel</span><span class="o">.</span><span class="n">FAILED</span><span class="p">,</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">POOR</span><span class="p">)</span>
<a id="src/oscura/reporting/summary.py-247" name="src/oscura/reporting/summary.py-247"></a>        <span class="p">]</span>
<a id="src/oscura/reporting/summary.py-248" name="src/oscura/reporting/summary.py-248"></a>        <span class="k">if</span> <span class="n">failed</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-249" name="src/oscura/reporting/summary.py-249"></a><span class="hll">            <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Critical: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">failed</span><span class="p">)</span><span class="si">}</span><span class="s2"> measurements failed or poor quality&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-250" name="src/oscura/reporting/summary.py-250"></a>
<a id="src/oscura/reporting/summary.py-251" name="src/oscura/reporting/summary.py-251"></a>        <span class="c1"># Excellent quality</span>
<a id="src/oscura/reporting/summary.py-252" name="src/oscura/reporting/summary.py-252"></a>        <span class="n">excellent</span> <span class="o">=</span> <span class="p">[</span>
<a id="src/oscura/reporting/summary.py-253" name="src/oscura/reporting/summary.py-253"></a>            <span class="n">name</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/summary.py-254" name="src/oscura/reporting/summary.py-254"></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">interp</span> <span class="ow">in</span> <span class="n">interpretations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<a id="src/oscura/reporting/summary.py-255" name="src/oscura/reporting/summary.py-255"></a>            <span class="k">if</span> <span class="n">interp</span><span class="o">.</span><span class="n">quality</span> <span class="o">==</span> <span class="n">QualityLevel</span><span class="o">.</span><span class="n">EXCELLENT</span>
<a id="src/oscura/reporting/summary.py-256" name="src/oscura/reporting/summary.py-256"></a>        <span class="p">]</span>
<a id="src/oscura/reporting/summary.py-257" name="src/oscura/reporting/summary.py-257"></a>        <span class="k">if</span> <span class="n">excellent</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-258" name="src/oscura/reporting/summary.py-258"></a><span class="hll">            <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">excellent</span><span class="p">)</span><span class="si">}</span><span class="s2"> measurements show excellent performance&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-259" name="src/oscura/reporting/summary.py-259"></a>
<a id="src/oscura/reporting/summary.py-260" name="src/oscura/reporting/summary.py-260"></a>    <span class="c1"># Domain-specific findings</span>
<a id="src/oscura/reporting/summary.py-261" name="src/oscura/reporting/summary.py-261"></a>    <span class="k">if</span> <span class="s2">&quot;snr&quot;</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-262" name="src/oscura/reporting/summary.py-262"></a>        <span class="n">snr</span> <span class="o">=</span> <span class="n">measurements</span><span class="p">[</span><span class="s2">&quot;snr&quot;</span><span class="p">]</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/summary.py-261" name="src/oscura/reporting/summary.py-261"></a>    <span class="k">if</span> <span class="s2">&quot;snr&quot;</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-262" name="src/oscura/reporting/summary.py-262"></a>        <span class="n">snr</span> <span class="o">=</span> <span class="n">measurements</span><span class="p">[</span><span class="s2">&quot;snr&quot;</span><span class="p">]</span>
<a id="src/oscura/reporting/summary.py-263" name="src/oscura/reporting/summary.py-263"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">snr</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">):</span>
<a id="src/oscura/reporting/summary.py-264" name="src/oscura/reporting/summary.py-264"></a>            <span class="k">if</span> <span class="n">snr</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-265" name="src/oscura/reporting/summary.py-265"></a><span class="hll">                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Excellent SNR: </span><span class="si">{</span><span class="n">snr</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> dB&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-266" name="src/oscura/reporting/summary.py-266"></a>            <span class="k">elif</span> <span class="n">snr</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-267" name="src/oscura/reporting/summary.py-267"></a><span class="hll">                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Low SNR: </span><span class="si">{</span><span class="n">snr</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> dB - noise mitigation recommended&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-268" name="src/oscura/reporting/summary.py-268"></a>
<a id="src/oscura/reporting/summary.py-269" name="src/oscura/reporting/summary.py-269"></a>    <span class="k">if</span> <span class="s2">&quot;bandwidth&quot;</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-270" name="src/oscura/reporting/summary.py-270"></a>        <span class="n">bw</span> <span class="o">=</span> <span class="n">measurements</span><span class="p">[</span><span class="s2">&quot;bandwidth&quot;</span><span class="p">]</span>
<a id="src/oscura/reporting/summary.py-271" name="src/oscura/reporting/summary.py-271"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bw</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">):</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/summary.py-269" name="src/oscura/reporting/summary.py-269"></a>    <span class="k">if</span> <span class="s2">&quot;bandwidth&quot;</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-270" name="src/oscura/reporting/summary.py-270"></a>        <span class="n">bw</span> <span class="o">=</span> <span class="n">measurements</span><span class="p">[</span><span class="s2">&quot;bandwidth&quot;</span><span class="p">]</span>
<a id="src/oscura/reporting/summary.py-271" name="src/oscura/reporting/summary.py-271"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bw</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">):</span>
<a id="src/oscura/reporting/summary.py-272" name="src/oscura/reporting/summary.py-272"></a>            <span class="k">if</span> <span class="n">bw</span> <span class="o">&gt;</span> <span class="mf">1e9</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-273" name="src/oscura/reporting/summary.py-273"></a><span class="hll">                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wide bandwidth: </span><span class="si">{</span><span class="n">bw</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1e9</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GHz&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-274" name="src/oscura/reporting/summary.py-274"></a>
<a id="src/oscura/reporting/summary.py-275" name="src/oscura/reporting/summary.py-275"></a>    <span class="k">if</span> <span class="s2">&quot;jitter&quot;</span> <span class="ow">in</span> <span class="n">measurements</span> <span class="ow">or</span> <span class="s2">&quot;rms_jitter&quot;</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-276" name="src/oscura/reporting/summary.py-276"></a><span class="hll">        <span class="n">jitter_key</span> <span class="o">=</span> <span class="s2">&quot;rms_jitter&quot;</span> <span class="k">if</span> <span class="s2">&quot;rms_jitter&quot;</span> <span class="ow">in</span> <span class="n">measurements</span> <span class="k">else</span> <span class="s2">&quot;jitter&quot;</span>
</span><a id="src/oscura/reporting/summary.py-277" name="src/oscura/reporting/summary.py-277"></a><span class="hll">        <span class="n">jitter</span> <span class="o">=</span> <span class="n">measurements</span><span class="p">[</span><span class="n">jitter_key</span><span class="p">]</span>
</span><a id="src/oscura/reporting/summary.py-278" name="src/oscura/reporting/summary.py-278"></a><span class="hll">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">jitter</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">):</span>
</span><a id="src/oscura/reporting/summary.py-279" name="src/oscura/reporting/summary.py-279"></a><span class="hll">            <span class="n">jitter_ps</span> <span class="o">=</span> <span class="n">jitter</span> <span class="o">*</span> <span class="mf">1e12</span>
</span><a id="src/oscura/reporting/summary.py-280" name="src/oscura/reporting/summary.py-280"></a><span class="hll">            <span class="k">if</span> <span class="n">jitter_ps</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
</span><a id="src/oscura/reporting/summary.py-281" name="src/oscura/reporting/summary.py-281"></a><span class="hll">                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Excellent timing: RMS jitter &lt; 10 ps&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-282" name="src/oscura/reporting/summary.py-282"></a><span class="hll">            <span class="k">elif</span> <span class="n">jitter_ps</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
</span><a id="src/oscura/reporting/summary.py-283" name="src/oscura/reporting/summary.py-283"></a><span class="hll">                <span class="n">findings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;High jitter: </span><span class="si">{</span><span class="n">jitter_ps</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> ps - investigate timing issues&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-284" name="src/oscura/reporting/summary.py-284"></a>
<a id="src/oscura/reporting/summary.py-285" name="src/oscura/reporting/summary.py-285"></a>    <span class="c1"># Limit to max_findings</span>
<a id="src/oscura/reporting/summary.py-286" name="src/oscura/reporting/summary.py-286"></a>    <span class="k">return</span> <span class="n">findings</span><span class="p">[:</span><span class="n">max_findings</span><span class="p">]</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/summary.py-317" name="src/oscura/reporting/summary.py-317"></a>    <span class="c1"># Add domain-specific recommendations</span>
<a id="src/oscura/reporting/summary.py-318" name="src/oscura/reporting/summary.py-318"></a>    <span class="k">if</span> <span class="s2">&quot;snr&quot;</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-319" name="src/oscura/reporting/summary.py-319"></a>        <span class="n">snr</span> <span class="o">=</span> <span class="n">measurements</span><span class="p">[</span><span class="s2">&quot;snr&quot;</span><span class="p">]</span>
<a id="src/oscura/reporting/summary.py-320" name="src/oscura/reporting/summary.py-320"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">snr</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">snr</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-321" name="src/oscura/reporting/summary.py-321"></a><span class="hll">            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Investigate noise sources and consider filtering&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-322" name="src/oscura/reporting/summary.py-322"></a>
<a id="src/oscura/reporting/summary.py-323" name="src/oscura/reporting/summary.py-323"></a>    <span class="k">if</span> <span class="s2">&quot;bandwidth&quot;</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-324" name="src/oscura/reporting/summary.py-324"></a>        <span class="n">bw</span> <span class="o">=</span> <span class="n">measurements</span><span class="p">[</span><span class="s2">&quot;bandwidth&quot;</span><span class="p">]</span>
<a id="src/oscura/reporting/summary.py-325" name="src/oscura/reporting/summary.py-325"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bw</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">bw</span> <span class="o">&lt;</span> <span class="mf">100e6</span><span class="p">:</span>
<a id="src/oscura/reporting/summary.py-326" name="src/oscura/reporting/summary.py-326"></a><span class="hll">            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Verify signal path bandwidth requirements&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/summary.py-327" name="src/oscura/reporting/summary.py-327"></a>
<a id="src/oscura/reporting/summary.py-328" name="src/oscura/reporting/summary.py-328"></a>    <span class="c1"># Deduplicate and return</span>
<a id="src/oscura/reporting/summary.py-329" name="src/oscura/reporting/summary.py-329"></a>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">recommendations</span><span class="p">))</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/oscura/reporting/visualization.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-69" name="src/oscura/reporting/visualization.py-69"></a><span class="sd">        Example:</span>
<a id="src/oscura/reporting/visualization.py-70" name="src/oscura/reporting/visualization.py-70"></a><span class="sd">            &gt;&gt;&gt; fig, ax = plt.subplots()</span>
<a id="src/oscura/reporting/visualization.py-71" name="src/oscura/reporting/visualization.py-71"></a><span class="sd">            &gt;&gt;&gt; PlotStyler.apply_ieee_style(ax, &quot;Time&quot;, &quot;Voltage&quot;, &quot;Signal&quot;)</span>
<a id="src/oscura/reporting/visualization.py-72" name="src/oscura/reporting/visualization.py-72"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="src/oscura/reporting/visualization.py-73" name="src/oscura/reporting/visualization.py-73"></a><span class="hll">        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_MATPLOTLIB</span><span class="p">:</span>
</span><a id="src/oscura/reporting/visualization.py-74" name="src/oscura/reporting/visualization.py-74"></a><span class="hll">            <span class="k">return</span>
</span><a id="src/oscura/reporting/visualization.py-75" name="src/oscura/reporting/visualization.py-75"></a>
<a id="src/oscura/reporting/visualization.py-76" name="src/oscura/reporting/visualization.py-76"></a>        <span class="c1"># Labels and title</span>
<a id="src/oscura/reporting/visualization.py-77" name="src/oscura/reporting/visualization.py-77"></a><span class="hll">        <span class="k">if</span> <span class="n">xlabel</span><span class="p">:</span>
</span><a id="src/oscura/reporting/visualization.py-78" name="src/oscura/reporting/visualization.py-78"></a><span class="hll">            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-79" name="src/oscura/reporting/visualization.py-79"></a><span class="hll">        <span class="k">if</span> <span class="n">ylabel</span><span class="p">:</span>
</span><a id="src/oscura/reporting/visualization.py-80" name="src/oscura/reporting/visualization.py-80"></a><span class="hll">            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-81" name="src/oscura/reporting/visualization.py-81"></a><span class="hll">        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
</span><a id="src/oscura/reporting/visualization.py-82" name="src/oscura/reporting/visualization.py-82"></a><span class="hll">            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-83" name="src/oscura/reporting/visualization.py-83"></a>
<a id="src/oscura/reporting/visualization.py-84" name="src/oscura/reporting/visualization.py-84"></a>        <span class="c1"># Grid</span>
<a id="src/oscura/reporting/visualization.py-85" name="src/oscura/reporting/visualization.py-85"></a><span class="hll">        <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
</span><a id="src/oscura/reporting/visualization.py-86" name="src/oscura/reporting/visualization.py-86"></a><span class="hll">            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">IEEE_COLORS</span><span class="p">[</span><span class="s2">&quot;grid&quot;</span><span class="p">])</span>
</span><a id="src/oscura/reporting/visualization.py-87" name="src/oscura/reporting/visualization.py-87"></a>
<a id="src/oscura/reporting/visualization.py-88" name="src/oscura/reporting/visualization.py-88"></a>        <span class="c1"># Spines</span>
<a id="src/oscura/reporting/visualization.py-89" name="src/oscura/reporting/visualization.py-89"></a><span class="hll">        <span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><a id="src/oscura/reporting/visualization.py-90" name="src/oscura/reporting/visualization.py-90"></a><span class="hll">            <span class="n">spine</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">IEEE_COLORS</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
</span><a id="src/oscura/reporting/visualization.py-91" name="src/oscura/reporting/visualization.py-91"></a><span class="hll">            <span class="n">spine</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.8</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-92" name="src/oscura/reporting/visualization.py-92"></a>
<a id="src/oscura/reporting/visualization.py-93" name="src/oscura/reporting/visualization.py-93"></a>        <span class="c1"># Ticks</span>
<a id="src/oscura/reporting/visualization.py-94" name="src/oscura/reporting/visualization.py-94"></a><span class="hll">        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">IEEE_COLORS</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
</span><a id="src/oscura/reporting/visualization.py-95" name="src/oscura/reporting/visualization.py-95"></a>
<a id="src/oscura/reporting/visualization.py-96" name="src/oscura/reporting/visualization.py-96"></a>        <span class="c1"># Tight layout</span>
<a id="src/oscura/reporting/visualization.py-97" name="src/oscura/reporting/visualization.py-97"></a><span class="hll">        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><a id="src/oscura/reporting/visualization.py-98" name="src/oscura/reporting/visualization.py-98"></a>
<a id="src/oscura/reporting/visualization.py-99" name="src/oscura/reporting/visualization.py-99"></a>
<a id="src/oscura/reporting/visualization.py-100" name="src/oscura/reporting/visualization.py-100"></a><span class="k">class</span><span class="w"> </span><span class="nc">IEEEPlotGenerator</span><span class="p">:</span>
<a id="src/oscura/reporting/visualization.py-101" name="src/oscura/reporting/visualization.py-101"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate IEEE-compliant plots for signal analysis reports.</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-118" name="src/oscura/reporting/visualization.py-118"></a>
<a id="src/oscura/reporting/visualization.py-119" name="src/oscura/reporting/visualization.py-119"></a><span class="sd">        Raises:</span>
<a id="src/oscura/reporting/visualization.py-120" name="src/oscura/reporting/visualization.py-120"></a><span class="sd">            ImportError: If matplotlib is not installed.</span>
<a id="src/oscura/reporting/visualization.py-121" name="src/oscura/reporting/visualization.py-121"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="src/oscura/reporting/visualization.py-122" name="src/oscura/reporting/visualization.py-122"></a><span class="hll">        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_MATPLOTLIB</span><span class="p">:</span>
</span><a id="src/oscura/reporting/visualization.py-123" name="src/oscura/reporting/visualization.py-123"></a><span class="hll">            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;matplotlib is required for plot generation&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-124" name="src/oscura/reporting/visualization.py-124"></a>
<a id="src/oscura/reporting/visualization.py-125" name="src/oscura/reporting/visualization.py-125"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">dpi</span>
</span><a id="src/oscura/reporting/visualization.py-126" name="src/oscura/reporting/visualization.py-126"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span>
</span><a id="src/oscura/reporting/visualization.py-127" name="src/oscura/reporting/visualization.py-127"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">styler</span> <span class="o">=</span> <span class="n">PlotStyler</span><span class="p">()</span>
</span><a id="src/oscura/reporting/visualization.py-128" name="src/oscura/reporting/visualization.py-128"></a>
<a id="src/oscura/reporting/visualization.py-129" name="src/oscura/reporting/visualization.py-129"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_waveform</span><span class="p">(</span>
<a id="src/oscura/reporting/visualization.py-130" name="src/oscura/reporting/visualization.py-130"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-131" name="src/oscura/reporting/visualization.py-131"></a>        <span class="n">time</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-152" name="src/oscura/reporting/visualization.py-152"></a><span class="sd">            &gt;&gt;&gt; t = np.linspace(0, 1, 1000)</span>
<a id="src/oscura/reporting/visualization.py-153" name="src/oscura/reporting/visualization.py-153"></a><span class="sd">            &gt;&gt;&gt; s = np.sin(2 * np.pi * 10 * t)</span>
<a id="src/oscura/reporting/visualization.py-154" name="src/oscura/reporting/visualization.py-154"></a><span class="sd">            &gt;&gt;&gt; fig = generator.plot_waveform(t, s, &quot;Sine Wave&quot;)</span>
<a id="src/oscura/reporting/visualization.py-155" name="src/oscura/reporting/visualization.py-155"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="src/oscura/reporting/visualization.py-156" name="src/oscura/reporting/visualization.py-156"></a><span class="hll">        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-157" name="src/oscura/reporting/visualization.py-157"></a>
<a id="src/oscura/reporting/visualization.py-158" name="src/oscura/reporting/visualization.py-158"></a>        <span class="c1"># Plot signal</span>
<a id="src/oscura/reporting/visualization.py-159" name="src/oscura/reporting/visualization.py-159"></a><span class="hll">        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">IEEE_COLORS</span><span class="p">[</span><span class="s2">&quot;primary&quot;</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Signal&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-160" name="src/oscura/reporting/visualization.py-160"></a>
<a id="src/oscura/reporting/visualization.py-161" name="src/oscura/reporting/visualization.py-161"></a>        <span class="c1"># Add markers if provided</span>
<a id="src/oscura/reporting/visualization.py-162" name="src/oscura/reporting/visualization.py-162"></a><span class="hll">        <span class="k">if</span> <span class="n">markers</span><span class="p">:</span>
</span><a id="src/oscura/reporting/visualization.py-163" name="src/oscura/reporting/visualization.py-163"></a><span class="hll">            <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><a id="src/oscura/reporting/visualization.py-164" name="src/oscura/reporting/visualization.py-164"></a><span class="hll">                <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">IEEE_COLORS</span><span class="p">[</span><span class="s2">&quot;accent&quot;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-165" name="src/oscura/reporting/visualization.py-165"></a><span class="hll">                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><a id="src/oscura/reporting/visualization.py-166" name="src/oscura/reporting/visualization.py-166"></a>                    <span class="n">pos</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-167" name="src/oscura/reporting/visualization.py-167"></a>                    <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-168" name="src/oscura/reporting/visualization.py-168"></a>                    <span class="n">label</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-169" name="src/oscura/reporting/visualization.py-169"></a>                    <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-170" name="src/oscura/reporting/visualization.py-170"></a>                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-171" name="src/oscura/reporting/visualization.py-171"></a>                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-172" name="src/oscura/reporting/visualization.py-172"></a>                <span class="p">)</span>
<a id="src/oscura/reporting/visualization.py-173" name="src/oscura/reporting/visualization.py-173"></a>
<a id="src/oscura/reporting/visualization.py-174" name="src/oscura/reporting/visualization.py-174"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">styler</span><span class="o">.</span><span class="n">apply_ieee_style</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-175" name="src/oscura/reporting/visualization.py-175"></a><span class="hll">        <span class="k">return</span> <span class="n">fig</span>
</span><a id="src/oscura/reporting/visualization.py-176" name="src/oscura/reporting/visualization.py-176"></a>
<a id="src/oscura/reporting/visualization.py-177" name="src/oscura/reporting/visualization.py-177"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_fft</span><span class="p">(</span>
<a id="src/oscura/reporting/visualization.py-178" name="src/oscura/reporting/visualization.py-178"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-179" name="src/oscura/reporting/visualization.py-179"></a>        <span class="n">frequencies</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-196" name="src/oscura/reporting/visualization.py-196"></a><span class="sd">            &gt;&gt;&gt; freq = np.fft.rfftfreq(1000, 1/1000)</span>
<a id="src/oscura/reporting/visualization.py-197" name="src/oscura/reporting/visualization.py-197"></a><span class="sd">            &gt;&gt;&gt; mag_db = 20 * np.log10(np.abs(np.fft.rfft(signal)))</span>
<a id="src/oscura/reporting/visualization.py-198" name="src/oscura/reporting/visualization.py-198"></a><span class="sd">            &gt;&gt;&gt; fig = generator.plot_fft(freq, mag_db)</span>
<a id="src/oscura/reporting/visualization.py-199" name="src/oscura/reporting/visualization.py-199"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="src/oscura/reporting/visualization.py-200" name="src/oscura/reporting/visualization.py-200"></a><span class="hll">        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-201" name="src/oscura/reporting/visualization.py-201"></a>
<a id="src/oscura/reporting/visualization.py-202" name="src/oscura/reporting/visualization.py-202"></a>        <span class="c1"># Plot spectrum</span>
<a id="src/oscura/reporting/visualization.py-203" name="src/oscura/reporting/visualization.py-203"></a><span class="hll">        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">magnitude_db</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">IEEE_COLORS</span><span class="p">[</span><span class="s2">&quot;primary&quot;</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-204" name="src/oscura/reporting/visualization.py-204"></a>
<a id="src/oscura/reporting/visualization.py-205" name="src/oscura/reporting/visualization.py-205"></a>        <span class="c1"># Mark peaks</span>
<a id="src/oscura/reporting/visualization.py-206" name="src/oscura/reporting/visualization.py-206"></a><span class="hll">        <span class="k">if</span> <span class="n">peak_markers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><a id="src/oscura/reporting/visualization.py-207" name="src/oscura/reporting/visualization.py-207"></a>            <span class="c1"># Find peaks (ignore DC)</span>
<a id="src/oscura/reporting/visualization.py-208" name="src/oscura/reporting/visualization.py-208"></a><span class="hll">            <span class="n">valid_idx</span> <span class="o">=</span> <span class="n">frequencies</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><a id="src/oscura/reporting/visualization.py-209" name="src/oscura/reporting/visualization.py-209"></a><span class="hll">            <span class="n">valid_freq</span> <span class="o">=</span> <span class="n">frequencies</span><span class="p">[</span><span class="n">valid_idx</span><span class="p">]</span>
</span><a id="src/oscura/reporting/visualization.py-210" name="src/oscura/reporting/visualization.py-210"></a><span class="hll">            <span class="n">valid_mag</span> <span class="o">=</span> <span class="n">magnitude_db</span><span class="p">[</span><span class="n">valid_idx</span><span class="p">]</span>
</span><a id="src/oscura/reporting/visualization.py-211" name="src/oscura/reporting/visualization.py-211"></a>
<a id="src/oscura/reporting/visualization.py-212" name="src/oscura/reporting/visualization.py-212"></a><span class="hll">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_mag</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><a id="src/oscura/reporting/visualization.py-213" name="src/oscura/reporting/visualization.py-213"></a><span class="hll">                <span class="n">peak_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">valid_mag</span><span class="p">)[</span><span class="o">-</span><span class="n">peak_markers</span><span class="p">:]</span>
</span><a id="src/oscura/reporting/visualization.py-214" name="src/oscura/reporting/visualization.py-214"></a><span class="hll">                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">peak_indices</span><span class="p">:</span>
</span><a id="src/oscura/reporting/visualization.py-215" name="src/oscura/reporting/visualization.py-215"></a><span class="hll">                    <span class="n">freq_val</span> <span class="o">=</span> <span class="n">valid_freq</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><a id="src/oscura/reporting/visualization.py-216" name="src/oscura/reporting/visualization.py-216"></a><span class="hll">                    <span class="n">mag_val</span> <span class="o">=</span> <span class="n">valid_mag</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><a id="src/oscura/reporting/visualization.py-217" name="src/oscura/reporting/visualization.py-217"></a><span class="hll">                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq_val</span><span class="p">,</span> <span class="n">mag_val</span><span class="p">,</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-218" name="src/oscura/reporting/visualization.py-218"></a><span class="hll">                    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
</span><a id="src/oscura/reporting/visualization.py-219" name="src/oscura/reporting/visualization.py-219"></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">freq_val</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> Hz&quot;</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-220" name="src/oscura/reporting/visualization.py-220"></a>                        <span class="p">(</span><span class="n">freq_val</span><span class="p">,</span> <span class="n">mag_val</span><span class="p">),</span>
<a id="src/oscura/reporting/visualization.py-221" name="src/oscura/reporting/visualization.py-221"></a>                        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<a id="src/oscura/reporting/visualization.py-222" name="src/oscura/reporting/visualization.py-222"></a>                        <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-223" name="src/oscura/reporting/visualization.py-223"></a>                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-224" name="src/oscura/reporting/visualization.py-224"></a>                        <span class="n">color</span><span class="o">=</span><span class="n">IEEE_COLORS</span><span class="p">[</span><span class="s2">&quot;danger&quot;</span><span class="p">],</span>
<a id="src/oscura/reporting/visualization.py-225" name="src/oscura/reporting/visualization.py-225"></a>                    <span class="p">)</span>
<a id="src/oscura/reporting/visualization.py-226" name="src/oscura/reporting/visualization.py-226"></a>
<a id="src/oscura/reporting/visualization.py-227" name="src/oscura/reporting/visualization.py-227"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">styler</span><span class="o">.</span><span class="n">apply_ieee_style</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">,</span> <span class="s2">&quot;Magnitude (dB)&quot;</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-228" name="src/oscura/reporting/visualization.py-228"></a>
<a id="src/oscura/reporting/visualization.py-229" name="src/oscura/reporting/visualization.py-229"></a>        <span class="c1"># Log scale for frequency if range &gt; 2 decades</span>
<a id="src/oscura/reporting/visualization.py-230" name="src/oscura/reporting/visualization.py-230"></a><span class="hll">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">frequencies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">frequencies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
</span><a id="src/oscura/reporting/visualization.py-231" name="src/oscura/reporting/visualization.py-231"></a><span class="hll">            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-232" name="src/oscura/reporting/visualization.py-232"></a>
<a id="src/oscura/reporting/visualization.py-233" name="src/oscura/reporting/visualization.py-233"></a><span class="hll">        <span class="k">return</span> <span class="n">fig</span>
</span><a id="src/oscura/reporting/visualization.py-234" name="src/oscura/reporting/visualization.py-234"></a>
<a id="src/oscura/reporting/visualization.py-235" name="src/oscura/reporting/visualization.py-235"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_psd</span><span class="p">(</span>
<a id="src/oscura/reporting/visualization.py-236" name="src/oscura/reporting/visualization.py-236"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-237" name="src/oscura/reporting/visualization.py-237"></a>        <span class="n">frequencies</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-254" name="src/oscura/reporting/visualization.py-254"></a><span class="sd">            &gt;&gt;&gt; from scipy import signal as sp_signal</span>
<a id="src/oscura/reporting/visualization.py-255" name="src/oscura/reporting/visualization.py-255"></a><span class="sd">            &gt;&gt;&gt; freq, psd = sp_signal.welch(data, fs=sample_rate)</span>
<a id="src/oscura/reporting/visualization.py-256" name="src/oscura/reporting/visualization.py-256"></a><span class="sd">            &gt;&gt;&gt; fig = generator.plot_psd(freq, psd)</span>
<a id="src/oscura/reporting/visualization.py-257" name="src/oscura/reporting/visualization.py-257"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="src/oscura/reporting/visualization.py-258" name="src/oscura/reporting/visualization.py-258"></a><span class="hll">        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-259" name="src/oscura/reporting/visualization.py-259"></a>
<a id="src/oscura/reporting/visualization.py-260" name="src/oscura/reporting/visualization.py-260"></a>        <span class="c1"># Convert to dB scale</span>
<a id="src/oscura/reporting/visualization.py-261" name="src/oscura/reporting/visualization.py-261"></a><span class="hll">        <span class="n">psd_db</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">psd</span> <span class="o">+</span> <span class="mf">1e-12</span><span class="p">)</span>  <span class="c1"># Add epsilon to avoid log(0)</span>
</span><a id="src/oscura/reporting/visualization.py-262" name="src/oscura/reporting/visualization.py-262"></a>
<a id="src/oscura/reporting/visualization.py-263" name="src/oscura/reporting/visualization.py-263"></a><span class="hll">        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">psd_db</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">IEEE_COLORS</span><span class="p">[</span><span class="s2">&quot;primary&quot;</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-264" name="src/oscura/reporting/visualization.py-264"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">styler</span><span class="o">.</span><span class="n">apply_ieee_style</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;PSD (dB </span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-265" name="src/oscura/reporting/visualization.py-265"></a>
<a id="src/oscura/reporting/visualization.py-266" name="src/oscura/reporting/visualization.py-266"></a>        <span class="c1"># Log scale for frequency</span>
<a id="src/oscura/reporting/visualization.py-267" name="src/oscura/reporting/visualization.py-267"></a><span class="hll">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">frequencies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">frequencies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
</span><a id="src/oscura/reporting/visualization.py-268" name="src/oscura/reporting/visualization.py-268"></a><span class="hll">            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-269" name="src/oscura/reporting/visualization.py-269"></a>
<a id="src/oscura/reporting/visualization.py-270" name="src/oscura/reporting/visualization.py-270"></a><span class="hll">        <span class="k">return</span> <span class="n">fig</span>
</span><a id="src/oscura/reporting/visualization.py-271" name="src/oscura/reporting/visualization.py-271"></a>
<a id="src/oscura/reporting/visualization.py-272" name="src/oscura/reporting/visualization.py-272"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_spectrogram</span><span class="p">(</span>
<a id="src/oscura/reporting/visualization.py-273" name="src/oscura/reporting/visualization.py-273"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-274" name="src/oscura/reporting/visualization.py-274"></a>        <span class="n">time</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-291" name="src/oscura/reporting/visualization.py-291"></a><span class="sd">            &gt;&gt;&gt; from scipy import signal as sp_signal</span>
<a id="src/oscura/reporting/visualization.py-292" name="src/oscura/reporting/visualization.py-292"></a><span class="sd">            &gt;&gt;&gt; f, t, Sxx = sp_signal.spectrogram(data, fs=sample_rate)</span>
<a id="src/oscura/reporting/visualization.py-293" name="src/oscura/reporting/visualization.py-293"></a><span class="sd">            &gt;&gt;&gt; fig = generator.plot_spectrogram(t, f, Sxx)</span>
<a id="src/oscura/reporting/visualization.py-294" name="src/oscura/reporting/visualization.py-294"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="src/oscura/reporting/visualization.py-295" name="src/oscura/reporting/visualization.py-295"></a><span class="hll">        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-296" name="src/oscura/reporting/visualization.py-296"></a>
<a id="src/oscura/reporting/visualization.py-297" name="src/oscura/reporting/visualization.py-297"></a>        <span class="c1"># Convert to dB scale</span>
<a id="src/oscura/reporting/visualization.py-298" name="src/oscura/reporting/visualization.py-298"></a><span class="hll">        <span class="n">spec_db</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">spectrogram</span> <span class="o">+</span> <span class="mf">1e-12</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-299" name="src/oscura/reporting/visualization.py-299"></a>
<a id="src/oscura/reporting/visualization.py-300" name="src/oscura/reporting/visualization.py-300"></a>        <span class="c1"># Plot spectrogram</span>
<a id="src/oscura/reporting/visualization.py-301" name="src/oscura/reporting/visualization.py-301"></a><span class="hll">        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
</span><a id="src/oscura/reporting/visualization.py-302" name="src/oscura/reporting/visualization.py-302"></a>            <span class="n">time</span><span class="p">,</span> <span class="n">frequencies</span><span class="p">,</span> <span class="n">spec_db</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="kc">True</span>
<a id="src/oscura/reporting/visualization.py-303" name="src/oscura/reporting/visualization.py-303"></a>        <span class="p">)</span>
<a id="src/oscura/reporting/visualization.py-304" name="src/oscura/reporting/visualization.py-304"></a>
<a id="src/oscura/reporting/visualization.py-305" name="src/oscura/reporting/visualization.py-305"></a>        <span class="c1"># Colorbar</span>
<a id="src/oscura/reporting/visualization.py-306" name="src/oscura/reporting/visualization.py-306"></a><span class="hll">        <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Power (dB)&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-307" name="src/oscura/reporting/visualization.py-307"></a><span class="hll">        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-308" name="src/oscura/reporting/visualization.py-308"></a>
<a id="src/oscura/reporting/visualization.py-309" name="src/oscura/reporting/visualization.py-309"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">styler</span><span class="o">.</span><span class="n">apply_ieee_style</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s2">&quot;Time (s)&quot;</span><span class="p">,</span> <span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-310" name="src/oscura/reporting/visualization.py-310"></a>
<a id="src/oscura/reporting/visualization.py-311" name="src/oscura/reporting/visualization.py-311"></a><span class="hll">        <span class="k">return</span> <span class="n">fig</span>
</span><a id="src/oscura/reporting/visualization.py-312" name="src/oscura/reporting/visualization.py-312"></a>
<a id="src/oscura/reporting/visualization.py-313" name="src/oscura/reporting/visualization.py-313"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_eye_diagram</span><span class="p">(</span>
<a id="src/oscura/reporting/visualization.py-314" name="src/oscura/reporting/visualization.py-314"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-315" name="src/oscura/reporting/visualization.py-315"></a>        <span class="n">signal</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-331" name="src/oscura/reporting/visualization.py-331"></a><span class="sd">        Example:</span>
<a id="src/oscura/reporting/visualization.py-332" name="src/oscura/reporting/visualization.py-332"></a><span class="sd">            &gt;&gt;&gt; # For 1000 samples at 10 samples/symbol</span>
<a id="src/oscura/reporting/visualization.py-333" name="src/oscura/reporting/visualization.py-333"></a><span class="sd">            &gt;&gt;&gt; fig = generator.plot_eye_diagram(signal, 10, num_traces=50)</span>
<a id="src/oscura/reporting/visualization.py-334" name="src/oscura/reporting/visualization.py-334"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="src/oscura/reporting/visualization.py-335" name="src/oscura/reporting/visualization.py-335"></a><span class="hll">        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-336" name="src/oscura/reporting/visualization.py-336"></a>
<a id="src/oscura/reporting/visualization.py-337" name="src/oscura/reporting/visualization.py-337"></a>        <span class="c1"># Extract symbol windows</span>
<a id="src/oscura/reporting/visualization.py-338" name="src/oscura/reporting/visualization.py-338"></a><span class="hll">        <span class="n">num_symbols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span> <span class="o">//</span> <span class="n">samples_per_symbol</span>
</span><a id="src/oscura/reporting/visualization.py-339" name="src/oscura/reporting/visualization.py-339"></a><span class="hll">        <span class="n">num_traces</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">num_traces</span><span class="p">,</span> <span class="n">num_symbols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-340" name="src/oscura/reporting/visualization.py-340"></a>
<a id="src/oscura/reporting/visualization.py-341" name="src/oscura/reporting/visualization.py-341"></a><span class="hll">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_traces</span><span class="p">):</span>
</span><a id="src/oscura/reporting/visualization.py-342" name="src/oscura/reporting/visualization.py-342"></a><span class="hll">            <span class="n">start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">samples_per_symbol</span>
</span><a id="src/oscura/reporting/visualization.py-343" name="src/oscura/reporting/visualization.py-343"></a><span class="hll">            <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">samples_per_symbol</span>  <span class="c1"># Two symbol periods</span>
</span><a id="src/oscura/reporting/visualization.py-344" name="src/oscura/reporting/visualization.py-344"></a><span class="hll">            <span class="k">if</span> <span class="n">end</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">signal</span><span class="p">):</span>
</span><a id="src/oscura/reporting/visualization.py-345" name="src/oscura/reporting/visualization.py-345"></a><span class="hll">                <span class="n">trace</span> <span class="o">=</span> <span class="n">signal</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
</span><a id="src/oscura/reporting/visualization.py-346" name="src/oscura/reporting/visualization.py-346"></a><span class="hll">                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><a id="src/oscura/reporting/visualization.py-347" name="src/oscura/reporting/visualization.py-347"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)),</span>
<a id="src/oscura/reporting/visualization.py-348" name="src/oscura/reporting/visualization.py-348"></a>                    <span class="n">trace</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-349" name="src/oscura/reporting/visualization.py-349"></a>                    <span class="n">color</span><span class="o">=</span><span class="n">IEEE_COLORS</span><span class="p">[</span><span class="s2">&quot;primary&quot;</span><span class="p">],</span>
<a id="src/oscura/reporting/visualization.py-350" name="src/oscura/reporting/visualization.py-350"></a>                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-350" name="src/oscura/reporting/visualization.py-350"></a>                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-351" name="src/oscura/reporting/visualization.py-351"></a>                    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-352" name="src/oscura/reporting/visualization.py-352"></a>                <span class="p">)</span>
<a id="src/oscura/reporting/visualization.py-353" name="src/oscura/reporting/visualization.py-353"></a>
<a id="src/oscura/reporting/visualization.py-354" name="src/oscura/reporting/visualization.py-354"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">styler</span><span class="o">.</span><span class="n">apply_ieee_style</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s2">&quot;Sample&quot;</span><span class="p">,</span> <span class="s2">&quot;Amplitude&quot;</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-355" name="src/oscura/reporting/visualization.py-355"></a><span class="hll">        <span class="k">return</span> <span class="n">fig</span>
</span><a id="src/oscura/reporting/visualization.py-356" name="src/oscura/reporting/visualization.py-356"></a>
<a id="src/oscura/reporting/visualization.py-357" name="src/oscura/reporting/visualization.py-357"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_histogram</span><span class="p">(</span>
<a id="src/oscura/reporting/visualization.py-358" name="src/oscura/reporting/visualization.py-358"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-359" name="src/oscura/reporting/visualization.py-359"></a>        <span class="n">data</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-374" name="src/oscura/reporting/visualization.py-374"></a>
<a id="src/oscura/reporting/visualization.py-375" name="src/oscura/reporting/visualization.py-375"></a><span class="sd">        Example:</span>
<a id="src/oscura/reporting/visualization.py-376" name="src/oscura/reporting/visualization.py-376"></a><span class="sd">            &gt;&gt;&gt; fig = generator.plot_histogram(signal, bins=100, title=&quot;Voltage Distribution&quot;)</span>
<a id="src/oscura/reporting/visualization.py-377" name="src/oscura/reporting/visualization.py-377"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="src/oscura/reporting/visualization.py-378" name="src/oscura/reporting/visualization.py-378"></a><span class="hll">        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-379" name="src/oscura/reporting/visualization.py-379"></a>
<a id="src/oscura/reporting/visualization.py-380" name="src/oscura/reporting/visualization.py-380"></a>        <span class="c1"># Plot histogram</span>
<a id="src/oscura/reporting/visualization.py-381" name="src/oscura/reporting/visualization.py-381"></a><span class="hll">        <span class="n">n</span><span class="p">,</span> <span class="n">bins_edges</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
</span><a id="src/oscura/reporting/visualization.py-382" name="src/oscura/reporting/visualization.py-382"></a>            <span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">IEEE_COLORS</span><span class="p">[</span><span class="s2">&quot;primary&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span>
<a id="src/oscura/reporting/visualization.py-383" name="src/oscura/reporting/visualization.py-383"></a>        <span class="p">)</span>
<a id="src/oscura/reporting/visualization.py-384" name="src/oscura/reporting/visualization.py-384"></a>
<a id="src/oscura/reporting/visualization.py-385" name="src/oscura/reporting/visualization.py-385"></a>        <span class="c1"># Fit Gaussian</span>
<a id="src/oscura/reporting/visualization.py-386" name="src/oscura/reporting/visualization.py-386"></a><span class="hll">        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-387" name="src/oscura/reporting/visualization.py-387"></a><span class="hll">        <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-388" name="src/oscura/reporting/visualization.py-388"></a><span class="hll">        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">bins_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bins_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">200</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-389" name="src/oscura/reporting/visualization.py-389"></a><span class="hll">        <span class="n">gaussian</span> <span class="o">=</span> <span class="p">(</span>
</span><a id="src/oscura/reporting/visualization.py-390" name="src/oscura/reporting/visualization.py-390"></a>            <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="src/oscura/reporting/visualization.py-391" name="src/oscura/reporting/visualization.py-391"></a>            <span class="o">*</span> <span class="p">(</span><span class="n">bins_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bins_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="src/oscura/reporting/visualization.py-392" name="src/oscura/reporting/visualization.py-392"></a>            <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
<a id="src/oscura/reporting/visualization.py-393" name="src/oscura/reporting/visualization.py-393"></a>            <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-391" name="src/oscura/reporting/visualization.py-391"></a>            <span class="o">*</span> <span class="p">(</span><span class="n">bins_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bins_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="src/oscura/reporting/visualization.py-392" name="src/oscura/reporting/visualization.py-392"></a>            <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
<a id="src/oscura/reporting/visualization.py-393" name="src/oscura/reporting/visualization.py-393"></a>            <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<a id="src/oscura/reporting/visualization.py-394" name="src/oscura/reporting/visualization.py-394"></a>        <span class="p">)</span>
<a id="src/oscura/reporting/visualization.py-395" name="src/oscura/reporting/visualization.py-395"></a><span class="hll">        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">gaussian</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">IEEE_COLORS</span><span class="p">[</span><span class="s2">&quot;danger&quot;</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gaussian fit&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-396" name="src/oscura/reporting/visualization.py-396"></a>
<a id="src/oscura/reporting/visualization.py-397" name="src/oscura/reporting/visualization.py-397"></a>        <span class="c1"># Add statistics text</span>
<a id="src/oscura/reporting/visualization.py-398" name="src/oscura/reporting/visualization.py-398"></a><span class="hll">        <span class="n">stats_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mean = </span><span class="si">{</span><span class="n">mu</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\n</span><span class="s2">std = </span><span class="si">{</span><span class="n">sigma</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><a id="src/oscura/reporting/visualization.py-399" name="src/oscura/reporting/visualization.py-399"></a><span class="hll">        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><a id="src/oscura/reporting/visualization.py-400" name="src/oscura/reporting/visualization.py-400"></a>            <span class="mf">0.98</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-401" name="src/oscura/reporting/visualization.py-401"></a>            <span class="mf">0.98</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-402" name="src/oscura/reporting/visualization.py-402"></a>            <span class="n">stats_text</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-403" name="src/oscura/reporting/visualization.py-403"></a>            <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-406" name="src/oscura/reporting/visualization.py-406"></a>            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-407" name="src/oscura/reporting/visualization.py-407"></a>            <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;boxstyle&quot;</span><span class="p">:</span> <span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="s2">&quot;facecolor&quot;</span><span class="p">:</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">},</span>
<a id="src/oscura/reporting/visualization.py-408" name="src/oscura/reporting/visualization.py-408"></a>        <span class="p">)</span>
<a id="src/oscura/reporting/visualization.py-409" name="src/oscura/reporting/visualization.py-409"></a>
<a id="src/oscura/reporting/visualization.py-410" name="src/oscura/reporting/visualization.py-410"></a><span class="hll">        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-411" name="src/oscura/reporting/visualization.py-411"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">styler</span><span class="o">.</span><span class="n">apply_ieee_style</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-412" name="src/oscura/reporting/visualization.py-412"></a><span class="hll">        <span class="k">return</span> <span class="n">fig</span>
</span><a id="src/oscura/reporting/visualization.py-413" name="src/oscura/reporting/visualization.py-413"></a>
<a id="src/oscura/reporting/visualization.py-414" name="src/oscura/reporting/visualization.py-414"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_jitter</span><span class="p">(</span>
<a id="src/oscura/reporting/visualization.py-415" name="src/oscura/reporting/visualization.py-415"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-416" name="src/oscura/reporting/visualization.py-416"></a>        <span class="n">time_intervals</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-428" name="src/oscura/reporting/visualization.py-428"></a><span class="sd">        Example:</span>
<a id="src/oscura/reporting/visualization.py-429" name="src/oscura/reporting/visualization.py-429"></a><span class="sd">            &gt;&gt;&gt; # time_intervals in seconds</span>
<a id="src/oscura/reporting/visualization.py-430" name="src/oscura/reporting/visualization.py-430"></a><span class="sd">            &gt;&gt;&gt; fig = generator.plot_jitter(time_intervals)</span>
<a id="src/oscura/reporting/visualization.py-431" name="src/oscura/reporting/visualization.py-431"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="src/oscura/reporting/visualization.py-432" name="src/oscura/reporting/visualization.py-432"></a><span class="hll">        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-433" name="src/oscura/reporting/visualization.py-433"></a><span class="hll">        <span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-434" name="src/oscura/reporting/visualization.py-434"></a>
<a id="src/oscura/reporting/visualization.py-435" name="src/oscura/reporting/visualization.py-435"></a>        <span class="c1"># Time series plot</span>
<a id="src/oscura/reporting/visualization.py-436" name="src/oscura/reporting/visualization.py-436"></a><span class="hll">        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><a id="src/oscura/reporting/visualization.py-437" name="src/oscura/reporting/visualization.py-437"></a><span class="hll">        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><a id="src/oscura/reporting/visualization.py-438" name="src/oscura/reporting/visualization.py-438"></a>            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_intervals</span><span class="p">)),</span>
<a id="src/oscura/reporting/visualization.py-439" name="src/oscura/reporting/visualization.py-439"></a>            <span class="n">time_intervals</span> <span class="o">*</span> <span class="mf">1e9</span><span class="p">,</span>  <span class="c1"># Convert to nanoseconds</span>
<a id="src/oscura/reporting/visualization.py-440" name="src/oscura/reporting/visualization.py-440"></a>            <span class="n">color</span><span class="o">=</span><span class="n">IEEE_COLORS</span><span class="p">[</span><span class="s2">&quot;primary&quot;</span><span class="p">],</span>
<a id="src/oscura/reporting/visualization.py-441" name="src/oscura/reporting/visualization.py-441"></a>            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-442" name="src/oscura/reporting/visualization.py-442"></a>            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-443" name="src/oscura/reporting/visualization.py-443"></a>            <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-444" name="src/oscura/reporting/visualization.py-444"></a>            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-445" name="src/oscura/reporting/visualization.py-445"></a>        <span class="p">)</span>
<a id="src/oscura/reporting/visualization.py-446" name="src/oscura/reporting/visualization.py-446"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">styler</span><span class="o">.</span><span class="n">apply_ieee_style</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="s2">&quot;Interval #&quot;</span><span class="p">,</span> <span class="s2">&quot;Jitter (ns)&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2"> - Time Series&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-447" name="src/oscura/reporting/visualization.py-447"></a>
<a id="src/oscura/reporting/visualization.py-448" name="src/oscura/reporting/visualization.py-448"></a>        <span class="c1"># Histogram</span>
<a id="src/oscura/reporting/visualization.py-449" name="src/oscura/reporting/visualization.py-449"></a><span class="hll">        <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><a id="src/oscura/reporting/visualization.py-450" name="src/oscura/reporting/visualization.py-450"></a><span class="hll">        <span class="n">jitter_ns</span> <span class="o">=</span> <span class="n">time_intervals</span> <span class="o">*</span> <span class="mf">1e9</span>
</span><a id="src/oscura/reporting/visualization.py-451" name="src/oscura/reporting/visualization.py-451"></a><span class="hll">        <span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">jitter_ns</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">IEEE_COLORS</span><span class="p">[</span><span class="s2">&quot;secondary&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-452" name="src/oscura/reporting/visualization.py-452"></a>
<a id="src/oscura/reporting/visualization.py-453" name="src/oscura/reporting/visualization.py-453"></a>        <span class="c1"># Statistics</span>
<a id="src/oscura/reporting/visualization.py-454" name="src/oscura/reporting/visualization.py-454"></a><span class="hll">        <span class="n">mean_jitter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">jitter_ns</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-455" name="src/oscura/reporting/visualization.py-455"></a><span class="hll">        <span class="n">std_jitter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">jitter_ns</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-456" name="src/oscura/reporting/visualization.py-456"></a><span class="hll">        <span class="n">pk_pk_jitter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">jitter_ns</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">jitter_ns</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-457" name="src/oscura/reporting/visualization.py-457"></a>
<a id="src/oscura/reporting/visualization.py-458" name="src/oscura/reporting/visualization.py-458"></a><span class="hll">        <span class="n">stats_text</span> <span class="o">=</span> <span class="p">(</span>
</span><a id="src/oscura/reporting/visualization.py-459" name="src/oscura/reporting/visualization.py-459"></a>            <span class="sa">f</span><span class="s2">&quot;Mean: </span><span class="si">{</span><span class="n">mean_jitter</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ns</span><span class="se">\n</span><span class="s2">Std: </span><span class="si">{</span><span class="n">std_jitter</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ns</span><span class="se">\n</span><span class="s2">Pk-Pk: </span><span class="si">{</span><span class="n">pk_pk_jitter</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ns&quot;</span>
<a id="src/oscura/reporting/visualization.py-460" name="src/oscura/reporting/visualization.py-460"></a>        <span class="p">)</span>
<a id="src/oscura/reporting/visualization.py-461" name="src/oscura/reporting/visualization.py-461"></a><span class="hll">        <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><a id="src/oscura/reporting/visualization.py-462" name="src/oscura/reporting/visualization.py-462"></a>            <span class="mf">0.98</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-463" name="src/oscura/reporting/visualization.py-463"></a>            <span class="mf">0.98</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-464" name="src/oscura/reporting/visualization.py-464"></a>            <span class="n">stats_text</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-465" name="src/oscura/reporting/visualization.py-465"></a>            <span class="n">transform</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-468" name="src/oscura/reporting/visualization.py-468"></a>            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-469" name="src/oscura/reporting/visualization.py-469"></a>            <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;boxstyle&quot;</span><span class="p">:</span> <span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="s2">&quot;facecolor&quot;</span><span class="p">:</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">},</span>
<a id="src/oscura/reporting/visualization.py-470" name="src/oscura/reporting/visualization.py-470"></a>        <span class="p">)</span>
<a id="src/oscura/reporting/visualization.py-471" name="src/oscura/reporting/visualization.py-471"></a>
<a id="src/oscura/reporting/visualization.py-472" name="src/oscura/reporting/visualization.py-472"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">styler</span><span class="o">.</span><span class="n">apply_ieee_style</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span> <span class="s2">&quot;Jitter (ns)&quot;</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="s2">&quot;Distribution&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-473" name="src/oscura/reporting/visualization.py-473"></a>
<a id="src/oscura/reporting/visualization.py-474" name="src/oscura/reporting/visualization.py-474"></a><span class="hll">        <span class="k">return</span> <span class="n">fig</span>
</span><a id="src/oscura/reporting/visualization.py-475" name="src/oscura/reporting/visualization.py-475"></a>
<a id="src/oscura/reporting/visualization.py-476" name="src/oscura/reporting/visualization.py-476"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_power</span><span class="p">(</span>
<a id="src/oscura/reporting/visualization.py-477" name="src/oscura/reporting/visualization.py-477"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="src/oscura/reporting/visualization.py-478" name="src/oscura/reporting/visualization.py-478"></a>        <span class="n">time</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-493" name="src/oscura/reporting/visualization.py-493"></a>
<a id="src/oscura/reporting/visualization.py-494" name="src/oscura/reporting/visualization.py-494"></a><span class="sd">        Example:</span>
<a id="src/oscura/reporting/visualization.py-495" name="src/oscura/reporting/visualization.py-495"></a><span class="sd">            &gt;&gt;&gt; fig = generator.plot_power(time, voltage, current)</span>
<a id="src/oscura/reporting/visualization.py-496" name="src/oscura/reporting/visualization.py-496"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="src/oscura/reporting/visualization.py-497" name="src/oscura/reporting/visualization.py-497"></a><span class="hll">        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-498" name="src/oscura/reporting/visualization.py-498"></a>
<a id="src/oscura/reporting/visualization.py-499" name="src/oscura/reporting/visualization.py-499"></a>        <span class="c1"># Voltage</span>
<a id="src/oscura/reporting/visualization.py-500" name="src/oscura/reporting/visualization.py-500"></a><span class="hll">        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">IEEE_COLORS</span><span class="p">[</span><span class="s2">&quot;primary&quot;</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-501" name="src/oscura/reporting/visualization.py-501"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">styler</span><span class="o">.</span><span class="n">apply_ieee_style</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Voltage (V)&quot;</span><span class="p">,</span> <span class="s2">&quot;Voltage&quot;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-502" name="src/oscura/reporting/visualization.py-502"></a>
<a id="src/oscura/reporting/visualization.py-503" name="src/oscura/reporting/visualization.py-503"></a>        <span class="c1"># Current</span>
<a id="src/oscura/reporting/visualization.py-504" name="src/oscura/reporting/visualization.py-504"></a><span class="hll">        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">IEEE_COLORS</span><span class="p">[</span><span class="s2">&quot;secondary&quot;</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-505" name="src/oscura/reporting/visualization.py-505"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">styler</span><span class="o">.</span><span class="n">apply_ieee_style</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Current (A)&quot;</span><span class="p">,</span> <span class="s2">&quot;Current&quot;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-506" name="src/oscura/reporting/visualization.py-506"></a>
<a id="src/oscura/reporting/visualization.py-507" name="src/oscura/reporting/visualization.py-507"></a>        <span class="c1"># Power</span>
<a id="src/oscura/reporting/visualization.py-508" name="src/oscura/reporting/visualization.py-508"></a><span class="hll">        <span class="n">power</span> <span class="o">=</span> <span class="n">voltage</span> <span class="o">*</span> <span class="n">current</span>
</span><a id="src/oscura/reporting/visualization.py-509" name="src/oscura/reporting/visualization.py-509"></a><span class="hll">        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">IEEE_COLORS</span><span class="p">[</span><span class="s2">&quot;accent&quot;</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-510" name="src/oscura/reporting/visualization.py-510"></a><span class="hll">        <span class="n">ax3</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-511" name="src/oscura/reporting/visualization.py-511"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">styler</span><span class="o">.</span><span class="n">apply_ieee_style</span><span class="p">(</span><span class="n">ax3</span><span class="p">,</span> <span class="s2">&quot;Time (s)&quot;</span><span class="p">,</span> <span class="s2">&quot;Power (W)&quot;</span><span class="p">,</span> <span class="s2">&quot;Instantaneous Power&quot;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-512" name="src/oscura/reporting/visualization.py-512"></a>
<a id="src/oscura/reporting/visualization.py-513" name="src/oscura/reporting/visualization.py-513"></a><span class="hll">        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.995</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-514" name="src/oscura/reporting/visualization.py-514"></a><span class="hll">        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><a id="src/oscura/reporting/visualization.py-515" name="src/oscura/reporting/visualization.py-515"></a>
<a id="src/oscura/reporting/visualization.py-516" name="src/oscura/reporting/visualization.py-516"></a><span class="hll">        <span class="k">return</span> <span class="n">fig</span>
</span><a id="src/oscura/reporting/visualization.py-517" name="src/oscura/reporting/visualization.py-517"></a>
<a id="src/oscura/reporting/visualization.py-518" name="src/oscura/reporting/visualization.py-518"></a>    <span class="nd">@staticmethod</span>
<a id="src/oscura/reporting/visualization.py-519" name="src/oscura/reporting/visualization.py-519"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">figure_to_base64</span><span class="p">(</span><span class="n">fig</span><span class="p">:</span> <span class="n">Figure</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;png&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="src/oscura/reporting/visualization.py-520" name="src/oscura/reporting/visualization.py-520"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert matplotlib figure to base64-encoded string for HTML embedding.</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/reporting/visualization.py-531" name="src/oscura/reporting/visualization.py-531"></a><span class="sd">            &gt;&gt;&gt; img_str = IEEEPlotGenerator.figure_to_base64(fig)</span>
<a id="src/oscura/reporting/visualization.py-532" name="src/oscura/reporting/visualization.py-532"></a><span class="sd">            &gt;&gt;&gt; &quot;data:image/png;base64,&quot; in img_str</span>
<a id="src/oscura/reporting/visualization.py-533" name="src/oscura/reporting/visualization.py-533"></a><span class="sd">            True</span>
<a id="src/oscura/reporting/visualization.py-534" name="src/oscura/reporting/visualization.py-534"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="src/oscura/reporting/visualization.py-535" name="src/oscura/reporting/visualization.py-535"></a><span class="hll">        <span class="n">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
</span><a id="src/oscura/reporting/visualization.py-536" name="src/oscura/reporting/visualization.py-536"></a><span class="hll">        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-537" name="src/oscura/reporting/visualization.py-537"></a><span class="hll">        <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-538" name="src/oscura/reporting/visualization.py-538"></a><span class="hll">        <span class="n">img_base64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">buffer</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-539" name="src/oscura/reporting/visualization.py-539"></a><span class="hll">        <span class="n">buffer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><a id="src/oscura/reporting/visualization.py-540" name="src/oscura/reporting/visualization.py-540"></a><span class="hll">        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><a id="src/oscura/reporting/visualization.py-541" name="src/oscura/reporting/visualization.py-541"></a>
<a id="src/oscura/reporting/visualization.py-542" name="src/oscura/reporting/visualization.py-542"></a><span class="hll">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;data:image/</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">;base64,</span><span class="si">{</span><span class="n">img_base64</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/oscura/visualization/batch.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/visualization/batch.py-95" name="src/oscura/visualization/batch.py-95"></a>
<a id="src/oscura/visualization/batch.py-96" name="src/oscura/visualization/batch.py-96"></a>    <span class="c1"># Prepare data with downsampling if needed</span>
<a id="src/oscura/visualization/batch.py-97" name="src/oscura/visualization/batch.py-97"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span>
<a id="src/oscura/visualization/batch.py-98" name="src/oscura/visualization/batch.py-98"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">sample_limit</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-99" name="src/oscura/visualization/batch.py-99"></a><span class="hll">        <span class="n">step</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">//</span> <span class="n">sample_limit</span>
</span><a id="src/oscura/visualization/batch.py-100" name="src/oscura/visualization/batch.py-100"></a><span class="hll">        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[::</span><span class="n">step</span><span class="p">]</span>
</span><a id="src/oscura/visualization/batch.py-101" name="src/oscura/visualization/batch.py-101"></a><span class="hll">        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">*</span> <span class="n">step</span> <span class="o">/</span> <span class="n">trace</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">sample_rate</span>
</span><a id="src/oscura/visualization/batch.py-102" name="src/oscura/visualization/batch.py-102"></a>    <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-103" name="src/oscura/visualization/batch.py-103"></a>        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="n">trace</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">sample_rate</span>
<a id="src/oscura/visualization/batch.py-104" name="src/oscura/visualization/batch.py-104"></a>
<a id="src/oscura/visualization/batch.py-105" name="src/oscura/visualization/batch.py-105"></a>    <span class="c1"># Plot waveform</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/visualization/batch.py-328" name="src/oscura/visualization/batch.py-328"></a>
<a id="src/oscura/visualization/batch.py-329" name="src/oscura/visualization/batch.py-329"></a>    <span class="c1"># Prepare data with downsampling if needed</span>
<a id="src/oscura/visualization/batch.py-330" name="src/oscura/visualization/batch.py-330"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="src/oscura/visualization/batch.py-331" name="src/oscura/visualization/batch.py-331"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_samples</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-332" name="src/oscura/visualization/batch.py-332"></a><span class="hll">        <span class="n">step</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">//</span> <span class="n">max_samples</span>
</span><a id="src/oscura/visualization/batch.py-333" name="src/oscura/visualization/batch.py-333"></a><span class="hll">        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[::</span><span class="n">step</span><span class="p">]</span>
</span><a id="src/oscura/visualization/batch.py-334" name="src/oscura/visualization/batch.py-334"></a><span class="hll">        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">*</span> <span class="n">step</span> <span class="o">/</span> <span class="n">trace</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">sample_rate</span>
</span><a id="src/oscura/visualization/batch.py-335" name="src/oscura/visualization/batch.py-335"></a>    <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-336" name="src/oscura/visualization/batch.py-336"></a>        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="n">trace</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">sample_rate</span>
<a id="src/oscura/visualization/batch.py-337" name="src/oscura/visualization/batch.py-337"></a>
<a id="src/oscura/visualization/batch.py-338" name="src/oscura/visualization/batch.py-338"></a>    <span class="c1"># Plot as step function (digital signal)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/visualization/batch.py-388" name="src/oscura/visualization/batch.py-388"></a>        <span class="n">whiskerprops</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;linewidth&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">},</span>
<a id="src/oscura/visualization/batch.py-389" name="src/oscura/visualization/batch.py-389"></a>        <span class="n">capprops</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;linewidth&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">},</span>
<a id="src/oscura/visualization/batch.py-390" name="src/oscura/visualization/batch.py-390"></a>    <span class="p">)</span>
<a id="src/oscura/visualization/batch.py-391" name="src/oscura/visualization/batch.py-391"></a>
<a id="src/oscura/visualization/batch.py-392" name="src/oscura/visualization/batch.py-392"></a><span class="hll">    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Amplitude (V)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-393" name="src/oscura/visualization/batch.py-393"></a><span class="hll">    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Box Plot&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-394" name="src/oscura/visualization/batch.py-394"></a><span class="hll">    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-395" name="src/oscura/visualization/batch.py-395"></a><span class="hll">    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
</span><a id="src/oscura/visualization/batch.py-396" name="src/oscura/visualization/batch.py-396"></a>
<a id="src/oscura/visualization/batch.py-397" name="src/oscura/visualization/batch.py-397"></a>    <span class="c1"># Violin plot</span>
<a id="src/oscura/visualization/batch.py-398" name="src/oscura/visualization/batch.py-398"></a><span class="hll">    <span class="n">parts</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">violinplot</span><span class="p">([</span><span class="n">data</span><span class="p">],</span> <span class="n">vert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">widths</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showmeans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">showextrema</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-399" name="src/oscura/visualization/batch.py-399"></a><span class="hll">    <span class="k">for</span> <span class="n">pc</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="s2">&quot;bodies&quot;</span><span class="p">]:</span>
</span><a id="src/oscura/visualization/batch.py-400" name="src/oscura/visualization/batch.py-400"></a><span class="hll">        <span class="n">pc</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">COLORS</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">])</span>
</span><a id="src/oscura/visualization/batch.py-401" name="src/oscura/visualization/batch.py-401"></a><span class="hll">        <span class="n">pc</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-402" name="src/oscura/visualization/batch.py-402"></a>
<a id="src/oscura/visualization/batch.py-403" name="src/oscura/visualization/batch.py-403"></a><span class="hll">    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Amplitude (V)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-404" name="src/oscura/visualization/batch.py-404"></a><span class="hll">    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Violin Plot&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-405" name="src/oscura/visualization/batch.py-405"></a><span class="hll">    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-406" name="src/oscura/visualization/batch.py-406"></a><span class="hll">    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
</span><a id="src/oscura/visualization/batch.py-407" name="src/oscura/visualization/batch.py-407"></a>
<a id="src/oscura/visualization/batch.py-408" name="src/oscura/visualization/batch.py-408"></a><span class="hll">    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-409" name="src/oscura/visualization/batch.py-409"></a><span class="hll">    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><a id="src/oscura/visualization/batch.py-410" name="src/oscura/visualization/batch.py-410"></a><span class="hll">    <span class="k">return</span> <span class="n">fig_to_base64</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-411" name="src/oscura/visualization/batch.py-411"></a>
<a id="src/oscura/visualization/batch.py-412" name="src/oscura/visualization/batch.py-412"></a>
<a id="src/oscura/visualization/batch.py-413" name="src/oscura/visualization/batch.py-413"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_all_plots</span><span class="p">(</span>
<a id="src/oscura/visualization/batch.py-414" name="src/oscura/visualization/batch.py-414"></a>    <span class="n">trace</span><span class="p">:</span> <span class="n">WaveformTrace</span> <span class="o">|</span> <span class="n">DigitalTrace</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/visualization/batch.py-439" name="src/oscura/visualization/batch.py-439"></a><span class="sd">        &gt;&gt;&gt; len(plots)  # 5 plots for analog signal</span>
<a id="src/oscura/visualization/batch.py-440" name="src/oscura/visualization/batch.py-440"></a><span class="sd">        5</span>
<a id="src/oscura/visualization/batch.py-441" name="src/oscura/visualization/batch.py-441"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/visualization/batch.py-442" name="src/oscura/visualization/batch.py-442"></a>    <span class="k">if</span> <span class="n">output_format</span> <span class="o">!=</span> <span class="s2">&quot;base64&quot;</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-443" name="src/oscura/visualization/batch.py-443"></a><span class="hll">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Only &#39;base64&#39; output format supported, got &#39;</span><span class="si">{</span><span class="n">output_format</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-444" name="src/oscura/visualization/batch.py-444"></a>
<a id="src/oscura/visualization/batch.py-445" name="src/oscura/visualization/batch.py-445"></a>    <span class="n">plots</span> <span class="o">=</span> <span class="p">{}</span>
<a id="src/oscura/visualization/batch.py-446" name="src/oscura/visualization/batch.py-446"></a>    <span class="n">is_digital</span> <span class="o">=</span> <span class="p">(</span>
<a id="src/oscura/visualization/batch.py-447" name="src/oscura/visualization/batch.py-447"></a>        <span class="n">trace</span><span class="o">.</span><span class="n">is_digital</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="s2">&quot;is_digital&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">DigitalTrace</span><span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/visualization/batch.py-450" name="src/oscura/visualization/batch.py-450"></a>    <span class="c1"># Always generate waveform plot</span>
<a id="src/oscura/visualization/batch.py-451" name="src/oscura/visualization/batch.py-451"></a>    <span class="k">try</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-452" name="src/oscura/visualization/batch.py-452"></a>        <span class="n">plots</span><span class="p">[</span><span class="s2">&quot;waveform&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_waveform</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
<a id="src/oscura/visualization/batch.py-453" name="src/oscura/visualization/batch.py-453"></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-454" name="src/oscura/visualization/batch.py-454"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Generated waveform plot&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-455" name="src/oscura/visualization/batch.py-455"></a><span class="hll">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/oscura/visualization/batch.py-456" name="src/oscura/visualization/batch.py-456"></a><span class="hll">        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/visualization/batch.py-457" name="src/oscura/visualization/batch.py-457"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Waveform plot failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-458" name="src/oscura/visualization/batch.py-458"></a>
<a id="src/oscura/visualization/batch.py-459" name="src/oscura/visualization/batch.py-459"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_digital</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-460" name="src/oscura/visualization/batch.py-460"></a>        <span class="c1"># Analog signal plots</span>
<a id="src/oscura/visualization/batch.py-461" name="src/oscura/visualization/batch.py-461"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">WaveformTrace</span><span class="p">):</span>  <span class="c1"># Type narrowing</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/visualization/batch.py-461" name="src/oscura/visualization/batch.py-461"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">WaveformTrace</span><span class="p">):</span>  <span class="c1"># Type narrowing</span>
<a id="src/oscura/visualization/batch.py-462" name="src/oscura/visualization/batch.py-462"></a>            <span class="k">try</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-463" name="src/oscura/visualization/batch.py-463"></a>                <span class="n">plots</span><span class="p">[</span><span class="s2">&quot;fft&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_fft_spectrum</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
<a id="src/oscura/visualization/batch.py-464" name="src/oscura/visualization/batch.py-464"></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-465" name="src/oscura/visualization/batch.py-465"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Generated FFT spectrum&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-466" name="src/oscura/visualization/batch.py-466"></a><span class="hll">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/oscura/visualization/batch.py-467" name="src/oscura/visualization/batch.py-467"></a><span class="hll">                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/visualization/batch.py-468" name="src/oscura/visualization/batch.py-468"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   FFT plot failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-469" name="src/oscura/visualization/batch.py-469"></a>
<a id="src/oscura/visualization/batch.py-470" name="src/oscura/visualization/batch.py-470"></a>            <span class="k">try</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-471" name="src/oscura/visualization/batch.py-471"></a>                <span class="n">plots</span><span class="p">[</span><span class="s2">&quot;histogram&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_histogram</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<a id="src/oscura/visualization/batch.py-472" name="src/oscura/visualization/batch.py-472"></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-473" name="src/oscura/visualization/batch.py-473"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Generated histogram&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-474" name="src/oscura/visualization/batch.py-474"></a><span class="hll">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/oscura/visualization/batch.py-475" name="src/oscura/visualization/batch.py-475"></a><span class="hll">                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/visualization/batch.py-476" name="src/oscura/visualization/batch.py-476"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Histogram plot failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-477" name="src/oscura/visualization/batch.py-477"></a>
<a id="src/oscura/visualization/batch.py-478" name="src/oscura/visualization/batch.py-478"></a>            <span class="k">try</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-479" name="src/oscura/visualization/batch.py-479"></a>                <span class="n">plots</span><span class="p">[</span><span class="s2">&quot;spectrogram&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_spectrogram</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
<a id="src/oscura/visualization/batch.py-480" name="src/oscura/visualization/batch.py-480"></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-481" name="src/oscura/visualization/batch.py-481"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Generated spectrogram&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-482" name="src/oscura/visualization/batch.py-482"></a><span class="hll">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/oscura/visualization/batch.py-483" name="src/oscura/visualization/batch.py-483"></a><span class="hll">                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/visualization/batch.py-484" name="src/oscura/visualization/batch.py-484"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Spectrogram plot failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-485" name="src/oscura/visualization/batch.py-485"></a>
<a id="src/oscura/visualization/batch.py-486" name="src/oscura/visualization/batch.py-486"></a>            <span class="k">try</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-487" name="src/oscura/visualization/batch.py-487"></a>                <span class="n">plots</span><span class="p">[</span><span class="s2">&quot;statistics&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_statistics_summary</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<a id="src/oscura/visualization/batch.py-488" name="src/oscura/visualization/batch.py-488"></a><span class="hll">                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/visualization/batch.py-489" name="src/oscura/visualization/batch.py-489"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Generated statistics summary&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-490" name="src/oscura/visualization/batch.py-490"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-491" name="src/oscura/visualization/batch.py-491"></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-492" name="src/oscura/visualization/batch.py-492"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Statistics plot failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-493" name="src/oscura/visualization/batch.py-493"></a>    <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-494" name="src/oscura/visualization/batch.py-494"></a>        <span class="c1"># Digital signal plots</span>
<a id="src/oscura/visualization/batch.py-495" name="src/oscura/visualization/batch.py-495"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">oscura.core.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">DigitalTrace</span> <span class="k">as</span> <span class="n">DigitalTraceType</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/visualization/batch.py-497" name="src/oscura/visualization/batch.py-497"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">DigitalTraceType</span><span class="p">):</span>  <span class="c1"># Type narrowing</span>
<a id="src/oscura/visualization/batch.py-498" name="src/oscura/visualization/batch.py-498"></a>            <span class="k">try</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-499" name="src/oscura/visualization/batch.py-499"></a>                <span class="n">plots</span><span class="p">[</span><span class="s2">&quot;logic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_logic_analyzer</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
<a id="src/oscura/visualization/batch.py-500" name="src/oscura/visualization/batch.py-500"></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a id="src/oscura/visualization/batch.py-501" name="src/oscura/visualization/batch.py-501"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Generated logic analyzer view&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-502" name="src/oscura/visualization/batch.py-502"></a><span class="hll">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/oscura/visualization/batch.py-503" name="src/oscura/visualization/batch.py-503"></a><span class="hll">                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/visualization/batch.py-504" name="src/oscura/visualization/batch.py-504"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Logic analyzer plot failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/visualization/batch.py-505" name="src/oscura/visualization/batch.py-505"></a>
<a id="src/oscura/visualization/batch.py-506" name="src/oscura/visualization/batch.py-506"></a>    <span class="k">return</span> <span class="n">plots</span>
<a id="src/oscura/visualization/batch.py-507" name="src/oscura/visualization/batch.py-507"></a>
</pre></div></td></tr></table></div>

            </div>
        </div>
        <div class="src-snippet">
            <div class="src-name">src/oscura/workflows/waveform.py</div>
            <div class="snippets">
            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-121" name="src/oscura/workflows/waveform.py-121"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">filepath</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="src/oscura/workflows/waveform.py-122" name="src/oscura/workflows/waveform.py-122"></a>        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-123" name="src/oscura/workflows/waveform.py-123"></a>
<a id="src/oscura/workflows/waveform.py-124" name="src/oscura/workflows/waveform.py-124"></a>    <span class="c1"># Set up output directory</span>
<a id="src/oscura/workflows/waveform.py-125" name="src/oscura/workflows/waveform.py-125"></a><span class="hll">    <span class="k">if</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-126" name="src/oscura/workflows/waveform.py-126"></a><span class="hll">        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./waveform_analysis_output&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-127" name="src/oscura/workflows/waveform.py-127"></a>    <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/workflows/waveform.py-128" name="src/oscura/workflows/waveform.py-128"></a><span class="hll">        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-129" name="src/oscura/workflows/waveform.py-129"></a><span class="hll">    <span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-130" name="src/oscura/workflows/waveform.py-130"></a>
<a id="src/oscura/workflows/waveform.py-131" name="src/oscura/workflows/waveform.py-131"></a>    <span class="c1"># Determine which analyses to run</span>
<a id="src/oscura/workflows/waveform.py-132" name="src/oscura/workflows/waveform.py-132"></a><span class="hll">    <span class="n">valid_analyses</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;time_domain&quot;</span><span class="p">,</span> <span class="s2">&quot;frequency_domain&quot;</span><span class="p">,</span> <span class="s2">&quot;digital&quot;</span><span class="p">,</span> <span class="s2">&quot;statistics&quot;</span><span class="p">}</span>
</span><a id="src/oscura/workflows/waveform.py-133" name="src/oscura/workflows/waveform.py-133"></a><span class="hll">    <span class="k">if</span> <span class="n">analyses</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-134" name="src/oscura/workflows/waveform.py-134"></a><span class="hll">        <span class="n">requested_analyses</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">valid_analyses</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-135" name="src/oscura/workflows/waveform.py-135"></a>    <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/workflows/waveform.py-136" name="src/oscura/workflows/waveform.py-136"></a><span class="hll">        <span class="n">requested_analyses</span> <span class="o">=</span> <span class="n">analyses</span>
</span><a id="src/oscura/workflows/waveform.py-137" name="src/oscura/workflows/waveform.py-137"></a><span class="hll">        <span class="n">invalid</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">requested_analyses</span><span class="p">)</span> <span class="o">-</span> <span class="n">valid_analyses</span>
</span><a id="src/oscura/workflows/waveform.py-138" name="src/oscura/workflows/waveform.py-138"></a><span class="hll">        <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-139" name="src/oscura/workflows/waveform.py-139"></a><span class="hll">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid analysis types: </span><span class="si">{</span><span class="n">invalid</span><span class="si">}</span><span class="s2">. Valid: </span><span class="si">{</span><span class="n">valid_analyses</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-140" name="src/oscura/workflows/waveform.py-140"></a>
<a id="src/oscura/workflows/waveform.py-141" name="src/oscura/workflows/waveform.py-141"></a><span class="hll">    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-142" name="src/oscura/workflows/waveform.py-142"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-143" name="src/oscura/workflows/waveform.py-143"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OSCURA COMPLETE WAVEFORM ANALYSIS WITH REVERSE ENGINEERING&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-144" name="src/oscura/workflows/waveform.py-144"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-145" name="src/oscura/workflows/waveform.py-145"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Loading: </span><span class="si">{</span><span class="n">filepath</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-146" name="src/oscura/workflows/waveform.py-146"></a>
<a id="src/oscura/workflows/waveform.py-147" name="src/oscura/workflows/waveform.py-147"></a>    <span class="c1"># Step 1: Load waveform</span>
<a id="src/oscura/workflows/waveform.py-148" name="src/oscura/workflows/waveform.py-148"></a><span class="hll">    <span class="n">trace</span> <span class="o">=</span> <span class="n">osc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-149" name="src/oscura/workflows/waveform.py-149"></a>
<a id="src/oscura/workflows/waveform.py-150" name="src/oscura/workflows/waveform.py-150"></a>    <span class="c1"># Detect signal type using new properties</span>
<a id="src/oscura/workflows/waveform.py-151" name="src/oscura/workflows/waveform.py-151"></a><span class="hll">    <span class="n">is_digital</span> <span class="o">=</span> <span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-152" name="src/oscura/workflows/waveform.py-152"></a>        <span class="n">trace</span><span class="o">.</span><span class="n">is_digital</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="s2">&quot;is_digital&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">DigitalTrace</span><span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-153" name="src/oscura/workflows/waveform.py-153"></a>    <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-154" name="src/oscura/workflows/waveform.py-154"></a>
<a id="src/oscura/workflows/waveform.py-155" name="src/oscura/workflows/waveform.py-155"></a><span class="hll">    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-156" name="src/oscura/workflows/waveform.py-156"></a><span class="hll">        <span class="n">signal_type</span> <span class="o">=</span> <span class="s2">&quot;Digital&quot;</span> <span class="k">if</span> <span class="n">is_digital</span> <span class="k">else</span> <span class="s2">&quot;Analog&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-157" name="src/oscura/workflows/waveform.py-157"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Loaded </span><span class="si">{</span><span class="n">signal_type</span><span class="si">}</span><span class="s2"> signal&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-158" name="src/oscura/workflows/waveform.py-158"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Samples: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-159" name="src/oscura/workflows/waveform.py-159"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Sample rate: </span><span class="si">{</span><span class="n">trace</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">sample_rate</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> Hz&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-160" name="src/oscura/workflows/waveform.py-160"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Duration: </span><span class="si">{</span><span class="n">trace</span><span class="o">.</span><span class="n">duration</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-161" name="src/oscura/workflows/waveform.py-161"></a>
<a id="src/oscura/workflows/waveform.py-162" name="src/oscura/workflows/waveform.py-162"></a>    <span class="c1"># Step 2: Run basic analyses</span>
<a id="src/oscura/workflows/waveform.py-163" name="src/oscura/workflows/waveform.py-163"></a><span class="hll">    <span class="n">results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><a id="src/oscura/workflows/waveform.py-164" name="src/oscura/workflows/waveform.py-164"></a>
<a id="src/oscura/workflows/waveform.py-165" name="src/oscura/workflows/waveform.py-165"></a><span class="hll">    <span class="k">if</span> <span class="s2">&quot;time_domain&quot;</span> <span class="ow">in</span> <span class="n">requested_analyses</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-166" name="src/oscura/workflows/waveform.py-166"></a><span class="hll">        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-167" name="src/oscura/workflows/waveform.py-167"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-168" name="src/oscura/workflows/waveform.py-168"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TIME-DOMAIN ANALYSIS&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-169" name="src/oscura/workflows/waveform.py-169"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-170" name="src/oscura/workflows/waveform.py-170"></a>
<a id="src/oscura/workflows/waveform.py-171" name="src/oscura/workflows/waveform.py-171"></a>        <span class="c1"># Run time-domain measurements - GET ALL AVAILABLE</span>
<a id="src/oscura/workflows/waveform.py-172" name="src/oscura/workflows/waveform.py-172"></a><span class="hll">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">WaveformTrace</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-173" name="src/oscura/workflows/waveform.py-173"></a><span class="hll">            <span class="kn">from</span><span class="w"> </span><span class="nn">oscura.analyzers</span><span class="w"> </span><span class="kn">import</span> <span class="n">waveform</span> <span class="k">as</span> <span class="n">waveform_analyzer</span>
</span><a id="src/oscura/workflows/waveform.py-174" name="src/oscura/workflows/waveform.py-174"></a>
<a id="src/oscura/workflows/waveform.py-175" name="src/oscura/workflows/waveform.py-175"></a>            <span class="c1"># Pass parameters=None to get ALL available measurements</span>
<a id="src/oscura/workflows/waveform.py-176" name="src/oscura/workflows/waveform.py-176"></a><span class="hll">            <span class="n">time_results</span> <span class="o">=</span> <span class="n">waveform_analyzer</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_units</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-177" name="src/oscura/workflows/waveform.py-177"></a><span class="hll">            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;time_domain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_results</span>
</span><a id="src/oscura/workflows/waveform.py-178" name="src/oscura/workflows/waveform.py-178"></a><span class="hll">            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-179" name="src/oscura/workflows/waveform.py-179"></a><span class="hll">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Completed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">time_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> measurements&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-180" name="src/oscura/workflows/waveform.py-180"></a>
<a id="src/oscura/workflows/waveform.py-181" name="src/oscura/workflows/waveform.py-181"></a><span class="hll">    <span class="k">if</span> <span class="s2">&quot;frequency_domain&quot;</span> <span class="ow">in</span> <span class="n">requested_analyses</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_digital</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-182" name="src/oscura/workflows/waveform.py-182"></a><span class="hll">        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-183" name="src/oscura/workflows/waveform.py-183"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-184" name="src/oscura/workflows/waveform.py-184"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FREQUENCY-DOMAIN ANALYSIS&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-185" name="src/oscura/workflows/waveform.py-185"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-186" name="src/oscura/workflows/waveform.py-186"></a>
<a id="src/oscura/workflows/waveform.py-187" name="src/oscura/workflows/waveform.py-187"></a><span class="hll">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">WaveformTrace</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-188" name="src/oscura/workflows/waveform.py-188"></a>            <span class="c1"># Run spectral analysis using unified measure() API</span>
<a id="src/oscura/workflows/waveform.py-189" name="src/oscura/workflows/waveform.py-189"></a><span class="hll">            <span class="kn">from</span><span class="w"> </span><span class="nn">oscura.analyzers.waveform</span><span class="w"> </span><span class="kn">import</span> <span class="n">spectral</span>
</span><a id="src/oscura/workflows/waveform.py-190" name="src/oscura/workflows/waveform.py-190"></a>
<a id="src/oscura/workflows/waveform.py-191" name="src/oscura/workflows/waveform.py-191"></a><span class="hll">            <span class="n">freq_results</span> <span class="o">=</span> <span class="n">spectral</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">include_units</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-192" name="src/oscura/workflows/waveform.py-192"></a>
<a id="src/oscura/workflows/waveform.py-193" name="src/oscura/workflows/waveform.py-193"></a>            <span class="c1"># Add FFT arrays for plotting (not measurements)</span>
<a id="src/oscura/workflows/waveform.py-194" name="src/oscura/workflows/waveform.py-194"></a><span class="hll">            <span class="k">try</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-195" name="src/oscura/workflows/waveform.py-195"></a><span class="hll">                <span class="n">fft_result</span> <span class="o">=</span> <span class="n">osc</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-196" name="src/oscura/workflows/waveform.py-196"></a><span class="hll">                <span class="n">freq_results</span><span class="p">[</span><span class="s2">&quot;fft_freqs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fft_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><a id="src/oscura/workflows/waveform.py-197" name="src/oscura/workflows/waveform.py-197"></a><span class="hll">                <span class="n">freq_results</span><span class="p">[</span><span class="s2">&quot;fft_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fft_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><a id="src/oscura/workflows/waveform.py-198" name="src/oscura/workflows/waveform.py-198"></a><span class="hll">            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-199" name="src/oscura/workflows/waveform.py-199"></a><span class="hll">                <span class="k">pass</span>
</span><a id="src/oscura/workflows/waveform.py-200" name="src/oscura/workflows/waveform.py-200"></a>
<a id="src/oscura/workflows/waveform.py-201" name="src/oscura/workflows/waveform.py-201"></a><span class="hll">            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;frequency_domain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq_results</span>
</span><a id="src/oscura/workflows/waveform.py-202" name="src/oscura/workflows/waveform.py-202"></a><span class="hll">            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-203" name="src/oscura/workflows/waveform.py-203"></a>                <span class="c1"># Count actual measurements (not arrays)</span>
<a id="src/oscura/workflows/waveform.py-204" name="src/oscura/workflows/waveform.py-204"></a><span class="hll">                <span class="n">numeric_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-205" name="src/oscura/workflows/waveform.py-205"></a>                    <span class="mi">1</span>
<a id="src/oscura/workflows/waveform.py-206" name="src/oscura/workflows/waveform.py-206"></a>                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">freq_results</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<a id="src/oscura/workflows/waveform.py-207" name="src/oscura/workflows/waveform.py-207"></a>                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fft_freqs&quot;</span><span class="p">,</span> <span class="s2">&quot;fft_data&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">dict</span><span class="p">))</span>
<a id="src/oscura/workflows/waveform.py-208" name="src/oscura/workflows/waveform.py-208"></a>                <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-209" name="src/oscura/workflows/waveform.py-209"></a><span class="hll">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Completed </span><span class="si">{</span><span class="n">numeric_count</span><span class="si">}</span><span class="s2"> measurements&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-210" name="src/oscura/workflows/waveform.py-210"></a>
<a id="src/oscura/workflows/waveform.py-211" name="src/oscura/workflows/waveform.py-211"></a><span class="hll">    <span class="k">if</span> <span class="s2">&quot;digital&quot;</span> <span class="ow">in</span> <span class="n">requested_analyses</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-212" name="src/oscura/workflows/waveform.py-212"></a><span class="hll">        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-213" name="src/oscura/workflows/waveform.py-213"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-214" name="src/oscura/workflows/waveform.py-214"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DIGITAL SIGNAL ANALYSIS&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-215" name="src/oscura/workflows/waveform.py-215"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-216" name="src/oscura/workflows/waveform.py-216"></a>
<a id="src/oscura/workflows/waveform.py-217" name="src/oscura/workflows/waveform.py-217"></a>        <span class="c1"># Run comprehensive digital analysis (works for both analog and digital traces)</span>
<a id="src/oscura/workflows/waveform.py-218" name="src/oscura/workflows/waveform.py-218"></a><span class="hll">        <span class="k">try</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-219" name="src/oscura/workflows/waveform.py-219"></a><span class="hll">            <span class="kn">from</span><span class="w"> </span><span class="nn">oscura.analyzers.digital</span><span class="w"> </span><span class="kn">import</span> <span class="n">signal_quality_summary</span><span class="p">,</span> <span class="n">timing</span>
</span><a id="src/oscura/workflows/waveform.py-220" name="src/oscura/workflows/waveform.py-220"></a>
<a id="src/oscura/workflows/waveform.py-221" name="src/oscura/workflows/waveform.py-221"></a>            <span class="c1"># Convert DigitalTrace to WaveformTrace for analysis</span>
<a id="src/oscura/workflows/waveform.py-222" name="src/oscura/workflows/waveform.py-222"></a><span class="hll">            <span class="n">analysis_trace</span> <span class="o">=</span> <span class="n">trace</span>
</span><a id="src/oscura/workflows/waveform.py-223" name="src/oscura/workflows/waveform.py-223"></a><span class="hll">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">DigitalTrace</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-224" name="src/oscura/workflows/waveform.py-224"></a>                <span class="c1"># Convert bool array to float for analysis</span>
<a id="src/oscura/workflows/waveform.py-225" name="src/oscura/workflows/waveform.py-225"></a><span class="hll">                <span class="n">waveform_data</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-226" name="src/oscura/workflows/waveform.py-226"></a><span class="hll">                <span class="n">analysis_trace</span> <span class="o">=</span> <span class="n">WaveformTrace</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">waveform_data</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">trace</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-227" name="src/oscura/workflows/waveform.py-227"></a>
<a id="src/oscura/workflows/waveform.py-228" name="src/oscura/workflows/waveform.py-228"></a><span class="hll">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">analysis_trace</span><span class="p">,</span> <span class="n">WaveformTrace</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-229" name="src/oscura/workflows/waveform.py-229"></a>                <span class="c1"># Get signal quality summary</span>
<a id="src/oscura/workflows/waveform.py-230" name="src/oscura/workflows/waveform.py-230"></a><span class="hll">                <span class="n">digital_results_obj</span> <span class="o">=</span> <span class="n">signal_quality_summary</span><span class="p">(</span><span class="n">analysis_trace</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-231" name="src/oscura/workflows/waveform.py-231"></a>                <span class="n">digital_results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<a id="src/oscura/workflows/waveform.py-232" name="src/oscura/workflows/waveform.py-232"></a><span class="hll">                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">digital_results_obj</span><span class="p">,</span> <span class="s2">&quot;__dict__&quot;</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-233" name="src/oscura/workflows/waveform.py-233"></a><span class="hll">                    <span class="n">digital_results</span> <span class="o">=</span> <span class="n">digital_results_obj</span><span class="o">.</span><span class="vm">__dict__</span>
</span><a id="src/oscura/workflows/waveform.py-234" name="src/oscura/workflows/waveform.py-234"></a>                <span class="k">else</span><span class="p">:</span>
<a id="src/oscura/workflows/waveform.py-235" name="src/oscura/workflows/waveform.py-235"></a><span class="hll">                    <span class="n">digital_results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">digital_results_obj</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-236" name="src/oscura/workflows/waveform.py-236"></a>
<a id="src/oscura/workflows/waveform.py-237" name="src/oscura/workflows/waveform.py-237"></a>                <span class="c1"># Add timing measurements</span>
<a id="src/oscura/workflows/waveform.py-238" name="src/oscura/workflows/waveform.py-238"></a><span class="hll">                <span class="k">try</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-239" name="src/oscura/workflows/waveform.py-239"></a>                    <span class="c1"># Slew rate for rising and falling edges</span>
<a id="src/oscura/workflows/waveform.py-240" name="src/oscura/workflows/waveform.py-240"></a><span class="hll">                    <span class="n">slew_rising</span> <span class="o">=</span> <span class="n">timing</span><span class="o">.</span><span class="n">slew_rate</span><span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-241" name="src/oscura/workflows/waveform.py-241"></a>                        <span class="n">analysis_trace</span><span class="p">,</span> <span class="n">edge_type</span><span class="o">=</span><span class="s2">&quot;rising&quot;</span><span class="p">,</span> <span class="n">return_all</span><span class="o">=</span><span class="kc">False</span>
<a id="src/oscura/workflows/waveform.py-242" name="src/oscura/workflows/waveform.py-242"></a>                    <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-243" name="src/oscura/workflows/waveform.py-243"></a><span class="hll">                    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">slew_rising</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-244" name="src/oscura/workflows/waveform.py-244"></a><span class="hll">                        <span class="n">digital_results</span><span class="p">[</span><span class="s2">&quot;slew_rate_rising&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slew_rising</span>
</span><a id="src/oscura/workflows/waveform.py-245" name="src/oscura/workflows/waveform.py-245"></a>
<a id="src/oscura/workflows/waveform.py-246" name="src/oscura/workflows/waveform.py-246"></a><span class="hll">                    <span class="n">slew_falling</span> <span class="o">=</span> <span class="n">timing</span><span class="o">.</span><span class="n">slew_rate</span><span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-247" name="src/oscura/workflows/waveform.py-247"></a>                        <span class="n">analysis_trace</span><span class="p">,</span> <span class="n">edge_type</span><span class="o">=</span><span class="s2">&quot;falling&quot;</span><span class="p">,</span> <span class="n">return_all</span><span class="o">=</span><span class="kc">False</span>
<a id="src/oscura/workflows/waveform.py-248" name="src/oscura/workflows/waveform.py-248"></a>                    <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-249" name="src/oscura/workflows/waveform.py-249"></a><span class="hll">                    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">slew_falling</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-250" name="src/oscura/workflows/waveform.py-250"></a><span class="hll">                        <span class="n">digital_results</span><span class="p">[</span><span class="s2">&quot;slew_rate_falling&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slew_falling</span>
</span><a id="src/oscura/workflows/waveform.py-251" name="src/oscura/workflows/waveform.py-251"></a><span class="hll">                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-252" name="src/oscura/workflows/waveform.py-252"></a><span class="hll">                    <span class="k">pass</span>  <span class="c1"># Skip if slew rate not applicable</span>
</span><a id="src/oscura/workflows/waveform.py-253" name="src/oscura/workflows/waveform.py-253"></a>
<a id="src/oscura/workflows/waveform.py-254" name="src/oscura/workflows/waveform.py-254"></a><span class="hll">                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;digital&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">digital_results</span>
</span><a id="src/oscura/workflows/waveform.py-255" name="src/oscura/workflows/waveform.py-255"></a><span class="hll">                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-256" name="src/oscura/workflows/waveform.py-256"></a><span class="hll">                    <span class="n">numeric_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-257" name="src/oscura/workflows/waveform.py-257"></a>                        <span class="mi">1</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">digital_results</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
<a id="src/oscura/workflows/waveform.py-258" name="src/oscura/workflows/waveform.py-258"></a>                    <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-259" name="src/oscura/workflows/waveform.py-259"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Completed </span><span class="si">{</span><span class="n">numeric_count</span><span class="si">}</span><span class="s2"> measurements&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-260" name="src/oscura/workflows/waveform.py-260"></a><span class="hll">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-261" name="src/oscura/workflows/waveform.py-261"></a><span class="hll">            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-262" name="src/oscura/workflows/waveform.py-262"></a><span class="hll">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Digital analysis unavailable: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-263" name="src/oscura/workflows/waveform.py-263"></a>
<a id="src/oscura/workflows/waveform.py-264" name="src/oscura/workflows/waveform.py-264"></a><span class="hll">    <span class="k">if</span> <span class="s2">&quot;statistics&quot;</span> <span class="ow">in</span> <span class="n">requested_analyses</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_digital</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-265" name="src/oscura/workflows/waveform.py-265"></a><span class="hll">        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-266" name="src/oscura/workflows/waveform.py-266"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-267" name="src/oscura/workflows/waveform.py-267"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STATISTICAL ANALYSIS&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-268" name="src/oscura/workflows/waveform.py-268"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-269" name="src/oscura/workflows/waveform.py-269"></a>
<a id="src/oscura/workflows/waveform.py-270" name="src/oscura/workflows/waveform.py-270"></a><span class="hll">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">WaveformTrace</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-271" name="src/oscura/workflows/waveform.py-271"></a>            <span class="c1"># Run statistical analysis using unified measure() API</span>
<a id="src/oscura/workflows/waveform.py-272" name="src/oscura/workflows/waveform.py-272"></a><span class="hll">            <span class="kn">from</span><span class="w"> </span><span class="nn">oscura.analyzers</span><span class="w"> </span><span class="kn">import</span> <span class="n">statistics</span>
</span><a id="src/oscura/workflows/waveform.py-273" name="src/oscura/workflows/waveform.py-273"></a>
<a id="src/oscura/workflows/waveform.py-274" name="src/oscura/workflows/waveform.py-274"></a><span class="hll">            <span class="n">stats_results</span> <span class="o">=</span> <span class="n">statistics</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">include_units</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-275" name="src/oscura/workflows/waveform.py-275"></a><span class="hll">            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;statistics&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats_results</span>
</span><a id="src/oscura/workflows/waveform.py-276" name="src/oscura/workflows/waveform.py-276"></a><span class="hll">            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-277" name="src/oscura/workflows/waveform.py-277"></a><span class="hll">                <span class="n">numeric_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stats_results</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-278" name="src/oscura/workflows/waveform.py-278"></a><span class="hll">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Completed </span><span class="si">{</span><span class="n">numeric_count</span><span class="si">}</span><span class="s2"> measurements&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-279" name="src/oscura/workflows/waveform.py-279"></a>
<a id="src/oscura/workflows/waveform.py-280" name="src/oscura/workflows/waveform.py-280"></a>    <span class="c1"># Step 3: Protocol Detection &amp; Decoding (FULL IMPLEMENTATION)</span>
<a id="src/oscura/workflows/waveform.py-281" name="src/oscura/workflows/waveform.py-281"></a><span class="hll">    <span class="n">protocols_detected</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/oscura/workflows/waveform.py-282" name="src/oscura/workflows/waveform.py-282"></a><span class="hll">    <span class="n">decoded_frames</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/oscura/workflows/waveform.py-283" name="src/oscura/workflows/waveform.py-283"></a>
<a id="src/oscura/workflows/waveform.py-284" name="src/oscura/workflows/waveform.py-284"></a><span class="hll">    <span class="k">if</span> <span class="n">enable_protocol_decode</span> <span class="ow">and</span> <span class="n">is_digital</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-285" name="src/oscura/workflows/waveform.py-285"></a><span class="hll">        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-286" name="src/oscura/workflows/waveform.py-286"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-287" name="src/oscura/workflows/waveform.py-287"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PROTOCOL DETECTION &amp; DECODING&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-288" name="src/oscura/workflows/waveform.py-288"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-289" name="src/oscura/workflows/waveform.py-289"></a>
<a id="src/oscura/workflows/waveform.py-290" name="src/oscura/workflows/waveform.py-290"></a><span class="hll">        <span class="k">try</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-291" name="src/oscura/workflows/waveform.py-291"></a><span class="hll">            <span class="kn">from</span><span class="w"> </span><span class="nn">oscura.discovery</span><span class="w"> </span><span class="kn">import</span> <span class="n">auto_decoder</span>
</span><a id="src/oscura/workflows/waveform.py-292" name="src/oscura/workflows/waveform.py-292"></a>
<a id="src/oscura/workflows/waveform.py-293" name="src/oscura/workflows/waveform.py-293"></a>            <span class="c1"># Try each protocol hint or auto-detect</span>
<a id="src/oscura/workflows/waveform.py-294" name="src/oscura/workflows/waveform.py-294"></a><span class="hll">            <span class="n">protocols_to_try</span> <span class="o">=</span> <span class="n">protocol_hints</span> <span class="k">if</span> <span class="n">protocol_hints</span> <span class="k">else</span> <span class="p">[</span><span class="s2">&quot;UART&quot;</span><span class="p">,</span> <span class="s2">&quot;SPI&quot;</span><span class="p">,</span> <span class="s2">&quot;I2C&quot;</span><span class="p">]</span>
</span><a id="src/oscura/workflows/waveform.py-295" name="src/oscura/workflows/waveform.py-295"></a>
<a id="src/oscura/workflows/waveform.py-296" name="src/oscura/workflows/waveform.py-296"></a><span class="hll">            <span class="k">for</span> <span class="n">proto_name</span> <span class="ow">in</span> <span class="n">protocols_to_try</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-297" name="src/oscura/workflows/waveform.py-297"></a><span class="hll">                <span class="k">try</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-298" name="src/oscura/workflows/waveform.py-298"></a>                    <span class="c1"># Type narrow to WaveformTrace | DigitalTrace</span>
<a id="src/oscura/workflows/waveform.py-299" name="src/oscura/workflows/waveform.py-299"></a><span class="hll">                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="p">(</span><span class="n">WaveformTrace</span><span class="p">,</span> <span class="n">DigitalTrace</span><span class="p">)):</span>
</span><a id="src/oscura/workflows/waveform.py-300" name="src/oscura/workflows/waveform.py-300"></a><span class="hll">                        <span class="k">continue</span>
</span><a id="src/oscura/workflows/waveform.py-301" name="src/oscura/workflows/waveform.py-301"></a>
<a id="src/oscura/workflows/waveform.py-302" name="src/oscura/workflows/waveform.py-302"></a><span class="hll">                    <span class="n">result</span> <span class="o">=</span> <span class="n">auto_decoder</span><span class="o">.</span><span class="n">decode_protocol</span><span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-303" name="src/oscura/workflows/waveform.py-303"></a>                        <span class="n">trace</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-304" name="src/oscura/workflows/waveform.py-304"></a>                        <span class="n">protocol_hint</span><span class="o">=</span><span class="n">proto_name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>  <span class="c1"># type: ignore[arg-type]</span>
<a id="src/oscura/workflows/waveform.py-305" name="src/oscura/workflows/waveform.py-305"></a>                        <span class="n">confidence_threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>  <span class="c1"># Lower threshold to catch more</span>
<a id="src/oscura/workflows/waveform.py-306" name="src/oscura/workflows/waveform.py-306"></a>                    <span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-304" name="src/oscura/workflows/waveform.py-304"></a>                        <span class="n">protocol_hint</span><span class="o">=</span><span class="n">proto_name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>  <span class="c1"># type: ignore[arg-type]</span>
<a id="src/oscura/workflows/waveform.py-305" name="src/oscura/workflows/waveform.py-305"></a>                        <span class="n">confidence_threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>  <span class="c1"># Lower threshold to catch more</span>
<a id="src/oscura/workflows/waveform.py-306" name="src/oscura/workflows/waveform.py-306"></a>                    <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-307" name="src/oscura/workflows/waveform.py-307"></a>
<a id="src/oscura/workflows/waveform.py-308" name="src/oscura/workflows/waveform.py-308"></a><span class="hll">                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">overall_confidence</span> <span class="o">&gt;=</span> <span class="mf">0.6</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-309" name="src/oscura/workflows/waveform.py-309"></a><span class="hll">                        <span class="n">proto_info</span> <span class="o">=</span> <span class="p">{</span>
</span><a id="src/oscura/workflows/waveform.py-310" name="src/oscura/workflows/waveform.py-310"></a>                            <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-311" name="src/oscura/workflows/waveform.py-311"></a>                            <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">overall_confidence</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-312" name="src/oscura/workflows/waveform.py-312"></a>                            <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">detected_params</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-313" name="src/oscura/workflows/waveform.py-313"></a>                            <span class="s2">&quot;frame_count&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">frame_count</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-312" name="src/oscura/workflows/waveform.py-312"></a>                            <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">detected_params</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-313" name="src/oscura/workflows/waveform.py-313"></a>                            <span class="s2">&quot;frame_count&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">frame_count</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-314" name="src/oscura/workflows/waveform.py-314"></a>                            <span class="s2">&quot;error_count&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">error_count</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-315" name="src/oscura/workflows/waveform.py-315"></a>                        <span class="p">}</span>
<a id="src/oscura/workflows/waveform.py-316" name="src/oscura/workflows/waveform.py-316"></a><span class="hll">                        <span class="n">protocols_detected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proto_info</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-317" name="src/oscura/workflows/waveform.py-317"></a><span class="hll">                        <span class="n">decoded_frames</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-318" name="src/oscura/workflows/waveform.py-318"></a>
<a id="src/oscura/workflows/waveform.py-319" name="src/oscura/workflows/waveform.py-319"></a><span class="hll">                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-320" name="src/oscura/workflows/waveform.py-320"></a><span class="hll">                            <span class="nb">print</span><span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-321" name="src/oscura/workflows/waveform.py-321"></a>                                <span class="sa">f</span><span class="s2">&quot; Detected </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">: &quot;</span>
<a id="src/oscura/workflows/waveform.py-322" name="src/oscura/workflows/waveform.py-322"></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">overall_confidence</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2"> confidence&quot;</span>
<a id="src/oscura/workflows/waveform.py-323" name="src/oscura/workflows/waveform.py-323"></a>                            <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-324" name="src/oscura/workflows/waveform.py-324"></a><span class="hll">                            <span class="nb">print</span><span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-325" name="src/oscura/workflows/waveform.py-325"></a>                                <span class="sa">f</span><span class="s2">&quot;  Decoded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2"> bytes, </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">frame_count</span><span class="si">}</span><span class="s2"> frames&quot;</span>
<a id="src/oscura/workflows/waveform.py-326" name="src/oscura/workflows/waveform.py-326"></a>                            <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-327" name="src/oscura/workflows/waveform.py-327"></a><span class="hll">                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-328" name="src/oscura/workflows/waveform.py-328"></a>                    <span class="c1"># Protocol didn&#39;t match, continue trying others</span>
<a id="src/oscura/workflows/waveform.py-329" name="src/oscura/workflows/waveform.py-329"></a><span class="hll">                    <span class="k">pass</span>
</span><a id="src/oscura/workflows/waveform.py-330" name="src/oscura/workflows/waveform.py-330"></a>
<a id="src/oscura/workflows/waveform.py-331" name="src/oscura/workflows/waveform.py-331"></a><span class="hll">            <span class="k">if</span> <span class="ow">not</span> <span class="n">protocols_detected</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-332" name="src/oscura/workflows/waveform.py-332"></a><span class="hll">                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   No protocols detected (signal may be unknown or noisy)&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-333" name="src/oscura/workflows/waveform.py-333"></a>
<a id="src/oscura/workflows/waveform.py-334" name="src/oscura/workflows/waveform.py-334"></a><span class="hll">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-335" name="src/oscura/workflows/waveform.py-335"></a><span class="hll">            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-336" name="src/oscura/workflows/waveform.py-336"></a><span class="hll">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Protocol detection unavailable: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-337" name="src/oscura/workflows/waveform.py-337"></a>
<a id="src/oscura/workflows/waveform.py-338" name="src/oscura/workflows/waveform.py-338"></a>    <span class="c1"># Step 4: Reverse Engineering Pipeline (FULL IMPLEMENTATION)</span>
<a id="src/oscura/workflows/waveform.py-339" name="src/oscura/workflows/waveform.py-339"></a><span class="hll">    <span class="n">reverse_engineering_results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/oscura/workflows/waveform.py-340" name="src/oscura/workflows/waveform.py-340"></a>
<a id="src/oscura/workflows/waveform.py-341" name="src/oscura/workflows/waveform.py-341"></a><span class="hll">    <span class="k">if</span> <span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-342" name="src/oscura/workflows/waveform.py-342"></a>        <span class="n">enable_reverse_engineering</span>
<a id="src/oscura/workflows/waveform.py-343" name="src/oscura/workflows/waveform.py-343"></a>        <span class="ow">and</span> <span class="n">is_digital</span>
<a id="src/oscura/workflows/waveform.py-344" name="src/oscura/workflows/waveform.py-344"></a>        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="p">(</span><span class="n">WaveformTrace</span><span class="p">,</span> <span class="n">DigitalTrace</span><span class="p">))</span>
<a id="src/oscura/workflows/waveform.py-345" name="src/oscura/workflows/waveform.py-345"></a>        <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-343" name="src/oscura/workflows/waveform.py-343"></a>        <span class="ow">and</span> <span class="n">is_digital</span>
<a id="src/oscura/workflows/waveform.py-344" name="src/oscura/workflows/waveform.py-344"></a>        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="p">(</span><span class="n">WaveformTrace</span><span class="p">,</span> <span class="n">DigitalTrace</span><span class="p">))</span>
<a id="src/oscura/workflows/waveform.py-345" name="src/oscura/workflows/waveform.py-345"></a>        <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span>
<a id="src/oscura/workflows/waveform.py-346" name="src/oscura/workflows/waveform.py-346"></a>    <span class="p">):</span>
<a id="src/oscura/workflows/waveform.py-347" name="src/oscura/workflows/waveform.py-347"></a><span class="hll">        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-348" name="src/oscura/workflows/waveform.py-348"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-349" name="src/oscura/workflows/waveform.py-349"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;REVERSE ENGINEERING ANALYSIS&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-350" name="src/oscura/workflows/waveform.py-350"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-351" name="src/oscura/workflows/waveform.py-351"></a><span class="hll">            <span class="n">depth_map</span> <span class="o">=</span> <span class="p">{</span>
</span><a id="src/oscura/workflows/waveform.py-352" name="src/oscura/workflows/waveform.py-352"></a>                <span class="s2">&quot;quick&quot;</span><span class="p">:</span> <span class="s2">&quot;Quick (basic)&quot;</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-353" name="src/oscura/workflows/waveform.py-353"></a>                <span class="s2">&quot;standard&quot;</span><span class="p">:</span> <span class="s2">&quot;Standard (comprehensive)&quot;</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-354" name="src/oscura/workflows/waveform.py-354"></a>                <span class="s2">&quot;deep&quot;</span><span class="p">:</span> <span class="s2">&quot;Deep (exhaustive)&quot;</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-355" name="src/oscura/workflows/waveform.py-355"></a>            <span class="p">}</span>
<a id="src/oscura/workflows/waveform.py-356" name="src/oscura/workflows/waveform.py-356"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Mode: </span><span class="si">{</span><span class="n">depth_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse_engineering_depth</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Standard&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-357" name="src/oscura/workflows/waveform.py-357"></a>
<a id="src/oscura/workflows/waveform.py-358" name="src/oscura/workflows/waveform.py-358"></a><span class="hll">        <span class="k">try</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-359" name="src/oscura/workflows/waveform.py-359"></a><span class="hll">            <span class="kn">from</span><span class="w"> </span><span class="nn">oscura.workflows</span><span class="w"> </span><span class="kn">import</span> <span class="n">reverse_engineering</span> <span class="k">as</span> <span class="n">re_workflow</span>
</span><a id="src/oscura/workflows/waveform.py-360" name="src/oscura/workflows/waveform.py-360"></a>
<a id="src/oscura/workflows/waveform.py-361" name="src/oscura/workflows/waveform.py-361"></a>            <span class="c1"># Convert DigitalTrace to WaveformTrace for RE</span>
<a id="src/oscura/workflows/waveform.py-362" name="src/oscura/workflows/waveform.py-362"></a><span class="hll">            <span class="n">re_trace</span> <span class="o">=</span> <span class="n">trace</span>
</span><a id="src/oscura/workflows/waveform.py-363" name="src/oscura/workflows/waveform.py-363"></a><span class="hll">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">DigitalTrace</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-364" name="src/oscura/workflows/waveform.py-364"></a><span class="hll">                <span class="n">waveform_data</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-365" name="src/oscura/workflows/waveform.py-365"></a><span class="hll">                <span class="n">re_trace</span> <span class="o">=</span> <span class="n">WaveformTrace</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">waveform_data</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">trace</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-366" name="src/oscura/workflows/waveform.py-366"></a>
<a id="src/oscura/workflows/waveform.py-367" name="src/oscura/workflows/waveform.py-367"></a><span class="hll">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">re_trace</span><span class="p">,</span> <span class="n">WaveformTrace</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-368" name="src/oscura/workflows/waveform.py-368"></a>                <span class="c1"># Set parameters based on depth</span>
<a id="src/oscura/workflows/waveform.py-369" name="src/oscura/workflows/waveform.py-369"></a><span class="hll">                <span class="k">if</span> <span class="n">reverse_engineering_depth</span> <span class="o">==</span> <span class="s2">&quot;quick&quot;</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-370" name="src/oscura/workflows/waveform.py-370"></a><span class="hll">                    <span class="n">baud_rates</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9600</span><span class="p">,</span> <span class="mi">115200</span><span class="p">]</span>
</span><a id="src/oscura/workflows/waveform.py-371" name="src/oscura/workflows/waveform.py-371"></a><span class="hll">                    <span class="n">min_frames</span> <span class="o">=</span> <span class="mi">2</span>
</span><a id="src/oscura/workflows/waveform.py-372" name="src/oscura/workflows/waveform.py-372"></a><span class="hll">                <span class="k">elif</span> <span class="n">reverse_engineering_depth</span> <span class="o">==</span> <span class="s2">&quot;deep&quot;</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-373" name="src/oscura/workflows/waveform.py-373"></a><span class="hll">                    <span class="n">baud_rates</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9600</span><span class="p">,</span> <span class="mi">19200</span><span class="p">,</span> <span class="mi">38400</span><span class="p">,</span> <span class="mi">57600</span><span class="p">,</span> <span class="mi">115200</span><span class="p">,</span> <span class="mi">230400</span><span class="p">,</span> <span class="mi">460800</span><span class="p">,</span> <span class="mi">921600</span><span class="p">]</span>
</span><a id="src/oscura/workflows/waveform.py-374" name="src/oscura/workflows/waveform.py-374"></a><span class="hll">                    <span class="n">min_frames</span> <span class="o">=</span> <span class="mi">5</span>
</span><a id="src/oscura/workflows/waveform.py-375" name="src/oscura/workflows/waveform.py-375"></a>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># standard</span>
<a id="src/oscura/workflows/waveform.py-376" name="src/oscura/workflows/waveform.py-376"></a><span class="hll">                    <span class="n">baud_rates</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9600</span><span class="p">,</span> <span class="mi">19200</span><span class="p">,</span> <span class="mi">38400</span><span class="p">,</span> <span class="mi">57600</span><span class="p">,</span> <span class="mi">115200</span><span class="p">,</span> <span class="mi">230400</span><span class="p">]</span>
</span><a id="src/oscura/workflows/waveform.py-377" name="src/oscura/workflows/waveform.py-377"></a><span class="hll">                    <span class="n">min_frames</span> <span class="o">=</span> <span class="mi">3</span>
</span><a id="src/oscura/workflows/waveform.py-378" name="src/oscura/workflows/waveform.py-378"></a>
<a id="src/oscura/workflows/waveform.py-379" name="src/oscura/workflows/waveform.py-379"></a><span class="hll">                <span class="n">re_result</span> <span class="o">=</span> <span class="n">re_workflow</span><span class="o">.</span><span class="n">reverse_engineer_signal</span><span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-380" name="src/oscura/workflows/waveform.py-380"></a>                    <span class="n">re_trace</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-381" name="src/oscura/workflows/waveform.py-381"></a>                    <span class="n">expected_baud_rates</span><span class="o">=</span><span class="n">baud_rates</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-382" name="src/oscura/workflows/waveform.py-382"></a>                    <span class="n">min_frames</span><span class="o">=</span><span class="n">min_frames</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-383" name="src/oscura/workflows/waveform.py-383"></a>                    <span class="n">max_frame_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-383" name="src/oscura/workflows/waveform.py-383"></a>                    <span class="n">max_frame_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-384" name="src/oscura/workflows/waveform.py-384"></a>                <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-385" name="src/oscura/workflows/waveform.py-385"></a>
<a id="src/oscura/workflows/waveform.py-386" name="src/oscura/workflows/waveform.py-386"></a>                <span class="c1"># Extract key findings</span>
<a id="src/oscura/workflows/waveform.py-387" name="src/oscura/workflows/waveform.py-387"></a><span class="hll">                <span class="n">reverse_engineering_results</span> <span class="o">=</span> <span class="p">{</span>
</span><a id="src/oscura/workflows/waveform.py-388" name="src/oscura/workflows/waveform.py-388"></a>                    <span class="s2">&quot;baud_rate&quot;</span><span class="p">:</span> <span class="n">re_result</span><span class="o">.</span><span class="n">baud_rate</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-389" name="src/oscura/workflows/waveform.py-389"></a>                    <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="n">re_result</span><span class="o">.</span><span class="n">confidence</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-390" name="src/oscura/workflows/waveform.py-390"></a>                    <span class="s2">&quot;frame_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">re_result</span><span class="o">.</span><span class="n">frames</span><span class="p">),</span>
<a id="src/oscura/workflows/waveform.py-391" name="src/oscura/workflows/waveform.py-391"></a>                    <span class="s2">&quot;frame_format&quot;</span><span class="p">:</span> <span class="n">re_result</span><span class="o">.</span><span class="n">protocol_spec</span><span class="o">.</span><span class="n">frame_format</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-396" name="src/oscura/workflows/waveform.py-396"></a>                    <span class="s2">&quot;checksum_position&quot;</span><span class="p">:</span> <span class="n">re_result</span><span class="o">.</span><span class="n">protocol_spec</span><span class="o">.</span><span class="n">checksum_position</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-397" name="src/oscura/workflows/waveform.py-397"></a>                    <span class="s2">&quot;warnings&quot;</span><span class="p">:</span> <span class="n">re_result</span><span class="o">.</span><span class="n">warnings</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-398" name="src/oscura/workflows/waveform.py-398"></a>                <span class="p">}</span>
<a id="src/oscura/workflows/waveform.py-399" name="src/oscura/workflows/waveform.py-399"></a>
<a id="src/oscura/workflows/waveform.py-400" name="src/oscura/workflows/waveform.py-400"></a><span class="hll">                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-401" name="src/oscura/workflows/waveform.py-401"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-402" name="src/oscura/workflows/waveform.py-402"></a>                        <span class="sa">f</span><span class="s2">&quot; Baud rate: </span><span class="si">{</span><span class="n">re_result</span><span class="o">.</span><span class="n">baud_rate</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> Hz (confidence: </span><span class="si">{</span><span class="n">re_result</span><span class="o">.</span><span class="n">confidence</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="src/oscura/workflows/waveform.py-403" name="src/oscura/workflows/waveform.py-403"></a>                    <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-404" name="src/oscura/workflows/waveform.py-404"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Frames: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">re_result</span><span class="o">.</span><span class="n">frames</span><span class="p">)</span><span class="si">}</span><span class="s2"> detected&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-405" name="src/oscura/workflows/waveform.py-405"></a><span class="hll">                    <span class="k">if</span> <span class="n">re_result</span><span class="o">.</span><span class="n">protocol_spec</span><span class="o">.</span><span class="n">sync_pattern</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-406" name="src/oscura/workflows/waveform.py-406"></a><span class="hll">                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Sync pattern: </span><span class="si">{</span><span class="n">re_result</span><span class="o">.</span><span class="n">protocol_spec</span><span class="o">.</span><span class="n">sync_pattern</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-407" name="src/oscura/workflows/waveform.py-407"></a><span class="hll">                    <span class="k">if</span> <span class="n">re_result</span><span class="o">.</span><span class="n">protocol_spec</span><span class="o">.</span><span class="n">frame_length</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-408" name="src/oscura/workflows/waveform.py-408"></a><span class="hll">                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Frame length: </span><span class="si">{</span><span class="n">re_result</span><span class="o">.</span><span class="n">protocol_spec</span><span class="o">.</span><span class="n">frame_length</span><span class="si">}</span><span class="s2"> bytes&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-409" name="src/oscura/workflows/waveform.py-409"></a><span class="hll">                    <span class="k">if</span> <span class="n">re_result</span><span class="o">.</span><span class="n">protocol_spec</span><span class="o">.</span><span class="n">checksum_type</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-410" name="src/oscura/workflows/waveform.py-410"></a><span class="hll">                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Checksum: </span><span class="si">{</span><span class="n">re_result</span><span class="o">.</span><span class="n">protocol_spec</span><span class="o">.</span><span class="n">checksum_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-411" name="src/oscura/workflows/waveform.py-411"></a><span class="hll">                    <span class="k">if</span> <span class="n">re_result</span><span class="o">.</span><span class="n">warnings</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-412" name="src/oscura/workflows/waveform.py-412"></a><span class="hll">                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Warnings: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">re_result</span><span class="o">.</span><span class="n">warnings</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-413" name="src/oscura/workflows/waveform.py-413"></a>
<a id="src/oscura/workflows/waveform.py-414" name="src/oscura/workflows/waveform.py-414"></a><span class="hll">        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-415" name="src/oscura/workflows/waveform.py-415"></a><span class="hll">            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-416" name="src/oscura/workflows/waveform.py-416"></a><span class="hll">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   RE analysis: </span><span class="si">{</span><span class="n">e</span><span class="si">!s}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-417" name="src/oscura/workflows/waveform.py-417"></a><span class="hll">            <span class="n">reverse_engineering_results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;insufficient_data&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>
</span><a id="src/oscura/workflows/waveform.py-418" name="src/oscura/workflows/waveform.py-418"></a><span class="hll">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-419" name="src/oscura/workflows/waveform.py-419"></a><span class="hll">            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-420" name="src/oscura/workflows/waveform.py-420"></a><span class="hll">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   RE analysis unavailable: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-421" name="src/oscura/workflows/waveform.py-421"></a><span class="hll">            <span class="n">reverse_engineering_results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>
</span><a id="src/oscura/workflows/waveform.py-422" name="src/oscura/workflows/waveform.py-422"></a>
<a id="src/oscura/workflows/waveform.py-423" name="src/oscura/workflows/waveform.py-423"></a>    <span class="c1"># Step 5: Pattern Recognition &amp; Anomaly Detection (FULL IMPLEMENTATION)</span>
<a id="src/oscura/workflows/waveform.py-424" name="src/oscura/workflows/waveform.py-424"></a><span class="hll">    <span class="n">pattern_results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/oscura/workflows/waveform.py-425" name="src/oscura/workflows/waveform.py-425"></a><span class="hll">    <span class="n">anomalies_detected</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><a id="src/oscura/workflows/waveform.py-426" name="src/oscura/workflows/waveform.py-426"></a>
<a id="src/oscura/workflows/waveform.py-427" name="src/oscura/workflows/waveform.py-427"></a><span class="hll">    <span class="k">if</span> <span class="n">enable_pattern_recognition</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-428" name="src/oscura/workflows/waveform.py-428"></a><span class="hll">        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-429" name="src/oscura/workflows/waveform.py-429"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-430" name="src/oscura/workflows/waveform.py-430"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PATTERN RECOGNITION &amp; ANOMALY DETECTION&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-431" name="src/oscura/workflows/waveform.py-431"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-432" name="src/oscura/workflows/waveform.py-432"></a>
<a id="src/oscura/workflows/waveform.py-433" name="src/oscura/workflows/waveform.py-433"></a><span class="hll">        <span class="n">pattern_results</span> <span class="o">=</span> <span class="p">{}</span>
</span><a id="src/oscura/workflows/waveform.py-434" name="src/oscura/workflows/waveform.py-434"></a>
<a id="src/oscura/workflows/waveform.py-435" name="src/oscura/workflows/waveform.py-435"></a>        <span class="c1"># Anomaly detection</span>
<a id="src/oscura/workflows/waveform.py-436" name="src/oscura/workflows/waveform.py-436"></a><span class="hll">        <span class="k">try</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-437" name="src/oscura/workflows/waveform.py-437"></a><span class="hll">            <span class="kn">from</span><span class="w"> </span><span class="nn">oscura.discovery</span><span class="w"> </span><span class="kn">import</span> <span class="n">anomaly_detector</span>
</span><a id="src/oscura/workflows/waveform.py-438" name="src/oscura/workflows/waveform.py-438"></a>
<a id="src/oscura/workflows/waveform.py-439" name="src/oscura/workflows/waveform.py-439"></a>            <span class="c1"># Convert DigitalTrace to WaveformTrace for anomaly detection</span>
<a id="src/oscura/workflows/waveform.py-440" name="src/oscura/workflows/waveform.py-440"></a><span class="hll">            <span class="n">anomaly_trace</span> <span class="o">=</span> <span class="n">trace</span>
</span><a id="src/oscura/workflows/waveform.py-441" name="src/oscura/workflows/waveform.py-441"></a><span class="hll">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">DigitalTrace</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-442" name="src/oscura/workflows/waveform.py-442"></a><span class="hll">                <span class="n">waveform_data</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-443" name="src/oscura/workflows/waveform.py-443"></a><span class="hll">                <span class="n">anomaly_trace</span> <span class="o">=</span> <span class="n">WaveformTrace</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">waveform_data</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">trace</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-444" name="src/oscura/workflows/waveform.py-444"></a>
<a id="src/oscura/workflows/waveform.py-445" name="src/oscura/workflows/waveform.py-445"></a><span class="hll">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">anomaly_trace</span><span class="p">,</span> <span class="n">WaveformTrace</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-446" name="src/oscura/workflows/waveform.py-446"></a><span class="hll">                <span class="n">anomalies</span> <span class="o">=</span> <span class="n">anomaly_detector</span><span class="o">.</span><span class="n">find_anomalies</span><span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-447" name="src/oscura/workflows/waveform.py-447"></a>                    <span class="n">anomaly_trace</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-448" name="src/oscura/workflows/waveform.py-448"></a>                    <span class="n">min_confidence</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-449" name="src/oscura/workflows/waveform.py-449"></a>                <span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-448" name="src/oscura/workflows/waveform.py-448"></a>                    <span class="n">min_confidence</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-449" name="src/oscura/workflows/waveform.py-449"></a>                <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-450" name="src/oscura/workflows/waveform.py-450"></a>
<a id="src/oscura/workflows/waveform.py-451" name="src/oscura/workflows/waveform.py-451"></a>                <span class="c1"># Convert to list of dicts</span>
<a id="src/oscura/workflows/waveform.py-452" name="src/oscura/workflows/waveform.py-452"></a><span class="hll">                <span class="n">anomalies_detected</span> <span class="o">=</span> <span class="p">[</span>
</span><a id="src/oscura/workflows/waveform.py-453" name="src/oscura/workflows/waveform.py-453"></a>                    <span class="p">{</span>
<a id="src/oscura/workflows/waveform.py-454" name="src/oscura/workflows/waveform.py-454"></a>                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-455" name="src/oscura/workflows/waveform.py-455"></a>                        <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">timestamp_us</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span>  <span class="c1"># Convert to seconds</span>
<a id="src/oscura/workflows/waveform.py-456" name="src/oscura/workflows/waveform.py-456"></a>                        <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">timestamp_us</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">duration_ns</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-458" name="src/oscura/workflows/waveform.py-458"></a>                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-459" name="src/oscura/workflows/waveform.py-459"></a>                    <span class="p">}</span>
<a id="src/oscura/workflows/waveform.py-460" name="src/oscura/workflows/waveform.py-460"></a>                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">anomalies</span>
<a id="src/oscura/workflows/waveform.py-461" name="src/oscura/workflows/waveform.py-461"></a>                <span class="p">]</span>
<a id="src/oscura/workflows/waveform.py-462" name="src/oscura/workflows/waveform.py-462"></a><span class="hll">                <span class="n">pattern_results</span><span class="p">[</span><span class="s2">&quot;anomalies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">anomalies_detected</span>
</span><a id="src/oscura/workflows/waveform.py-463" name="src/oscura/workflows/waveform.py-463"></a>
<a id="src/oscura/workflows/waveform.py-464" name="src/oscura/workflows/waveform.py-464"></a><span class="hll">                <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">anomalies_detected</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-465" name="src/oscura/workflows/waveform.py-465"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Detected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">anomalies_detected</span><span class="p">)</span><span class="si">}</span><span class="s2"> anomalies&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-466" name="src/oscura/workflows/waveform.py-466"></a><span class="hll">                    <span class="n">severity_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><a id="src/oscura/workflows/waveform.py-467" name="src/oscura/workflows/waveform.py-467"></a><span class="hll">                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">anomalies_detected</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-468" name="src/oscura/workflows/waveform.py-468"></a><span class="hll">                        <span class="n">severity_counts</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;severity&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">severity_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;severity&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><a id="src/oscura/workflows/waveform.py-469" name="src/oscura/workflows/waveform.py-469"></a><span class="hll">                    <span class="k">for</span> <span class="n">sev</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">severity_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><a id="src/oscura/workflows/waveform.py-470" name="src/oscura/workflows/waveform.py-470"></a><span class="hll">                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">sev</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-471" name="src/oscura/workflows/waveform.py-471"></a><span class="hll">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-472" name="src/oscura/workflows/waveform.py-472"></a><span class="hll">            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-473" name="src/oscura/workflows/waveform.py-473"></a><span class="hll">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Anomaly detection unavailable: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-474" name="src/oscura/workflows/waveform.py-474"></a>
<a id="src/oscura/workflows/waveform.py-475" name="src/oscura/workflows/waveform.py-475"></a>        <span class="c1"># Pattern discovery (for byte streams)</span>
<a id="src/oscura/workflows/waveform.py-476" name="src/oscura/workflows/waveform.py-476"></a><span class="hll">        <span class="k">if</span> <span class="n">decoded_frames</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">decoded_frames</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-477" name="src/oscura/workflows/waveform.py-477"></a><span class="hll">            <span class="k">try</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-478" name="src/oscura/workflows/waveform.py-478"></a><span class="hll">                <span class="kn">from</span><span class="w"> </span><span class="nn">oscura.analyzers.patterns</span><span class="w"> </span><span class="kn">import</span> <span class="n">discovery</span>
</span><a id="src/oscura/workflows/waveform.py-479" name="src/oscura/workflows/waveform.py-479"></a>
<a id="src/oscura/workflows/waveform.py-480" name="src/oscura/workflows/waveform.py-480"></a>                <span class="c1"># Convert decoded bytes to numpy array</span>
<a id="src/oscura/workflows/waveform.py-481" name="src/oscura/workflows/waveform.py-481"></a><span class="hll">                <span class="n">byte_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">b</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">decoded_frames</span><span class="p">[:</span><span class="mi">1000</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-482" name="src/oscura/workflows/waveform.py-482"></a>
<a id="src/oscura/workflows/waveform.py-483" name="src/oscura/workflows/waveform.py-483"></a><span class="hll">                <span class="n">signatures</span> <span class="o">=</span> <span class="n">discovery</span><span class="o">.</span><span class="n">discover_signatures</span><span class="p">(</span><span class="n">byte_data</span><span class="p">,</span> <span class="n">min_occurrences</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-484" name="src/oscura/workflows/waveform.py-484"></a><span class="hll">                <span class="n">pattern_results</span><span class="p">[</span><span class="s2">&quot;signatures&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><a id="src/oscura/workflows/waveform.py-485" name="src/oscura/workflows/waveform.py-485"></a>                    <span class="p">{</span>
<a id="src/oscura/workflows/waveform.py-486" name="src/oscura/workflows/waveform.py-486"></a>                        <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="n">sig</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">hex</span><span class="p">(),</span>
<a id="src/oscura/workflows/waveform.py-487" name="src/oscura/workflows/waveform.py-487"></a>                        <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">sig</span><span class="o">.</span><span class="n">occurrences</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-488" name="src/oscura/workflows/waveform.py-488"></a>                        <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">score</span><span class="p">),</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-490" name="src/oscura/workflows/waveform.py-490"></a>                    <span class="p">}</span>
<a id="src/oscura/workflows/waveform.py-491" name="src/oscura/workflows/waveform.py-491"></a>                    <span class="k">for</span> <span class="n">sig</span> <span class="ow">in</span> <span class="n">signatures</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>  <span class="c1"># Top 10</span>
<a id="src/oscura/workflows/waveform.py-492" name="src/oscura/workflows/waveform.py-492"></a>                <span class="p">]</span>
<a id="src/oscura/workflows/waveform.py-493" name="src/oscura/workflows/waveform.py-493"></a>
<a id="src/oscura/workflows/waveform.py-494" name="src/oscura/workflows/waveform.py-494"></a><span class="hll">                <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">signatures</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-495" name="src/oscura/workflows/waveform.py-495"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Discovered </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">signatures</span><span class="p">)</span><span class="si">}</span><span class="s2"> signature patterns&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-496" name="src/oscura/workflows/waveform.py-496"></a><span class="hll">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-497" name="src/oscura/workflows/waveform.py-497"></a><span class="hll">                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-498" name="src/oscura/workflows/waveform.py-498"></a><span class="hll">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Pattern discovery unavailable: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-499" name="src/oscura/workflows/waveform.py-499"></a>
<a id="src/oscura/workflows/waveform.py-500" name="src/oscura/workflows/waveform.py-500"></a>    <span class="c1"># Step 6: Generate plots (ALL plots from original + RE plots)</span>
<a id="src/oscura/workflows/waveform.py-501" name="src/oscura/workflows/waveform.py-501"></a><span class="hll">    <span class="n">plots</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><a id="src/oscura/workflows/waveform.py-502" name="src/oscura/workflows/waveform.py-502"></a><span class="hll">    <span class="k">if</span> <span class="n">generate_plots</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-503" name="src/oscura/workflows/waveform.py-503"></a><span class="hll">        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-504" name="src/oscura/workflows/waveform.py-504"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-505" name="src/oscura/workflows/waveform.py-505"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GENERATING VISUALIZATIONS&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-506" name="src/oscura/workflows/waveform.py-506"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-507" name="src/oscura/workflows/waveform.py-507"></a>
<a id="src/oscura/workflows/waveform.py-508" name="src/oscura/workflows/waveform.py-508"></a><span class="hll">        <span class="kn">from</span><span class="w"> </span><span class="nn">oscura.visualization</span><span class="w"> </span><span class="kn">import</span> <span class="n">batch</span>
</span><a id="src/oscura/workflows/waveform.py-509" name="src/oscura/workflows/waveform.py-509"></a>
<a id="src/oscura/workflows/waveform.py-510" name="src/oscura/workflows/waveform.py-510"></a>        <span class="c1"># Generate ALL standard plots</span>
<a id="src/oscura/workflows/waveform.py-511" name="src/oscura/workflows/waveform.py-511"></a><span class="hll">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="p">(</span><span class="n">WaveformTrace</span><span class="p">,</span> <span class="n">DigitalTrace</span><span class="p">)):</span>
</span><a id="src/oscura/workflows/waveform.py-512" name="src/oscura/workflows/waveform.py-512"></a><span class="hll">            <span class="n">plots</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">generate_all_plots</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-513" name="src/oscura/workflows/waveform.py-513"></a>
<a id="src/oscura/workflows/waveform.py-514" name="src/oscura/workflows/waveform.py-514"></a><span class="hll">        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-515" name="src/oscura/workflows/waveform.py-515"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Generated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">plots</span><span class="p">)</span><span class="si">}</span><span class="s2"> total plots&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-516" name="src/oscura/workflows/waveform.py-516"></a>
<a id="src/oscura/workflows/waveform.py-517" name="src/oscura/workflows/waveform.py-517"></a>    <span class="c1"># Step 7: Generate comprehensive report</span>
<a id="src/oscura/workflows/waveform.py-518" name="src/oscura/workflows/waveform.py-518"></a><span class="hll">    <span class="n">report_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><a id="src/oscura/workflows/waveform.py-519" name="src/oscura/workflows/waveform.py-519"></a><span class="hll">    <span class="k">if</span> <span class="n">generate_report</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-520" name="src/oscura/workflows/waveform.py-520"></a><span class="hll">        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-521" name="src/oscura/workflows/waveform.py-521"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-522" name="src/oscura/workflows/waveform.py-522"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GENERATING COMPREHENSIVE REPORT&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-523" name="src/oscura/workflows/waveform.py-523"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-524" name="src/oscura/workflows/waveform.py-524"></a>
<a id="src/oscura/workflows/waveform.py-525" name="src/oscura/workflows/waveform.py-525"></a><span class="hll">        <span class="kn">from</span><span class="w"> </span><span class="nn">oscura.reporting</span><span class="w"> </span><span class="kn">import</span> <span class="n">Report</span><span class="p">,</span> <span class="n">ReportConfig</span><span class="p">,</span> <span class="n">generate_html_report</span>
</span><a id="src/oscura/workflows/waveform.py-526" name="src/oscura/workflows/waveform.py-526"></a>
<a id="src/oscura/workflows/waveform.py-527" name="src/oscura/workflows/waveform.py-527"></a>        <span class="c1"># Create report</span>
<a id="src/oscura/workflows/waveform.py-528" name="src/oscura/workflows/waveform.py-528"></a><span class="hll">        <span class="n">valid_format</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;markdown&quot;</span><span class="p">,</span> <span class="s2">&quot;docx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-529" name="src/oscura/workflows/waveform.py-529"></a>            <span class="s2">&quot;html&quot;</span> <span class="k">if</span> <span class="n">report_format</span> <span class="o">==</span> <span class="s2">&quot;html&quot;</span> <span class="k">else</span> <span class="s2">&quot;pdf&quot;</span>
<a id="src/oscura/workflows/waveform.py-530" name="src/oscura/workflows/waveform.py-530"></a>        <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-531" name="src/oscura/workflows/waveform.py-531"></a><span class="hll">        <span class="n">config</span> <span class="o">=</span> <span class="n">ReportConfig</span><span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-532" name="src/oscura/workflows/waveform.py-532"></a>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Complete Waveform Analysis with Reverse Engineering&quot;</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-533" name="src/oscura/workflows/waveform.py-533"></a>            <span class="nb">format</span><span class="o">=</span><span class="n">valid_format</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-534" name="src/oscura/workflows/waveform.py-534"></a>            <span class="n">verbosity</span><span class="o">=</span><span class="s2">&quot;detailed&quot;</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-535" name="src/oscura/workflows/waveform.py-535"></a>        <span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-533" name="src/oscura/workflows/waveform.py-533"></a>            <span class="nb">format</span><span class="o">=</span><span class="n">valid_format</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-534" name="src/oscura/workflows/waveform.py-534"></a>            <span class="n">verbosity</span><span class="o">=</span><span class="s2">&quot;detailed&quot;</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-535" name="src/oscura/workflows/waveform.py-535"></a>        <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-536" name="src/oscura/workflows/waveform.py-536"></a>
<a id="src/oscura/workflows/waveform.py-537" name="src/oscura/workflows/waveform.py-537"></a><span class="hll">        <span class="n">report</span> <span class="o">=</span> <span class="n">Report</span><span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-538" name="src/oscura/workflows/waveform.py-538"></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-539" name="src/oscura/workflows/waveform.py-539"></a>            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
<a id="src/oscura/workflows/waveform.py-540" name="src/oscura/workflows/waveform.py-540"></a>                <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">),</span>
<a id="src/oscura/workflows/waveform.py-541" name="src/oscura/workflows/waveform.py-541"></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Digital&quot;</span> <span class="k">if</span> <span class="n">is_digital</span> <span class="k">else</span> <span class="s2">&quot;Analog&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-545" name="src/oscura/workflows/waveform.py-545"></a>            <span class="p">},</span>
<a id="src/oscura/workflows/waveform.py-546" name="src/oscura/workflows/waveform.py-546"></a>        <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-547" name="src/oscura/workflows/waveform.py-547"></a>
<a id="src/oscura/workflows/waveform.py-548" name="src/oscura/workflows/waveform.py-548"></a>        <span class="c1"># Add basic measurement sections - handle BOTH formats</span>
<a id="src/oscura/workflows/waveform.py-549" name="src/oscura/workflows/waveform.py-549"></a><span class="hll">        <span class="k">for</span> <span class="n">analysis_name</span><span class="p">,</span> <span class="n">analysis_results</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><a id="src/oscura/workflows/waveform.py-550" name="src/oscura/workflows/waveform.py-550"></a>            <span class="c1"># Extract measurements in both formats:</span>
<a id="src/oscura/workflows/waveform.py-551" name="src/oscura/workflows/waveform.py-551"></a>            <span class="c1"># 1. Unified format: {&quot;value&quot;: float, &quot;unit&quot;: str}</span>
<a id="src/oscura/workflows/waveform.py-552" name="src/oscura/workflows/waveform.py-552"></a>            <span class="c1"># 2. Legacy format: flat float/int values</span>
<a id="src/oscura/workflows/waveform.py-553" name="src/oscura/workflows/waveform.py-553"></a><span class="hll">            <span class="n">measurements</span> <span class="o">=</span> <span class="p">{}</span>
</span><a id="src/oscura/workflows/waveform.py-554" name="src/oscura/workflows/waveform.py-554"></a>
<a id="src/oscura/workflows/waveform.py-555" name="src/oscura/workflows/waveform.py-555"></a><span class="hll">            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">analysis_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><a id="src/oscura/workflows/waveform.py-556" name="src/oscura/workflows/waveform.py-556"></a><span class="hll">                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;value&quot;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-557" name="src/oscura/workflows/waveform.py-557"></a>                    <span class="c1"># Unified format - extract value for reporting</span>
<a id="src/oscura/workflows/waveform.py-558" name="src/oscura/workflows/waveform.py-558"></a><span class="hll">                    <span class="n">measurements</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
</span><a id="src/oscura/workflows/waveform.py-559" name="src/oscura/workflows/waveform.py-559"></a><span class="hll">                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-560" name="src/oscura/workflows/waveform.py-560"></a>                    <span class="c1"># Legacy flat format</span>
<a id="src/oscura/workflows/waveform.py-561" name="src/oscura/workflows/waveform.py-561"></a><span class="hll">                    <span class="n">measurements</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><a id="src/oscura/workflows/waveform.py-562" name="src/oscura/workflows/waveform.py-562"></a>                <span class="c1"># Skip arrays, objects, etc.</span>
<a id="src/oscura/workflows/waveform.py-563" name="src/oscura/workflows/waveform.py-563"></a>
<a id="src/oscura/workflows/waveform.py-564" name="src/oscura/workflows/waveform.py-564"></a><span class="hll">            <span class="k">if</span> <span class="n">measurements</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-565" name="src/oscura/workflows/waveform.py-565"></a><span class="hll">                <span class="n">title_map</span> <span class="o">=</span> <span class="p">{</span>
</span><a id="src/oscura/workflows/waveform.py-566" name="src/oscura/workflows/waveform.py-566"></a>                    <span class="s2">&quot;time_domain&quot;</span><span class="p">:</span> <span class="s2">&quot;Time-Domain Analysis (IEEE 181-2011)&quot;</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-567" name="src/oscura/workflows/waveform.py-567"></a>                    <span class="s2">&quot;frequency_domain&quot;</span><span class="p">:</span> <span class="s2">&quot;Frequency-Domain Analysis (IEEE 1241-2010)&quot;</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-568" name="src/oscura/workflows/waveform.py-568"></a>                    <span class="s2">&quot;digital&quot;</span><span class="p">:</span> <span class="s2">&quot;Digital Signal Analysis&quot;</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-569" name="src/oscura/workflows/waveform.py-569"></a>                    <span class="s2">&quot;statistics&quot;</span><span class="p">:</span> <span class="s2">&quot;Statistical Analysis&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-567" name="src/oscura/workflows/waveform.py-567"></a>                    <span class="s2">&quot;frequency_domain&quot;</span><span class="p">:</span> <span class="s2">&quot;Frequency-Domain Analysis (IEEE 1241-2010)&quot;</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-568" name="src/oscura/workflows/waveform.py-568"></a>                    <span class="s2">&quot;digital&quot;</span><span class="p">:</span> <span class="s2">&quot;Digital Signal Analysis&quot;</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-569" name="src/oscura/workflows/waveform.py-569"></a>                    <span class="s2">&quot;statistics&quot;</span><span class="p">:</span> <span class="s2">&quot;Statistical Analysis&quot;</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-570" name="src/oscura/workflows/waveform.py-570"></a>                <span class="p">}</span>
<a id="src/oscura/workflows/waveform.py-571" name="src/oscura/workflows/waveform.py-571"></a><span class="hll">                <span class="n">title</span> <span class="o">=</span> <span class="n">title_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">analysis_name</span><span class="p">,</span> <span class="n">analysis_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
</span><a id="src/oscura/workflows/waveform.py-572" name="src/oscura/workflows/waveform.py-572"></a><span class="hll">                <span class="n">report</span><span class="o">.</span><span class="n">add_measurements</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">measurements</span><span class="o">=</span><span class="n">measurements</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-573" name="src/oscura/workflows/waveform.py-573"></a>
<a id="src/oscura/workflows/waveform.py-574" name="src/oscura/workflows/waveform.py-574"></a>        <span class="c1"># Add protocol detection section</span>
<a id="src/oscura/workflows/waveform.py-575" name="src/oscura/workflows/waveform.py-575"></a><span class="hll">        <span class="k">if</span> <span class="n">protocols_detected</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-576" name="src/oscura/workflows/waveform.py-576"></a><span class="hll">            <span class="n">report</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-577" name="src/oscura/workflows/waveform.py-577"></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Protocol Detection Results&quot;</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-578" name="src/oscura/workflows/waveform.py-578"></a>                <span class="n">content</span><span class="o">=</span><span class="n">_format_protocol_detection</span><span class="p">(</span><span class="n">protocols_detected</span><span class="p">,</span> <span class="n">decoded_frames</span><span class="p">),</span>
<a id="src/oscura/workflows/waveform.py-579" name="src/oscura/workflows/waveform.py-579"></a>            <span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-578" name="src/oscura/workflows/waveform.py-578"></a>                <span class="n">content</span><span class="o">=</span><span class="n">_format_protocol_detection</span><span class="p">(</span><span class="n">protocols_detected</span><span class="p">,</span> <span class="n">decoded_frames</span><span class="p">),</span>
<a id="src/oscura/workflows/waveform.py-579" name="src/oscura/workflows/waveform.py-579"></a>            <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-580" name="src/oscura/workflows/waveform.py-580"></a>
<a id="src/oscura/workflows/waveform.py-581" name="src/oscura/workflows/waveform.py-581"></a>        <span class="c1"># Add reverse engineering section</span>
<a id="src/oscura/workflows/waveform.py-582" name="src/oscura/workflows/waveform.py-582"></a><span class="hll">        <span class="k">if</span> <span class="n">reverse_engineering_results</span> <span class="ow">and</span> <span class="n">reverse_engineering_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;baud_rate&quot;</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-583" name="src/oscura/workflows/waveform.py-583"></a><span class="hll">            <span class="n">report</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-584" name="src/oscura/workflows/waveform.py-584"></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Reverse Engineering Analysis&quot;</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-585" name="src/oscura/workflows/waveform.py-585"></a>                <span class="n">content</span><span class="o">=</span><span class="n">_format_reverse_engineering</span><span class="p">(</span><span class="n">reverse_engineering_results</span><span class="p">),</span>
<a id="src/oscura/workflows/waveform.py-586" name="src/oscura/workflows/waveform.py-586"></a>            <span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-585" name="src/oscura/workflows/waveform.py-585"></a>                <span class="n">content</span><span class="o">=</span><span class="n">_format_reverse_engineering</span><span class="p">(</span><span class="n">reverse_engineering_results</span><span class="p">),</span>
<a id="src/oscura/workflows/waveform.py-586" name="src/oscura/workflows/waveform.py-586"></a>            <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-587" name="src/oscura/workflows/waveform.py-587"></a>
<a id="src/oscura/workflows/waveform.py-588" name="src/oscura/workflows/waveform.py-588"></a>        <span class="c1"># Add anomaly detection section</span>
<a id="src/oscura/workflows/waveform.py-589" name="src/oscura/workflows/waveform.py-589"></a><span class="hll">        <span class="k">if</span> <span class="n">anomalies_detected</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-590" name="src/oscura/workflows/waveform.py-590"></a><span class="hll">            <span class="n">report</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-591" name="src/oscura/workflows/waveform.py-591"></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Anomaly Detection Results&quot;</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-592" name="src/oscura/workflows/waveform.py-592"></a>                <span class="n">content</span><span class="o">=</span><span class="n">_format_anomalies</span><span class="p">(</span><span class="n">anomalies_detected</span><span class="p">),</span>
<a id="src/oscura/workflows/waveform.py-593" name="src/oscura/workflows/waveform.py-593"></a>            <span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-592" name="src/oscura/workflows/waveform.py-592"></a>                <span class="n">content</span><span class="o">=</span><span class="n">_format_anomalies</span><span class="p">(</span><span class="n">anomalies_detected</span><span class="p">),</span>
<a id="src/oscura/workflows/waveform.py-593" name="src/oscura/workflows/waveform.py-593"></a>            <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-594" name="src/oscura/workflows/waveform.py-594"></a>
<a id="src/oscura/workflows/waveform.py-595" name="src/oscura/workflows/waveform.py-595"></a>        <span class="c1"># Add pattern recognition section</span>
<a id="src/oscura/workflows/waveform.py-596" name="src/oscura/workflows/waveform.py-596"></a><span class="hll">        <span class="k">if</span> <span class="n">pattern_results</span> <span class="ow">and</span> <span class="n">pattern_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;signatures&quot;</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-597" name="src/oscura/workflows/waveform.py-597"></a><span class="hll">            <span class="n">report</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span>
</span><a id="src/oscura/workflows/waveform.py-598" name="src/oscura/workflows/waveform.py-598"></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Pattern Recognition Results&quot;</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-599" name="src/oscura/workflows/waveform.py-599"></a>                <span class="n">content</span><span class="o">=</span><span class="n">_format_patterns</span><span class="p">(</span><span class="n">pattern_results</span><span class="p">),</span>
<a id="src/oscura/workflows/waveform.py-600" name="src/oscura/workflows/waveform.py-600"></a>            <span class="p">)</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-599" name="src/oscura/workflows/waveform.py-599"></a>                <span class="n">content</span><span class="o">=</span><span class="n">_format_patterns</span><span class="p">(</span><span class="n">pattern_results</span><span class="p">),</span>
<a id="src/oscura/workflows/waveform.py-600" name="src/oscura/workflows/waveform.py-600"></a>            <span class="p">)</span>
<a id="src/oscura/workflows/waveform.py-601" name="src/oscura/workflows/waveform.py-601"></a>
<a id="src/oscura/workflows/waveform.py-602" name="src/oscura/workflows/waveform.py-602"></a>        <span class="c1"># Generate HTML</span>
<a id="src/oscura/workflows/waveform.py-603" name="src/oscura/workflows/waveform.py-603"></a><span class="hll">        <span class="n">html_content</span> <span class="o">=</span> <span class="n">generate_html_report</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-604" name="src/oscura/workflows/waveform.py-604"></a>
<a id="src/oscura/workflows/waveform.py-605" name="src/oscura/workflows/waveform.py-605"></a>        <span class="c1"># Embed plots if requested</span>
<a id="src/oscura/workflows/waveform.py-606" name="src/oscura/workflows/waveform.py-606"></a><span class="hll">        <span class="k">if</span> <span class="n">embed_plots</span> <span class="ow">and</span> <span class="n">plots</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-607" name="src/oscura/workflows/waveform.py-607"></a><span class="hll">            <span class="kn">from</span><span class="w"> </span><span class="nn">oscura.reporting</span><span class="w"> </span><span class="kn">import</span> <span class="n">embed_plots</span> <span class="k">as</span> <span class="n">embed_plots_func</span>
</span><a id="src/oscura/workflows/waveform.py-608" name="src/oscura/workflows/waveform.py-608"></a>
<a id="src/oscura/workflows/waveform.py-609" name="src/oscura/workflows/waveform.py-609"></a><span class="hll">            <span class="n">html_content</span> <span class="o">=</span> <span class="n">embed_plots_func</span><span class="p">(</span><span class="n">html_content</span><span class="p">,</span> <span class="n">plots</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-610" name="src/oscura/workflows/waveform.py-610"></a><span class="hll">            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-611" name="src/oscura/workflows/waveform.py-611"></a><span class="hll">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Embedded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">plots</span><span class="p">)</span><span class="si">}</span><span class="s2"> plots in report&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-612" name="src/oscura/workflows/waveform.py-612"></a>
<a id="src/oscura/workflows/waveform.py-613" name="src/oscura/workflows/waveform.py-613"></a>        <span class="c1"># Save report</span>
<a id="src/oscura/workflows/waveform.py-614" name="src/oscura/workflows/waveform.py-614"></a><span class="hll">        <span class="n">report_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;complete_analysis.</span><span class="si">{</span><span class="n">report_format</span><span class="si">}</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-615" name="src/oscura/workflows/waveform.py-615"></a><span class="hll">        <span class="n">report_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">html_content</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-616" name="src/oscura/workflows/waveform.py-616"></a>
<a id="src/oscura/workflows/waveform.py-617" name="src/oscura/workflows/waveform.py-617"></a><span class="hll">        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-618" name="src/oscura/workflows/waveform.py-618"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Report saved: </span><span class="si">{</span><span class="n">report_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-619" name="src/oscura/workflows/waveform.py-619"></a>
<a id="src/oscura/workflows/waveform.py-620" name="src/oscura/workflows/waveform.py-620"></a><span class="hll">    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-621" name="src/oscura/workflows/waveform.py-621"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-622" name="src/oscura/workflows/waveform.py-622"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ANALYSIS COMPLETE&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-623" name="src/oscura/workflows/waveform.py-623"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-624" name="src/oscura/workflows/waveform.py-624"></a><span class="hll">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Output directory: </span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-625" name="src/oscura/workflows/waveform.py-625"></a><span class="hll">        <span class="k">if</span> <span class="n">protocols_detected</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-626" name="src/oscura/workflows/waveform.py-626"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Protocols detected: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">protocols_detected</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-627" name="src/oscura/workflows/waveform.py-627"></a><span class="hll">        <span class="k">if</span> <span class="n">decoded_frames</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-628" name="src/oscura/workflows/waveform.py-628"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Frames decoded: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">decoded_frames</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-629" name="src/oscura/workflows/waveform.py-629"></a><span class="hll">        <span class="k">if</span> <span class="n">anomalies_detected</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-630" name="src/oscura/workflows/waveform.py-630"></a><span class="hll">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Anomalies found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">anomalies_detected</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-631" name="src/oscura/workflows/waveform.py-631"></a>
<a id="src/oscura/workflows/waveform.py-632" name="src/oscura/workflows/waveform.py-632"></a>    <span class="c1"># Return comprehensive results</span>
<a id="src/oscura/workflows/waveform.py-633" name="src/oscura/workflows/waveform.py-633"></a><span class="hll">    <span class="k">return</span> <span class="p">{</span>
</span><a id="src/oscura/workflows/waveform.py-634" name="src/oscura/workflows/waveform.py-634"></a>        <span class="s2">&quot;filepath&quot;</span><span class="p">:</span> <span class="n">filepath</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-635" name="src/oscura/workflows/waveform.py-635"></a>        <span class="s2">&quot;trace&quot;</span><span class="p">:</span> <span class="n">trace</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-636" name="src/oscura/workflows/waveform.py-636"></a>        <span class="s2">&quot;is_digital&quot;</span><span class="p">:</span> <span class="n">is_digital</span><span class="p">,</span>
<a id="src/oscura/workflows/waveform.py-637" name="src/oscura/workflows/waveform.py-637"></a>        <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-655" name="src/oscura/workflows/waveform.py-655"></a>
<a id="src/oscura/workflows/waveform.py-656" name="src/oscura/workflows/waveform.py-656"></a><span class="sd">    Returns:</span>
<a id="src/oscura/workflows/waveform.py-657" name="src/oscura/workflows/waveform.py-657"></a><span class="sd">        HTML formatted string.</span>
<a id="src/oscura/workflows/waveform.py-658" name="src/oscura/workflows/waveform.py-658"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/workflows/waveform.py-659" name="src/oscura/workflows/waveform.py-659"></a><span class="hll">    <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;h3&gt;Detected Protocols&lt;/h3&gt;</span><span class="se">\n</span><span class="s2">&lt;ul&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-660" name="src/oscura/workflows/waveform.py-660"></a><span class="hll">    <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-661" name="src/oscura/workflows/waveform.py-661"></a><span class="hll">        <span class="n">conf</span> <span class="o">=</span> <span class="n">proto</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;confidence&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-662" name="src/oscura/workflows/waveform.py-662"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;&lt;strong&gt;</span><span class="si">{</span><span class="n">proto</span><span class="p">[</span><span class="s1">&#39;protocol&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/strong&gt;: </span><span class="si">{</span><span class="n">conf</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2"> confidence&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-663" name="src/oscura/workflows/waveform.py-663"></a><span class="hll">        <span class="k">if</span> <span class="s2">&quot;params&quot;</span> <span class="ow">in</span> <span class="n">proto</span> <span class="ow">and</span> <span class="s2">&quot;baud_rate&quot;</span> <span class="ow">in</span> <span class="n">proto</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]:</span>
</span><a id="src/oscura/workflows/waveform.py-664" name="src/oscura/workflows/waveform.py-664"></a><span class="hll">            <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; at </span><span class="si">{</span><span class="n">proto</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;baud_rate&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> baud&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-665" name="src/oscura/workflows/waveform.py-665"></a><span class="hll">        <span class="k">if</span> <span class="n">proto</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frame_count&quot;</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-666" name="src/oscura/workflows/waveform.py-666"></a><span class="hll">            <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">proto</span><span class="p">[</span><span class="s1">&#39;frame_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> frames)&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-667" name="src/oscura/workflows/waveform.py-667"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/li&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-668" name="src/oscura/workflows/waveform.py-668"></a><span class="hll">    <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/ul&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-669" name="src/oscura/workflows/waveform.py-669"></a>
<a id="src/oscura/workflows/waveform.py-670" name="src/oscura/workflows/waveform.py-670"></a><span class="hll">    <span class="k">if</span> <span class="n">frames</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-671" name="src/oscura/workflows/waveform.py-671"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;&lt;strong&gt;Total bytes decoded:&lt;/strong&gt; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span><span class="si">}</span><span class="s2">&lt;/p&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-672" name="src/oscura/workflows/waveform.py-672"></a>
<a id="src/oscura/workflows/waveform.py-673" name="src/oscura/workflows/waveform.py-673"></a><span class="hll">    <span class="k">return</span> <span class="n">html</span>
</span><a id="src/oscura/workflows/waveform.py-674" name="src/oscura/workflows/waveform.py-674"></a>
<a id="src/oscura/workflows/waveform.py-675" name="src/oscura/workflows/waveform.py-675"></a>
<a id="src/oscura/workflows/waveform.py-676" name="src/oscura/workflows/waveform.py-676"></a><span class="k">def</span><span class="w"> </span><span class="nf">_format_reverse_engineering</span><span class="p">(</span><span class="n">re_results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="src/oscura/workflows/waveform.py-677" name="src/oscura/workflows/waveform.py-677"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Format reverse engineering results for report.</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-681" name="src/oscura/workflows/waveform.py-681"></a>
<a id="src/oscura/workflows/waveform.py-682" name="src/oscura/workflows/waveform.py-682"></a><span class="sd">    Returns:</span>
<a id="src/oscura/workflows/waveform.py-683" name="src/oscura/workflows/waveform.py-683"></a><span class="sd">        HTML formatted string.</span>
<a id="src/oscura/workflows/waveform.py-684" name="src/oscura/workflows/waveform.py-684"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/workflows/waveform.py-685" name="src/oscura/workflows/waveform.py-685"></a><span class="hll">    <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;h3&gt;Reverse Engineering Findings&lt;/h3&gt;</span><span class="se">\n</span><span class="s2">&lt;ul&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-686" name="src/oscura/workflows/waveform.py-686"></a>
<a id="src/oscura/workflows/waveform.py-687" name="src/oscura/workflows/waveform.py-687"></a><span class="hll">    <span class="k">if</span> <span class="n">re_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;baud_rate&quot;</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-688" name="src/oscura/workflows/waveform.py-688"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;&lt;strong&gt;Baud Rate:&lt;/strong&gt; </span><span class="si">{</span><span class="n">re_results</span><span class="p">[</span><span class="s1">&#39;baud_rate&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> Hz&lt;/li&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-689" name="src/oscura/workflows/waveform.py-689"></a>
<a id="src/oscura/workflows/waveform.py-690" name="src/oscura/workflows/waveform.py-690"></a><span class="hll">    <span class="k">if</span> <span class="n">re_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;confidence&quot;</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-691" name="src/oscura/workflows/waveform.py-691"></a><span class="hll">        <span class="n">conf</span> <span class="o">=</span> <span class="n">re_results</span><span class="p">[</span><span class="s2">&quot;confidence&quot;</span><span class="p">]</span>
</span><a id="src/oscura/workflows/waveform.py-692" name="src/oscura/workflows/waveform.py-692"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;&lt;strong&gt;Overall Confidence:&lt;/strong&gt; </span><span class="si">{</span><span class="n">conf</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-693" name="src/oscura/workflows/waveform.py-693"></a>
<a id="src/oscura/workflows/waveform.py-694" name="src/oscura/workflows/waveform.py-694"></a><span class="hll">    <span class="k">if</span> <span class="n">re_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frame_count&quot;</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-695" name="src/oscura/workflows/waveform.py-695"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;&lt;strong&gt;Frames Detected:&lt;/strong&gt; </span><span class="si">{</span><span class="n">re_results</span><span class="p">[</span><span class="s1">&#39;frame_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-696" name="src/oscura/workflows/waveform.py-696"></a>
<a id="src/oscura/workflows/waveform.py-697" name="src/oscura/workflows/waveform.py-697"></a><span class="hll">    <span class="k">if</span> <span class="n">re_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frame_format&quot;</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-698" name="src/oscura/workflows/waveform.py-698"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;&lt;strong&gt;Frame Format:&lt;/strong&gt; </span><span class="si">{</span><span class="n">re_results</span><span class="p">[</span><span class="s1">&#39;frame_format&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-699" name="src/oscura/workflows/waveform.py-699"></a>
<a id="src/oscura/workflows/waveform.py-700" name="src/oscura/workflows/waveform.py-700"></a><span class="hll">    <span class="k">if</span> <span class="n">re_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sync_pattern&quot;</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-701" name="src/oscura/workflows/waveform.py-701"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;&lt;strong&gt;Sync Pattern:&lt;/strong&gt; </span><span class="si">{</span><span class="n">re_results</span><span class="p">[</span><span class="s1">&#39;sync_pattern&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-702" name="src/oscura/workflows/waveform.py-702"></a>
<a id="src/oscura/workflows/waveform.py-703" name="src/oscura/workflows/waveform.py-703"></a><span class="hll">    <span class="k">if</span> <span class="n">re_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frame_length&quot;</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-704" name="src/oscura/workflows/waveform.py-704"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;&lt;strong&gt;Frame Length:&lt;/strong&gt; </span><span class="si">{</span><span class="n">re_results</span><span class="p">[</span><span class="s1">&#39;frame_length&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> bytes&lt;/li&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-705" name="src/oscura/workflows/waveform.py-705"></a>
<a id="src/oscura/workflows/waveform.py-706" name="src/oscura/workflows/waveform.py-706"></a><span class="hll">    <span class="k">if</span> <span class="n">re_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_count&quot;</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-707" name="src/oscura/workflows/waveform.py-707"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;&lt;strong&gt;Fields Identified:&lt;/strong&gt; </span><span class="si">{</span><span class="n">re_results</span><span class="p">[</span><span class="s1">&#39;field_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-708" name="src/oscura/workflows/waveform.py-708"></a>
<a id="src/oscura/workflows/waveform.py-709" name="src/oscura/workflows/waveform.py-709"></a><span class="hll">    <span class="k">if</span> <span class="n">re_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;checksum_type&quot;</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-710" name="src/oscura/workflows/waveform.py-710"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;&lt;strong&gt;Checksum:&lt;/strong&gt; </span><span class="si">{</span><span class="n">re_results</span><span class="p">[</span><span class="s1">&#39;checksum_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-711" name="src/oscura/workflows/waveform.py-711"></a><span class="hll">        <span class="k">if</span> <span class="n">re_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;checksum_position&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-712" name="src/oscura/workflows/waveform.py-712"></a><span class="hll">            <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; at position </span><span class="si">{</span><span class="n">re_results</span><span class="p">[</span><span class="s1">&#39;checksum_position&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-713" name="src/oscura/workflows/waveform.py-713"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/li&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-714" name="src/oscura/workflows/waveform.py-714"></a>
<a id="src/oscura/workflows/waveform.py-715" name="src/oscura/workflows/waveform.py-715"></a><span class="hll">    <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/ul&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-716" name="src/oscura/workflows/waveform.py-716"></a>
<a id="src/oscura/workflows/waveform.py-717" name="src/oscura/workflows/waveform.py-717"></a><span class="hll">    <span class="k">if</span> <span class="n">re_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;warnings&quot;</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-718" name="src/oscura/workflows/waveform.py-718"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;h4&gt;Warnings&lt;/h4&gt;</span><span class="se">\n</span><span class="s2">&lt;ul&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-719" name="src/oscura/workflows/waveform.py-719"></a><span class="hll">        <span class="k">for</span> <span class="n">warning</span> <span class="ow">in</span> <span class="n">re_results</span><span class="p">[</span><span class="s2">&quot;warnings&quot;</span><span class="p">][:</span><span class="mi">5</span><span class="p">]:</span>  <span class="c1"># Max 5 warnings</span>
</span><a id="src/oscura/workflows/waveform.py-720" name="src/oscura/workflows/waveform.py-720"></a><span class="hll">            <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;</span><span class="si">{</span><span class="n">warning</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-721" name="src/oscura/workflows/waveform.py-721"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/ul&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-722" name="src/oscura/workflows/waveform.py-722"></a>
<a id="src/oscura/workflows/waveform.py-723" name="src/oscura/workflows/waveform.py-723"></a><span class="hll">    <span class="k">return</span> <span class="n">html</span>
</span><a id="src/oscura/workflows/waveform.py-724" name="src/oscura/workflows/waveform.py-724"></a>
<a id="src/oscura/workflows/waveform.py-725" name="src/oscura/workflows/waveform.py-725"></a>
<a id="src/oscura/workflows/waveform.py-726" name="src/oscura/workflows/waveform.py-726"></a><span class="k">def</span><span class="w"> </span><span class="nf">_format_anomalies</span><span class="p">(</span><span class="n">anomalies</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="src/oscura/workflows/waveform.py-727" name="src/oscura/workflows/waveform.py-727"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Format anomaly detection results for report.</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-731" name="src/oscura/workflows/waveform.py-731"></a>
<a id="src/oscura/workflows/waveform.py-732" name="src/oscura/workflows/waveform.py-732"></a><span class="sd">    Returns:</span>
<a id="src/oscura/workflows/waveform.py-733" name="src/oscura/workflows/waveform.py-733"></a><span class="sd">        HTML formatted string.</span>
<a id="src/oscura/workflows/waveform.py-734" name="src/oscura/workflows/waveform.py-734"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/workflows/waveform.py-735" name="src/oscura/workflows/waveform.py-735"></a><span class="hll">    <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;h3&gt;Detected Anomalies&lt;/h3&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-736" name="src/oscura/workflows/waveform.py-736"></a><span class="hll">    <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;&lt;strong&gt;Total anomalies:&lt;/strong&gt; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">anomalies</span><span class="p">)</span><span class="si">}</span><span class="s2">&lt;/p&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-737" name="src/oscura/workflows/waveform.py-737"></a>
<a id="src/oscura/workflows/waveform.py-738" name="src/oscura/workflows/waveform.py-738"></a>    <span class="c1"># Group by severity</span>
<a id="src/oscura/workflows/waveform.py-739" name="src/oscura/workflows/waveform.py-739"></a><span class="hll">    <span class="n">by_severity</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><a id="src/oscura/workflows/waveform.py-740" name="src/oscura/workflows/waveform.py-740"></a><span class="hll">    <span class="k">for</span> <span class="n">anomaly</span> <span class="ow">in</span> <span class="n">anomalies</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-741" name="src/oscura/workflows/waveform.py-741"></a><span class="hll">        <span class="n">severity</span> <span class="o">=</span> <span class="n">anomaly</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-742" name="src/oscura/workflows/waveform.py-742"></a><span class="hll">        <span class="n">by_severity</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">severity</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">anomaly</span><span class="p">)</span>
</span><a id="src/oscura/workflows/waveform.py-743" name="src/oscura/workflows/waveform.py-743"></a>
<a id="src/oscura/workflows/waveform.py-744" name="src/oscura/workflows/waveform.py-744"></a><span class="hll">    <span class="k">for</span> <span class="n">severity</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">]:</span>
</span><a id="src/oscura/workflows/waveform.py-745" name="src/oscura/workflows/waveform.py-745"></a><span class="hll">        <span class="k">if</span> <span class="n">severity</span> <span class="ow">in</span> <span class="n">by_severity</span><span class="p">:</span>
</span><a id="src/oscura/workflows/waveform.py-746" name="src/oscura/workflows/waveform.py-746"></a><span class="hll">            <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;h4&gt;</span><span class="si">{</span><span class="n">severity</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">by_severity</span><span class="p">[</span><span class="n">severity</span><span class="p">])</span><span class="si">}</span><span class="s2">)&lt;/h4&gt;</span><span class="se">\n</span><span class="s2">&lt;ul&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-747" name="src/oscura/workflows/waveform.py-747"></a><span class="hll">            <span class="k">for</span> <span class="n">anomaly</span> <span class="ow">in</span> <span class="n">by_severity</span><span class="p">[</span><span class="n">severity</span><span class="p">][:</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># Max 10 per severity</span>
</span><a id="src/oscura/workflows/waveform.py-748" name="src/oscura/workflows/waveform.py-748"></a><span class="hll">                <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;&lt;strong&gt;</span><span class="si">{</span><span class="n">anomaly</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:&lt;/strong&gt; </span><span class="si">{</span><span class="n">anomaly</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-749" name="src/oscura/workflows/waveform.py-749"></a><span class="hll">                <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (at </span><span class="si">{</span><span class="n">anomaly</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">s)&lt;/li&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-750" name="src/oscura/workflows/waveform.py-750"></a><span class="hll">            <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/ul&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-751" name="src/oscura/workflows/waveform.py-751"></a>
<a id="src/oscura/workflows/waveform.py-752" name="src/oscura/workflows/waveform.py-752"></a><span class="hll">    <span class="k">return</span> <span class="n">html</span>
</span><a id="src/oscura/workflows/waveform.py-753" name="src/oscura/workflows/waveform.py-753"></a>
<a id="src/oscura/workflows/waveform.py-754" name="src/oscura/workflows/waveform.py-754"></a>
<a id="src/oscura/workflows/waveform.py-755" name="src/oscura/workflows/waveform.py-755"></a><span class="k">def</span><span class="w"> </span><span class="nf">_format_patterns</span><span class="p">(</span><span class="n">pattern_results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="src/oscura/workflows/waveform.py-756" name="src/oscura/workflows/waveform.py-756"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Format pattern recognition results for report.</span>
</pre></div></td></tr></table></div>

            <div class="snippet"><table class="snippettable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span></pre></div></td><td class="code"><div><pre><span></span><a id="src/oscura/workflows/waveform.py-760" name="src/oscura/workflows/waveform.py-760"></a>
<a id="src/oscura/workflows/waveform.py-761" name="src/oscura/workflows/waveform.py-761"></a><span class="sd">    Returns:</span>
<a id="src/oscura/workflows/waveform.py-762" name="src/oscura/workflows/waveform.py-762"></a><span class="sd">        HTML formatted string.</span>
<a id="src/oscura/workflows/waveform.py-763" name="src/oscura/workflows/waveform.py-763"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="src/oscura/workflows/waveform.py-764" name="src/oscura/workflows/waveform.py-764"></a><span class="hll">    <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;h3&gt;Pattern Recognition Results&lt;/h3&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-765" name="src/oscura/workflows/waveform.py-765"></a>
<a id="src/oscura/workflows/waveform.py-766" name="src/oscura/workflows/waveform.py-766"></a><span class="hll">    <span class="k">if</span> <span class="n">pattern_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;signatures&quot;</span><span class="p">):</span>
</span><a id="src/oscura/workflows/waveform.py-767" name="src/oscura/workflows/waveform.py-767"></a><span class="hll">        <span class="n">sigs</span> <span class="o">=</span> <span class="n">pattern_results</span><span class="p">[</span><span class="s2">&quot;signatures&quot;</span><span class="p">]</span>
</span><a id="src/oscura/workflows/waveform.py-768" name="src/oscura/workflows/waveform.py-768"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;p&gt;&lt;strong&gt;Signature patterns discovered:&lt;/strong&gt; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sigs</span><span class="p">)</span><span class="si">}</span><span class="s2">&lt;/p&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-769" name="src/oscura/workflows/waveform.py-769"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;table border=&#39;1&#39; cellpadding=&#39;5&#39;&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-770" name="src/oscura/workflows/waveform.py-770"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;tr&gt;&lt;th&gt;Pattern&lt;/th&gt;&lt;th&gt;Length&lt;/th&gt;&lt;th&gt;Count&lt;/th&gt;&lt;th&gt;Score&lt;/th&gt;&lt;/tr&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-771" name="src/oscura/workflows/waveform.py-771"></a><span class="hll">        <span class="k">for</span> <span class="n">sig</span> <span class="ow">in</span> <span class="n">sigs</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># Top 10</span>
</span><a id="src/oscura/workflows/waveform.py-772" name="src/oscura/workflows/waveform.py-772"></a><span class="hll">            <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;tr&gt;&lt;td&gt;&lt;code&gt;</span><span class="si">{</span><span class="n">sig</span><span class="p">[</span><span class="s1">&#39;pattern&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/code&gt;&lt;/td&gt;&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-773" name="src/oscura/workflows/waveform.py-773"></a><span class="hll">            <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;td&gt;</span><span class="si">{</span><span class="n">sig</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> bytes&lt;/td&gt;&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-774" name="src/oscura/workflows/waveform.py-774"></a><span class="hll">            <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;td&gt;</span><span class="si">{</span><span class="n">sig</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/td&gt;&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-775" name="src/oscura/workflows/waveform.py-775"></a><span class="hll">            <span class="n">html</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;td&gt;</span><span class="si">{</span><span class="n">sig</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-776" name="src/oscura/workflows/waveform.py-776"></a><span class="hll">        <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/table&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><a id="src/oscura/workflows/waveform.py-777" name="src/oscura/workflows/waveform.py-777"></a>
<a id="src/oscura/workflows/waveform.py-778" name="src/oscura/workflows/waveform.py-778"></a><span class="hll">    <span class="k">return</span> <span class="n">html</span>
</span><a id="src/oscura/workflows/waveform.py-779" name="src/oscura/workflows/waveform.py-779"></a>
<a id="src/oscura/workflows/waveform.py-780" name="src/oscura/workflows/waveform.py-780"></a>
<a id="src/oscura/workflows/waveform.py-781" name="src/oscura/workflows/waveform.py-781"></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
<a id="src/oscura/workflows/waveform.py-782" name="src/oscura/workflows/waveform.py-782"></a>    <span class="s2">&quot;analyze_complete&quot;</span><span class="p">,</span>
</pre></div></td></tr></table></div>

            </div>
        </div>
    </body>
</html>